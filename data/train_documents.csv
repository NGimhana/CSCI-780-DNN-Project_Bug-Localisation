bug_id,document,url
1073,"/* This Source Code Form is subject to the terms of the Mozilla Public* License, v. 2.0. If a copy of the MPL was not distributed with this* file, You can obtain one at http://mozilla.org/MPL/2.0/. */package org.mozilla.focus.browser;import android.content.Context;import android.content.pm.PackageInfo;import android.content.pm.PackageManager;import android.content.res.Resources;import android.support.annotation.NonNull;import android.support.v4.util.ArrayMap;import android.view.View;import org.mozilla.focus.BuildConfig;import org.mozilla.focus.R;import org.mozilla.focus.locale.Locales;import org.mozilla.focus.utils.AppConstants;import org.mozilla.focus.utils.HtmlLoader;import org.mozilla.focus.utils.SupportUtils;import org.mozilla.focus.web.IWebView;import java.util.Map;public class LocalizedContent {// We can't use ""about:"" because webview silently swallows about: pages, hence we use// a custom scheme.public static final String URL_ABOUT = ""focus:about"";public static final String URL_RIGHTS = ""focus:rights"";public static boolean handleInternalContent(String url, IWebView webView, Context context) {if (URL_ABOUT.equals(url)) {loadAbout(webView, context);return true;} else if (URL_RIGHTS.equals(url)) {loadRights(webView, context);return true;}return false;}/*** Load the content for focus:about*/private static void loadAbout(@NonNull final IWebView webView, Context context) {final Resources resources = Locales.getLocalizedResources(context);final Map<String, String> substitutionMap = new ArrayMap<>();final String appName = context.getResources().getString(R.string.app_name);final String learnMoreURL = SupportUtils.getManifestoURL();String aboutVersion = """";try {final String engineIndicator = AppConstants.INSTANCE.isGeckoBuild() ?"" \uD83E\uDD8E "" + BuildConfig.GECKOVIEW_VERSION: """";final PackageInfo packageInfo = context.getPackageManager().getPackageInfo(context.getPackageName(), 0);aboutVersion = String.format(""%s (Build #%s)"", packageInfo.versionName, packageInfo.versionCode + engineIndicator);} catch (PackageManager.NameNotFoundException e) {// Nothing to do if we can't find the package name.}substitutionMap.put(""%about-version%"", aboutVersion);final String aboutContent = resources.getString(R.string.about_content, appName, learnMoreURL);substitutionMap.put(""%about-content%"", aboutContent);final String wordmark = HtmlLoader.loadPngAsDataURI(context, R.drawable.wordmark);substitutionMap.put(""%wordmark%"", wordmark);putLayoutDirectionIntoMap(substitutionMap, context);final String data = HtmlLoader.loadResourceFile(context, R.raw.about, substitutionMap);webView.loadData(""file:///android_res/raw/about.html"", data, ""text/html"", ""UTF-8"", URL_ABOUT);}/*** Load the content for focus:rights*/private static void loadRights(@NonNull final IWebView webView, Context context) {final Resources resources = Locales.getLocalizedResources(context);final Map<String, String> substitutionMap = new ArrayMap<>();final String appName = context.getResources().getString(R.string.app_name);final String mplUrl = ""https://www.mozilla.org/en-US/MPL/"";final String trademarkPolicyUrl = ""https://www.mozilla.org/foundation/trademarks/policy/"";final String gplUrl = ""gpl.html"";final String trackingProtectionUrl = ""https://wiki.mozilla.org/Security/Tracking_protection#Lists"";final String licensesUrl = ""licenses.html"";final String content1 = resources.getString(R.string.your_rights_content1, appName);substitutionMap.put(""%your-rights-content1%"", content1);final String content2 = resources.getString(R.string.your_rights_content2, appName, mplUrl);substitutionMap.put(""%your-rights-content2%"", content2);final String content3 = resources.getString(R.string.your_rights_content3, appName, trademarkPolicyUrl);substitutionMap.put(""%your-rights-content3%"", content3);final String content4 = resources.getString(R.string.your_rights_content4, appName, licensesUrl);substitutionMap.put(""%your-rights-content4%"", content4);final String content5 = resources.getString(R.string.your_rights_content5, appName, gplUrl, trackingProtectionUrl);substitutionMap.put(""%your-rights-content5%"", content5);putLayoutDirectionIntoMap(substitutionMap, context);final String data = HtmlLoader.loadResourceFile(context, R.raw.rights, substitutionMap);webView.loadData(""file:///android_asset/rights.html"", data, ""text/html"", ""UTF-8"", URL_RIGHTS);}private static void putLayoutDirectionIntoMap(Map<String, String> substitutionMap, Context context) {final int layoutDirection = context.getResources().getConfiguration().getLayoutDirection();final String direction;if (layoutDirection == View.LAYOUT_DIRECTION_LTR) {direction = ""ltr"";} else if (layoutDirection == View.LAYOUT_DIRECTION_RTL) {direction = ""rtl"";} else {direction = ""auto"";}substitutionMap.put(""%dir%"", direction);}}",focus-android/app/src/main/java/org/mozilla/focus/browser/LocalizedContent.java
10,"/** Copyright (c) 2019 Hai Zhang <dreaming.in.code.zh@gmail.com>* All Rights Reserved.*/package me.zhanghai.android.files.ftpserver;import android.content.BroadcastReceiver;import android.content.Context;import android.content.Intent;import java.util.Objects;import androidx.annotation.NonNull;public class FtpServerReceiver extends BroadcastReceiver {private static final String KEY_PREFIX = FtpServerReceiver.class.getName() + '.';public static final String ACTION_STOP = KEY_PREFIX + ""STOP"";@Overridepublic void onReceive(@NonNull Context context, @NonNull Intent intent) {String action = intent.getAction();if (Objects.equals(action, ACTION_STOP)) {FtpServerService.stop(context);} else {throw new IllegalArgumentException(action);}}}",MaterialFiles/app/src/main/java/me/zhanghai/android/files/ftpserver/FtpServerReceiver.java
10,"/** Copyright (c) 2019 Hai Zhang <dreaming.in.code.zh@gmail.com>* All Rights Reserved.*/package me.zhanghai.android.files.ftpserver;import android.app.Service;import android.content.Context;import android.content.Intent;import android.os.IBinder;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import androidx.annotation.NonNull;import androidx.annotation.Nullable;import androidx.annotation.WorkerThread;import androidx.lifecycle.LiveData;import androidx.lifecycle.MutableLiveData;import java8.nio.file.Path;import me.zhanghai.android.files.settings.Settings;import me.zhanghai.android.files.util.AppUtils;import me.zhanghai.android.files.util.ToastUtils;public class FtpServerService extends Service {public enum State {STARTING,RUNNING,STOPPING,STOPPED}public static final String USERNAME_ANONYMOUS = ""anonymous"";@NonNullprivate static final MutableLiveData<State> sStateLiveData = new MutableLiveData<>(State.STOPPED);@NonNullprivate final ExecutorService mExecutorService = Executors.newSingleThreadExecutor();private FtpServerWakeLock mWakeLock;private State mState = State.STOPPED;private FtpServer mServer;public static void start(@NonNull Context context) {context.startService(new Intent(context, FtpServerService.class));}public static void stop(@NonNull Context context) {context.stopService(new Intent(context, FtpServerService.class));}@NonNullpublic static LiveData<State> getStateLiveData() {return sStateLiveData;}@Overridepublic void onCreate() {super.onCreate();mWakeLock = new FtpServerWakeLock(this);executeStart();}@Nullable@Overridepublic IBinder onBind(@NonNull Intent intent) {return null;}@Overridepublic int onStartCommand(@Nullable Intent intent, int flags, int startId) {return START_STICKY;}@Overridepublic void onDestroy() {super.onDestroy();executeStop();mExecutorService.shutdown();}private void executeStart() {if (mState == State.STARTING || mState == State.RUNNING) {return;}mWakeLock.acquire();FtpServerServiceNotification.startForeground(this);setState(State.STARTING);mExecutorService.execute(this::doStart);}private void onStartError(@NonNull Exception exception) {setState(State.STOPPED);ToastUtils.show(exception.toString(), this);FtpServerServiceNotification.stopForeground(this);mWakeLock.release();stopSelf();}private void executeStop() {if (mState == State.STOPPING || mState == State.STOPPED) {return;}setState(State.STOPPING);mExecutorService.execute(this::doStop);FtpServerServiceNotification.stopForeground(this);mWakeLock.release();}private void setState(@NonNull State state) {mState = state;sStateLiveData.setValue(state);}@WorkerThreadprivate void postState(@NonNull State state) {AppUtils.runOnUiThread(() -> setState(state));}@WorkerThreadprivate void doStart() {if (mServer != null) {return;}String username;String password;if (Settings.FTP_SERVER_ANONYMOUS_LOGIN.getValue()) {username = USERNAME_ANONYMOUS;password = null;} else {username = Settings.FTP_SERVER_USERNAME.getValue();password = Settings.FTP_SERVER_PASSWORD.getValue();}int port = Settings.FTP_SERVER_PORT.getValue();Path homeDirectory = Settings.FTP_SERVER_HOME_DIRECTORY.getValue();boolean writable = Settings.FTP_SERVER_WRITABLE.getValue();mServer = new FtpServer(username, password, port, homeDirectory, writable);try {mServer.start();} catch (Exception e) {e.printStackTrace();mServer = null;AppUtils.runOnUiThread(() -> onStartError(e));return;}postState(State.RUNNING);}@WorkerThreadprivate void doStop() {if (mServer == null) {return;}mServer.stop();mServer = null;postState(State.STOPPED);}}",MaterialFiles/app/src/main/java/me/zhanghai/android/files/ftpserver/FtpServerService.java
10,"/** Copyright (c) 2019 Hai Zhang <dreaming.in.code.zh@gmail.com>* All Rights Reserved.*/package me.zhanghai.android.files.ftpserver;import android.content.Context;import android.util.AttributeSet;import androidx.annotation.AttrRes;import androidx.annotation.NonNull;import androidx.annotation.Nullable;import androidx.annotation.StyleRes;import androidx.lifecycle.Observer;import androidx.preference.SwitchPreferenceCompat;import me.zhanghai.android.files.R;public class FtpServerStatePreference extends SwitchPreferenceCompat {@NonNullprivate final Observer<FtpServerService.State> mObserver = this::onStateChanged;public FtpServerStatePreference(@NonNull Context context) {super(context);init();}public FtpServerStatePreference(@NonNull Context context, @Nullable AttributeSet attrs) {super(context, attrs);init();}public FtpServerStatePreference(@NonNull Context context, @Nullable AttributeSet attrs,@AttrRes int defStyleAttr) {super(context, attrs, defStyleAttr);init();}public FtpServerStatePreference(@NonNull Context context, @Nullable AttributeSet attrs,@AttrRes int defStyleAttr, @StyleRes int defStyleRes) {super(context, attrs, defStyleAttr, defStyleRes);init();}private void init() {setPersistent(false);}@Overridepublic void onAttached() {super.onAttached();FtpServerService.getStateLiveData().observeForever(mObserver);}@Overridepublic void onDetached() {super.onDetached();FtpServerService.getStateLiveData().removeObserver(mObserver);}private void onStateChanged(@NonNull FtpServerService.State state) {int summaryRes;switch (state) {case STARTING:summaryRes = R.string.ftp_server_state_summary_starting;break;case RUNNING:summaryRes = R.string.ftp_server_state_summary_running;break;case STOPPING:summaryRes = R.string.ftp_server_state_summary_stopping;break;case STOPPED:summaryRes = R.string.ftp_server_state_summary_stopped;break;default:throw new AssertionError(state);}setSummary(getContext().getString(summaryRes));setChecked(state == FtpServerService.State.STARTING|| state == FtpServerService.State.RUNNING);setEnabled(!(state == FtpServerService.State.STARTING|| state == FtpServerService.State.STOPPING));}@Overrideprotected void onClick() {switch (FtpServerService.getStateLiveData().getValue()) {case STARTING:case STOPPING:break;case RUNNING:FtpServerService.stop(getContext());break;case STOPPED:FtpServerService.start(getContext());break;default:throw new AssertionError();}}}",MaterialFiles/app/src/main/java/me/zhanghai/android/files/ftpserver/FtpServerStatePreference.java
1096,"package org.inaturalist.android;import android.content.ContentValues;import android.content.Intent;import android.graphics.Canvas;import android.graphics.Color;import android.graphics.Paint;import android.graphics.SurfaceTexture;import android.net.Uri;import android.os.Bundle;import android.os.Environment;import android.os.Handler;import android.provider.MediaStore;import androidx.appcompat.app.ActionBar;import androidx.appcompat.app.AppCompatActivity;import android.view.MenuItem;import android.view.TextureView;import android.view.View;import android.widget.TextView;import com.livefront.bridge.Bridge;import com.melnykov.fab.FloatingActionButton;import java.io.File;import java.nio.ByteBuffer;import java.nio.ByteOrder;import java.text.SimpleDateFormat;public class RecordSoundActivity extends AppCompatActivity implements SoundRecorder.OnRecordingStatus {private static String TAG = ""RecordSoundActivity"";private INaturalistApp mApp;private ActivityHelper mHelper;private FloatingActionButton mStartRecording;private TextView mStopRecording;private TextView mRecordingTime;private TextureView mVisualizerTexture;private Long mTotalTime = null;private Long mLastStartTime = null;private boolean mIsRecording = false;private SoundRecorder mRecorder;private String mOutputFilename;private boolean mCancelledRecording = false;private static final int MAX_SOUND_LINES = 300;private static final int SOUND_LINE_WIDTH = 4;private static final int SOUND_LINE_SPACING = 4;private static final float MAX_SOUND_VALUE = 500f;private short[] mSoundsValues = new short[MAX_SOUND_LINES];private int mSoundPlaybackIndex = 0;private int mSoundWritingIndex = 0;private int mMaxSamplesForScreenWidth = 0;private Handler mHandler = new Handler();private Runnable mUpdateTimer = new Runnable() {@Overridepublic void run() {float timeSecs = 0;if (mTotalTime != null) {if (mLastStartTime != null) {timeSecs = mTotalTime + (System.currentTimeMillis() - mLastStartTime);} else {timeSecs = mTotalTime;}}timeSecs /= 1000;mRecordingTime.setText(String.format(getResources().getString(R.string.seconds), timeSecs));if (mIsRecording) {mHandler.postDelayed(mUpdateTimer, 100);}}};@Overridepublic void onCreate(Bundle savedInstanceState) {super.onCreate(savedInstanceState);Bridge.restoreInstanceState(this, savedInstanceState);ActionBar actionBar = getSupportActionBar();actionBar.setHomeButtonEnabled(true);actionBar.setDisplayHomeAsUpEnabled(true);actionBar.setLogo(R.drawable.ic_arrow_back);setTitle(R.string.record_sound);mApp = (INaturalistApp) getApplicationContext();setContentView(R.layout.record_sound);mStartRecording = findViewById(R.id.start_recording);mStopRecording = findViewById(R.id.stop_recording);mRecordingTime = findViewById(R.id.seconds_counter);mVisualizerTexture = findViewById(R.id.sound_visualizer);mVisualizerTexture.setSurfaceTextureListener(new TextureView.SurfaceTextureListener() {@Overridepublic void onSurfaceTextureAvailable(SurfaceTexture surface, int width, int height) {Canvas canvas = mVisualizerTexture.lockCanvas();int canvasWidth = canvas.getWidth();mVisualizerTexture.unlockCanvasAndPost(canvas);mMaxSamplesForScreenWidth = canvasWidth / (SOUND_LINE_WIDTH + SOUND_LINE_SPACING);mSoundWritingIndex = mMaxSamplesForScreenWidth;}@Overridepublic void onSurfaceTextureSizeChanged(SurfaceTexture surface, int width, int height) {}@Overridepublic boolean onSurfaceTextureDestroyed(SurfaceTexture surface) {return false;}@Overridepublic void onSurfaceTextureUpdated(SurfaceTexture surface) {}});mRecordingTime.setText(String.format(getResources().getString(R.string.seconds), 0f));String timeStamp = new SimpleDateFormat(""yyyyMMdd_HHmmss"").format(System.currentTimeMillis());File outputDirectory = new File(getExternalFilesDir(Environment.DIRECTORY_MUSIC) + File.separator + ""iNaturalist"");outputDirectory.mkdirs();mOutputFilename = outputDirectory + File.separator + ""inaturalist_sound_"" + timeStamp + "".wav"";mRecorder = new SoundRecorder(this, mOutputFilename, this);mStopRecording.setVisibility(View.GONE);mStartRecording.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View view) {startPauseRecording();}});mHelper = new ActivityHelper(this);mStopRecording.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View view) {mIsRecording = false;mRecorder.stopRecording();mHelper.loading();}});}private void drawCurrentSoundWave() {Canvas canvas = mVisualizerTexture.lockCanvas();Paint paint = new Paint();paint.setColor(Color.parseColor(""#cb0000""));paint.setStrokeWidth(SOUND_LINE_WIDTH);paint.setStyle(Paint.Style.STROKE);Paint blackPaint = new Paint();blackPaint.setColor(Color.parseColor(""#000000""));blackPaint.setStrokeWidth(SOUND_LINE_WIDTH);blackPaint.setStyle(Paint.Style.STROKE);int canvasWidth = canvas.getWidth();for (int i = 0; (i < MAX_SOUND_LINES) && (i * (SOUND_LINE_WIDTH + SOUND_LINE_SPACING) <= canvasWidth); i++) {// First, delete previous linedrawBlankSoundLine(canvas, i, blackPaint);// Draw new lineshort soundValue = mSoundsValues[(mSoundPlaybackIndex + i) % MAX_SOUND_LINES];float[] line = soundValueToLine(canvas, i, soundValue);canvas.drawLine(line[0], line[1], line[2], line[3], paint);}mVisualizerTexture.unlockCanvasAndPost(canvas);}private void drawBlankSoundLine(Canvas canvas, int lineOffset, Paint blackPaint) {float yStart = 0;float yEnd = canvas.getHeight();float xStart = lineOffset * (SOUND_LINE_WIDTH + SOUND_LINE_SPACING);float xEnd = xStart;canvas.drawLine(xStart, yStart, xEnd, yEnd, blackPaint);}private float[] soundValueToLine(Canvas canvas, int lineOffset, short soundValue) {float xStart = lineOffset * (SOUND_LINE_WIDTH + SOUND_LINE_SPACING);float centerY = canvas.getHeight() / 2f;float yStart = centerY - (Math.min(1.0f, soundValue / MAX_SOUND_VALUE) * centerY);float yEnd = canvas.getHeight() - yStart;return new float[] { xStart, yStart, xStart, yEnd };}private void startPauseRecording() {if (!mApp.isAudioRecordingPermissionGranted()) {mApp.requestAudioRecordingPermission(RecordSoundActivity.this, new INaturalistApp.OnRequestPermissionResult() {@Overridepublic void onPermissionGranted() {startPauseRecording();}@Overridepublic void onPermissionDenied() {}});return;} else if (!mApp.isExternalStoragePermissionGranted()) {mApp.requestExternalStoragePermission(RecordSoundActivity.this, new INaturalistApp.OnRequestPermissionResult() {@Overridepublic void onPermissionGranted() {startPauseRecording();}@Overridepublic void onPermissionDenied() {}});return;}mStartRecording.setImageDrawable(getResources().getDrawable(mIsRecording ? R.drawable.microphone_white : R.drawable.baseline_pause_white_36));mStopRecording.setVisibility(View.VISIBLE);if (mIsRecording) {mRecorder.pauseRecording();mTotalTime += (System.currentTimeMillis() - mLastStartTime);mLastStartTime = null;} else {if (mTotalTime == null) {mTotalTime = 0L;}mLastStartTime = System.currentTimeMillis();if (mRecorder.hasStartedRecording()) {mRecorder.resumeRecording();} else {mRecorder.startRecording();}mHandler.postDelayed(mUpdateTimer, 100);}mIsRecording = !mIsRecording;}@Overridepublic boolean onOptionsItemSelected(MenuItem item) {switch (item.getItemId()) {case android.R.id.home:onBack();return true;default:return super.onOptionsItemSelected(item);}}@Overrideprotected void onSaveInstanceState(Bundle outState) {super.onSaveInstanceState(outState);Bridge.saveInstanceState(this, outState);}@Overridepublic void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {mApp.onRequestPermissionsResult(requestCode, permissions, grantResults);}@Overridepublic void onSoundRecording(byte[] values, int count) {short[] shorts = new short[values.length / 2];long total = 0;ByteBuffer.wrap(values).order(ByteOrder.LITTLE_ENDIAN).asShortBuffer().get(shorts);for (int i = 0; i < shorts.length; i++) {total += shorts[i];}short average = (short) (total / shorts.length);mSoundsValues[mSoundWritingIndex] = average;mSoundWritingIndex++;if (mSoundWritingIndex >= MAX_SOUND_LINES) mSoundWritingIndex = 0;// Draw current sound wavedrawCurrentSoundWave();// Move forward via the sound wavemSoundPlaybackIndex += 1;if (mSoundPlaybackIndex == MAX_SOUND_LINES) mSoundPlaybackIndex = 0;}@Overridepublic void onBackPressed() {onBack();}private void onBack() {mCancelledRecording = true;mRecorder.stopRecording();mHelper.loading();}@Overridepublic void onRecordingStopped() {mHelper.stopLoading();if (mCancelledRecording) {// User chose to cancel recording - delete the fileFile outputFile = new File(mOutputFilename);outputFile.delete();setResult(RESULT_CANCELED);finish();return;}// Make this sound accessible via the Android Files app (under Audio category)ContentValues values = new ContentValues();File file = new File(mOutputFilename);values.put(MediaStore.Audio.Media.DATA, mOutputFilename);values.put(MediaStore.Audio.Media.SIZE, file.length());values.put(MediaStore.Audio.Media.DISPLAY_NAME, mOutputFilename.substring(mOutputFilename.lastIndexOf(File.separator) + 1));values.put(MediaStore.Audio.Media.MIME_TYPE, ""audio/wav"");values.put(MediaStore.Audio.Media.IS_MUSIC, true);values.put(MediaStore.Audio.Media.ARTIST, ""iNaturalist"");values.put(MediaStore.Audio.Media.ALBUM, ""Sound Recordings"");values.put(MediaStore.Audio.Media.DATE_ADDED, System.currentTimeMillis());values.put(MediaStore.Audio.Media.DATE_MODIFIED, System.currentTimeMillis());String timeStamp = new SimpleDateFormat(""yyyyMMdd_HHmmss"").format(System.currentTimeMillis());values.put(MediaStore.Audio.Media.TITLE, String.format(""iNaturalist Sound Recording - %s"", timeStamp));Uri uri = getContentResolver().insert(MediaStore.Audio.Media.EXTERNAL_CONTENT_URI, values);Intent intent = new Intent();intent.setData(Uri.parse(mOutputFilename));setResult(RESULT_OK, intent);finish();}}",iNaturalistAndroid/iNaturalist/src/main/java/org/inaturalist/android/RecordSoundActivity.java
1147,"/** Copyright 2014-2018 Google Inc.,* University of South Florida (sjbarbeau@gmail.com),* Microsoft Corporation,* Sean J. Barbeau** Licensed under the Apache License, Version 2.0 (the ""License"");* you may not use this file except in compliance with the License.* You may obtain a copy of the License at**      http://www.apache.org/licenses/LICENSE-2.0** Unless required by applicable law or agreed to in writing, software* distributed under the License is distributed on an ""AS IS"" BASIS,* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.* See the License for the specific language governing permissions and* limitations under the License.** Portions of code taken from the Google I/0 2014 (https://github.com/google/iosched)* and a generated NavigationDrawer app from Android Studio, modified for OneBusAway by USF,* modified for GPSTest by Sean J. Barbeau*/package com.android.gpstest;import android.content.Context;import android.content.SharedPreferences;import android.content.res.Configuration;import android.os.Bundle;import android.support.v4.app.Fragment;import android.support.v4.view.GravityCompat;import android.support.v4.widget.DrawerLayout;import android.support.v7.app.ActionBar;import android.support.v7.app.ActionBarDrawerToggle;import android.support.v7.app.AppCompatActivity;import android.util.Log;import android.view.LayoutInflater;import android.view.MenuItem;import android.view.View;import android.view.ViewGroup;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.TextView;import com.android.gpstest.view.ScrimInsetsScrollView;import java.util.ArrayList;/*** Fragment used for managing interactions for and presentation of a navigation drawer.* See the <a href=""https://developer.android.com/design/patterns/navigation-drawer.html#Interaction"">* design guidelines</a> for a complete explanation of the behaviors implemented here.*/public class NavigationDrawerFragment extends Fragment {public static final String TAG = ""NavDrawerFragment"";/*** Remember the position of the selected item.*/private static final String STATE_SELECTED_POSITION = ""selected_navigation_drawer_position"";// symbols for navdrawer items (indices must correspond to array below). This is// not a list of items that are necessarily *present* in the Nav Drawer; rather,// it's a list of all possible items.protected static final int NAVDRAWER_ITEM_STATUS = 0;protected static final int NAVDRAWER_ITEM_MAP = 1;protected static final int NAVDRAWER_ITEM_SKY = 2;protected static final int NAVDRAWER_ITEM_SETTINGS = 3;protected static final int NAVDRAWER_ITEM_HELP = 4;protected static final int NAVDRAWER_ITEM_OPEN_SOURCE = 5;protected static final int NAVDRAWER_ITEM_INJECT_XTRA_DATA = 6;protected static final int NAVDRAWER_ITEM_INJECT_TIME_DATA = 7;protected static final int NAVDRAWER_ITEM_CLEAR_AIDING_DATA = 8;protected static final int NAVDRAWER_ITEM_INVALID = -1;protected static final int NAVDRAWER_ITEM_SEPARATOR = -2;protected static final int NAVDRAWER_ITEM_SEPARATOR_SPECIAL = -3;// Currently selected navigation drawer item (must be value of one of the constants above)private int mCurrentSelectedPosition = NAVDRAWER_ITEM_STATUS;// titles for navdrawer items (indices must correspond to the above)private static final int[] NAVDRAWER_TITLE_RES_ID = new int[]{R.string.gps_status_title,R.string.gps_map_title,R.string.gps_sky_title,R.string.navdrawer_item_settings,R.string.navdrawer_item_help,R.string.navdrawer_item_open_source,R.string.force_xtra_injection,R.string.force_time_injection,R.string.delete_aiding_data};// icons for navdrawer items (indices must correspond to above array)private static final int[] NAVDRAWER_ICON_RES_ID = new int[]{R.drawable.ic_wireless,  // StatusR.drawable.ic_map, // MapR.drawable.ic_sky, // Sky0, // Settings0, // HelpR.drawable.ic_drawer_github, // Open-sourceR.drawable.ic_inject_xtra, // Inject XTRA dataR.drawable.ic_inject_time, // Inject time dataR.drawable.ic_delete // Clear assist data};// Secondary navdrawer item icons that appear align to right of list item layoutprivate static final int[] NAVDRAWER_ICON_SECONDARY_RES_ID = new int[]{0,  // Status0, // Map0, // Sky0, // Settings0, // HelpR.drawable.ic_drawer_link, // Open-source0, // Inject XTRA data0, // Inject time data0 // Clear assist data};// list of navdrawer items that were actually added to the navdrawer, in orderprivate ArrayList<Integer> mNavDrawerItems = new ArrayList<Integer>();// views that correspond to each navdrawer item, null if not yet createdprivate View[] mNavDrawerItemViews = null;/*** A pointer to the current callbacks instance (the Activity).*/private NavigationDrawerCallbacks mCallbacks;/*** Helper component that ties the action bar to the navigation drawer.*/private ActionBarDrawerToggle mDrawerToggle;// Navigation drawer:private DrawerLayout mDrawerLayout;private View mDrawerItemsListContainer;private View mFragmentContainerView;private boolean isSignedIn;public NavigationDrawerFragment() {}@Overridepublic void onCreate(Bundle savedInstanceState) {super.onCreate(savedInstanceState);// Read in the flag indicating whether or not the user has demonstrated awareness of the// drawer. See PREF_USER_LEARNED_DRAWER for details.SharedPreferences sp = Application.getPrefs();if (savedInstanceState != null) {mCurrentSelectedPosition = savedInstanceState.getInt(STATE_SELECTED_POSITION);Log.d(TAG, ""Using position from savedInstanceState = "" + mCurrentSelectedPosition);} else {// Try to get the saved position from preferencesmCurrentSelectedPosition = sp.getInt(STATE_SELECTED_POSITION, NAVDRAWER_ITEM_STATUS);Log.d(TAG, ""Using position from preferences = "" + mCurrentSelectedPosition);}// Select either the default item (0) or the last selected item.selectItem(mCurrentSelectedPosition);}@Overridepublic void onActivityCreated(Bundle savedInstanceState) {super.onActivityCreated(savedInstanceState);// Indicate that this fragment would like to influence the set of actions in the action bar.setHasOptionsMenu(true);}@Overridepublic View onCreateView(LayoutInflater inflater, ViewGroup container,Bundle savedInstanceState) {mDrawerItemsListContainer = inflater.inflate(R.layout.navdrawer_list, container, false);return mDrawerItemsListContainer;}/*** Users of this fragment must call this method to set up the navigation drawer interactions.** @param fragmentId   The android:id of this fragment in its activity's layout.* @param drawerLayout The DrawerLayout containing this fragment's UI.*/public void setUp(int fragmentId, DrawerLayout drawerLayout) {int selfItem = mCurrentSelectedPosition;mFragmentContainerView = getActivity().findViewById(fragmentId);mDrawerLayout = drawerLayout;if (mDrawerLayout == null) {return;}// set a custom shadow that overlays the main content when the drawer opensmDrawerLayout.setDrawerShadow(R.drawable.drawer_shadow, GravityCompat.START);ScrimInsetsScrollView navDrawer = mDrawerLayout.findViewById(R.id.navdrawer);if (selfItem == NAVDRAWER_ITEM_INVALID) {// do not show a nav drawerif (navDrawer != null) {((ViewGroup) navDrawer.getParent()).removeView(navDrawer);}mDrawerLayout = null;return;}// populate the nav drawer with the correct itemspopulateNavDrawer();ActionBar actionBar = getActionBar();actionBar.setDisplayHomeAsUpEnabled(true);actionBar.setHomeButtonEnabled(true);// ActionBarDrawerToggle ties together the the proper interactions// between the navigation drawer and the action bar app icon.mDrawerToggle = new android.support.v7.app.ActionBarDrawerToggle(getActivity(),                    /* host Activity */mDrawerLayout,                    /* DrawerLayout object */R.string.navigation_drawer_open,  /* ""open drawer"" description for accessibility */R.string.navigation_drawer_close  /* ""close drawer"" description for accessibility */) {@Overridepublic void onDrawerClosed(View drawerView) {super.onDrawerClosed(drawerView);if (!isAdded()) {return;}getActivity().supportInvalidateOptionsMenu(); // calls onPrepareOptionsMenu()}@Overridepublic void onDrawerOpened(View drawerView) {super.onDrawerOpened(drawerView);if (!isAdded()) {return;}getActivity().supportInvalidateOptionsMenu(); // calls onPrepareOptionsMenu()}};// Defer code dependent on restoration of previous instance state.mDrawerLayout.post(new Runnable() {@Overridepublic void run() {mDrawerToggle.syncState();}});mDrawerLayout.setDrawerListener(mDrawerToggle);}/*** Sets the currently selected navigation drawer item, based on the provided position* parameter,* which must be one of the NAVDRAWER_ITEM_* contants in this class.** @param position the item to select in the navigation drawer - must be one of the*                 NAVDRAWER_ITEM_* contants in this class*/public void selectItem(int position) {setSelectedNavDrawerItem(position);if (mDrawerLayout != null && mFragmentContainerView != null) {mDrawerLayout.closeDrawer(mFragmentContainerView);}if (mCallbacks != null) {mCallbacks.onNavigationDrawerItemSelected(position);}}/*** Set the selected position as a preference*/public void setSavedPosition(int position) {SharedPreferences sp = Application.getPrefs();sp.edit().putInt(STATE_SELECTED_POSITION, position).apply();}/*** Sets up the given navdrawer item's appearance to the selected state. Note: this could* also be accomplished (perhaps more cleanly) with state-based layouts.*/private void setSelectedNavDrawerItem(int itemId) {if (!isNewActivityItem(itemId)) {// We only change the selected item if it doesn't launch a new activitymCurrentSelectedPosition = itemId;setSavedPosition(mCurrentSelectedPosition);}if (mNavDrawerItemViews != null) {for (int i = 0; i < mNavDrawerItemViews.length; i++) {if (i < mNavDrawerItems.size()) {int thisItemId = mNavDrawerItems.get(i);formatNavDrawerItem(mNavDrawerItemViews[i], thisItemId, itemId == thisItemId);}}}}@Overridepublic void onAttach(final Context context) {super.onAttach(context);try {mCallbacks = (NavigationDrawerCallbacks) context;} catch (ClassCastException e) {throw new ClassCastException(""Activity must implement NavigationDrawerCallbacks."");}}@Overridepublic void onDetach() {super.onDetach();mCallbacks = null;}@Overridepublic void onSaveInstanceState(Bundle outState) {super.onSaveInstanceState(outState);Log.d(TAG, ""Saving position = "" + mCurrentSelectedPosition);outState.putInt(STATE_SELECTED_POSITION, mCurrentSelectedPosition);}@Overridepublic void onResume() {super.onResume();populateNavDrawer();}@Overridepublic void onConfigurationChanged(Configuration newConfig) {super.onConfigurationChanged(newConfig);// Forward the new configuration the drawer toggle component.if (mDrawerToggle != null) {mDrawerToggle.onConfigurationChanged(newConfig);}}@Overridepublic boolean onOptionsItemSelected(MenuItem item) {if (mDrawerToggle != null && mDrawerToggle.onOptionsItemSelected(item)) {return true;}return super.onOptionsItemSelected(item);}private ActionBar getActionBar() {return ((AppCompatActivity) getActivity()).getSupportActionBar();}/*** Callbacks interface that all activities using this fragment must implement.*/public interface NavigationDrawerCallbacks {/*** Called when an item in the navigation drawer is selected.*/void onNavigationDrawerItemSelected(int position);}/** Populates the navigation drawer with the appropriate items. */public void populateNavDrawer() {mNavDrawerItems.clear();mNavDrawerItems.add(NAVDRAWER_ITEM_STATUS);mNavDrawerItems.add(NAVDRAWER_ITEM_MAP);mNavDrawerItems.add(NAVDRAWER_ITEM_SKY);mNavDrawerItems.add(NAVDRAWER_ITEM_SEPARATOR_SPECIAL);mNavDrawerItems.add(NAVDRAWER_ITEM_INJECT_XTRA_DATA);mNavDrawerItems.add(NAVDRAWER_ITEM_INJECT_TIME_DATA);mNavDrawerItems.add(NAVDRAWER_ITEM_CLEAR_AIDING_DATA);mNavDrawerItems.add(NAVDRAWER_ITEM_SEPARATOR);mNavDrawerItems.add(NAVDRAWER_ITEM_OPEN_SOURCE);mNavDrawerItems.add(NAVDRAWER_ITEM_SEPARATOR);mNavDrawerItems.add(NAVDRAWER_ITEM_SETTINGS);mNavDrawerItems.add(NAVDRAWER_ITEM_HELP);createNavDrawerItems();}private void createNavDrawerItems() {if (mDrawerItemsListContainer == null || getActivity() == null) {return;}// Set background color of nav drawerif (Application.getPrefs().getBoolean(getString(R.string.pref_key_dark_theme), false)) {mDrawerItemsListContainer.setBackgroundColor(getContext().getResources().getColor(R.color.navdrawer_background_dark));}// Populate viewsmNavDrawerItemViews = new View[mNavDrawerItems.size()];int i = 0;LinearLayout listLayout = mDrawerItemsListContainer.findViewById(R.id.navdrawer_items_list);listLayout.removeAllViews();for (int itemId : mNavDrawerItems) {mNavDrawerItemViews[i] = makeNavDrawerItem(itemId, listLayout);listLayout.addView(mNavDrawerItemViews[i]);++i;}}private View makeNavDrawerItem(final int itemId, ViewGroup container) {boolean selected = mCurrentSelectedPosition == itemId;int layoutToInflate;if (itemId == NAVDRAWER_ITEM_SEPARATOR) {layoutToInflate = R.layout.navdrawer_separator;} else if (itemId == NAVDRAWER_ITEM_SEPARATOR_SPECIAL) {layoutToInflate = R.layout.navdrawer_separator_special;} else {layoutToInflate = R.layout.navdrawer_item;}View view = getActivity().getLayoutInflater().inflate(layoutToInflate, container, false);if (isSeparator(itemId)) {// we are doneUIUtils.setAccessibilityIgnore(view);return view;}if (Application.getPrefs().getBoolean(getString(R.string.pref_key_dark_theme), false)&& layoutToInflate == R.layout.navdrawer_item) {// Dark themeview.setBackgroundResource(R.drawable.navdrawer_item_selectable_dark);}ImageView iconView = view.findViewById(R.id.icon);TextView titleView = view.findViewById(R.id.title);ImageView secondaryIconView = view.findViewById(R.id.secondary_icon);int iconId = itemId >= 0 && itemId < NAVDRAWER_ICON_RES_ID.length ?NAVDRAWER_ICON_RES_ID[itemId] : 0;int titleId = itemId >= 0 && itemId < NAVDRAWER_TITLE_RES_ID.length ?NAVDRAWER_TITLE_RES_ID[itemId] : 0;int secondaryIconId = itemId >= 0 && itemId < NAVDRAWER_ICON_SECONDARY_RES_ID.length ?NAVDRAWER_ICON_SECONDARY_RES_ID[itemId] : 0;// set icon and texticonView.setVisibility(iconId > 0 ? View.VISIBLE : View.GONE);if (iconId > 0) {iconView.setImageResource(iconId);}titleView.setText(getString(titleId));// Secondary iconsecondaryIconView.setVisibility(secondaryIconId > 0 ? View.VISIBLE : View.GONE);if (secondaryIconId > 0) {secondaryIconView.setImageResource(secondaryIconId);}formatNavDrawerItem(view, itemId, selected);view.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {selectItem(itemId);}});return view;}private void formatNavDrawerItem(View view, int itemId, boolean selected) {if (isSeparator(itemId)) {// Don't do any formattingreturn;}ImageView iconView = view.findViewById(R.id.icon);TextView titleView = view.findViewById(R.id.title);ImageView secondaryIconView = view.findViewById(R.id.secondary_icon);/*** Configure its appearance according to whether or not it's selected.  Certain items* (e.g., Settings) don't get formatted upon selection, since they open a new activity.*/if (selected) {if (isNewActivityItem(itemId)) {// Don't change any formatting, since this is a category that launches a new activityreturn;} else {// Show the category as highlighted by changing background, text, and icon colorview.setSelected(true);titleView.setTextColor(getResources().getColor(R.color.navdrawer_text_color_selected));iconView.setColorFilter(getResources().getColor(R.color.navdrawer_icon_tint_selected));secondaryIconView.setColorFilter(getResources().getColor(R.color.navdrawer_icon_tint_selected));}} else {// Show the category as not highlighted, if its not currently selectedif (itemId != mCurrentSelectedPosition) {view.setSelected(false);if (Application.getPrefs().getBoolean(getString(R.string.pref_key_dark_theme), false)) {// Dark themetitleView.setTextColor(getResources().getColor(R.color.navdrawer_text_color_dark));iconView.setColorFilter(getResources().getColor(R.color.navdrawer_icon_tint_dark));secondaryIconView.setColorFilter(getResources().getColor(R.color.navdrawer_icon_tint_dark));} else {// Light themetitleView.setTextColor(getResources().getColor(R.color.navdrawer_text_color_light));iconView.setColorFilter(getResources().getColor(R.color.navdrawer_icon_tint_light));secondaryIconView.setColorFilter(getResources().getColor(R.color.navdrawer_icon_tint_light));}}}}private boolean isSeparator(int itemId) {return itemId == NAVDRAWER_ITEM_SEPARATOR || itemId == NAVDRAWER_ITEM_SEPARATOR_SPECIAL;}/*** Returns true if this is an item that should not allow selection (e.g., Settings),* because they launch a new Activity and aren't part of this screen, false if its selectable* and changes the current UI via a new fragment** @return true if this is an item that should not allow selection (e.g., Settings),* because they launch a new Activity and aren't part of this screen, false if its selectable* and changes the current UI via a new fragment*/private boolean isNewActivityItem(int itemId) {return itemId == NAVDRAWER_ITEM_SETTINGS ||itemId == NAVDRAWER_ITEM_HELP ||itemId == NAVDRAWER_ITEM_OPEN_SOURCE ||itemId == NAVDRAWER_ITEM_INJECT_XTRA_DATA ||itemId == NAVDRAWER_ITEM_INJECT_TIME_DATA ||itemId == NAVDRAWER_ITEM_CLEAR_AIDING_DATA;}}",gpstest/GPSTest/src/main/java/com/android/gpstest/NavigationDrawerFragment.java
1147,"<?xml version=""1.0"" encoding=""utf-8""?><!-- Copyright (C) 2010-2018 The Android Open Source Project, Sean J. BarbeauLicensed under the Apache License, Version 2.0 (the ""License"");you may not use this file except in compliance with the License.You may obtain a copy of the License athttp://www.apache.org/licenses/LICENSE-2.0Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an ""AS IS"" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.--><selector xmlns:android=""http://schemas.android.com/apk/res/android""android:exitFadeDuration=""@android:integer/config_mediumAnimTime""><item android:state_pressed=""true""android:drawable=""@color/navdrawer_background_color_selected_dark""/><item android:state_selected=""true""android:drawable=""@color/navdrawer_background_color_selected_dark""/><item android:drawable=""@android:color/transparent""/></selector>",gpstest/GPSTest/src/main/res/drawable/navdrawer_item_selectable_dark.xml
1147,"<?xml version=""1.0"" encoding=""utf-8""?><!-- Copyright (C) 2010-2018 The Android Open Source Project, Sean J. BarbeauLicensed under the Apache License, Version 2.0 (the ""License"");you may not use this file except in compliance with the License.You may obtain a copy of the License athttp://www.apache.org/licenses/LICENSE-2.0Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an ""AS IS"" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.--><selector xmlns:android=""http://schemas.android.com/apk/res/android""android:exitFadeDuration=""@android:integer/config_mediumAnimTime""><item android:state_pressed=""true""android:drawable=""@color/navdrawer_background_color_selected_light""/><item android:state_selected=""true""android:drawable=""@color/navdrawer_background_color_selected_light""/><item android:drawable=""@android:color/transparent""/></selector>",gpstest/GPSTest/src/main/res/drawable/navdrawer_item_selectable_light.xml
1147,"<!--Copyright 2014-2018 Google Inc., University of South Florida (sjbarbeau@gmail.com)All rights reserved.Licensed under the Apache License, Version 2.0 (the ""License"");you may not use this file except in compliance with the License.You may obtain a copy of the License athttp://www.apache.org/licenses/LICENSE-2.0Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an ""AS IS"" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.--><RelativeLayout xmlns:android=""http://schemas.android.com/apk/res/android""style=""@style/NavDrawerListItem.Light""android:paddingLeft=""@dimen/activity_horizontal_margin""android:paddingRight=""@dimen/activity_horizontal_margin""android:layout_width=""match_parent""android:focusable=""true""android:layout_height=""48dp""><ImageViewandroid:id=""@+id/icon""android:layout_alignParentStart=""true""android:layout_alignParentLeft=""true""android:layout_height=""24dp""android:layout_width=""24dp""android:layout_marginRight=""32dp""android:layout_centerVertical=""true"" /><TextViewandroid:id=""@+id/title""android:layout_width=""wrap_content""android:layout_height=""wrap_content""android:layout_toEndOf=""@+id/icon""android:layout_toRightOf=""@+id/icon""android:layout_centerVertical=""true""android:fontFamily=""@string/font_fontFamily_medium""android:textStyle=""@integer/font_textStyle_medium""android:textSize=""14sp"" /><ImageViewandroid:id=""@+id/secondary_icon""android:layout_height=""24dp""android:layout_width=""24dp""android:layout_centerVertical=""true""android:layout_alignParentEnd=""true""android:layout_alignParentRight=""true""/></RelativeLayout>",gpstest/GPSTest/src/main/res/layout/navdrawer_item.xml
1147,"<?xml version=""1.0"" encoding=""utf-8""?><!-- Copyright (C) 2016 Sean J. Barbeau (sjbarbeau@gmail.com)Licensed under the Apache License, Version 2.0 (the ""License"");you may not use this file except in compliance with the License.You may obtain a copy of the License athttp://www.apache.org/licenses/LICENSE-2.0Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an ""AS IS"" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.--><resources><!-- GPSTest Theme --><color name=""colorPrimary"">#3F51B5</color><color name=""colorPrimaryDark"">#303F9F</color><color name=""colorAccent"">#C5CAE9</color><!-- Navigation Drawer (Shared for Light and Dark Themes) --><color name=""navdrawer_text_color_selected"">@color/colorPrimary</color><color name=""navdrawer_icon_tint_selected"">@color/colorPrimary</color><!-- Navigation Drawer (Light Theme) --><color name=""navdrawer_background_light"">@android:color/white</color><color name=""navdrawer_text_color_light"">@color/body_text_1_light</color><color name=""navdrawer_icon_tint_light"">#888</color><color name=""navdrawer_background_color_selected_light"">#11000000</color><!-- Navigation Drawer (Dark Theme) --><color name=""navdrawer_background_dark"">@color/cardview_dark_background</color><color name=""navdrawer_text_color_dark"">@color/body_text_1_dark</color><color name=""navdrawer_icon_tint_dark"">#888</color><color name=""navdrawer_background_color_selected_dark"">#99000000</color><!-- Text colors --><color name=""body_text_1_light"">#de000000</color><color name=""body_text_2_light"">#8a000000</color><color name=""body_text_1_dark"">#deffffff</color><!-- GNSS Sky View --><color name=""not_in_view_sat"">#11000000</color></resources>",gpstest/GPSTest/src/main/res/values/colors.xml
1147,"<?xml version=""1.0"" encoding=""utf-8""?><!-- Copyright (C) 2008 The Android Open Source ProjectLicensed under the Apache License, Version 2.0 (the ""License"");you may not use this file except in compliance with the License.You may obtain a copy of the License athttp://www.apache.org/licenses/LICENSE-2.0Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an ""AS IS"" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.--><resources><!-- Base application theme --><style name=""AppTheme"" parent=""Theme.AppCompat.Light.DarkActionBar""><!-- Customize your theme here. --><item name=""colorPrimary"">@color/colorPrimary</item><item name=""colorPrimaryDark"">@color/colorPrimaryDark</item><item name=""colorAccent"">@color/colorAccent</item></style><style name=""AppTheme.Dark"" parent=""Theme.AppCompat""><!-- Customize your theme here. --><item name=""colorPrimary"">@color/colorPrimary</item><item name=""colorPrimaryDark"">@color/colorPrimaryDark</item><item name=""colorAccent"">@color/colorAccent</item></style><style name=""AppTheme.NoActionBar""><item name=""windowActionBar"">false</item><item name=""windowNoTitle"">true</item></style><style name=""AppTheme.Dark.NoActionBar""><item name=""windowActionBar"">false</item><item name=""windowNoTitle"">true</item></style><style name=""AppTheme.AppBarOverlay"" parent=""ThemeOverlay.AppCompat.Dark.ActionBar""/><style name=""AppTheme.PopupOverlay"" parent=""ThemeOverlay.AppCompat.Light""/><style name=""AppTheme.PopupOverlay.Dark"" parent=""ThemeOverlay.AppCompat.Light""/><style name=""AppTheme.Preferences"" parent=""Theme.AppCompat.Light.DarkActionBar""><!-- Customize your theme here. --><item name=""colorPrimary"">@color/colorPrimary</item><item name=""colorPrimaryDark"">@color/colorPrimaryDark</item><item name=""colorAccent"">@color/colorAccent</item></style><!-- Navigation Drawer --><style name=""NavDrawerListItem.Light"" parent=""Widget.AppCompat.ListView.Menu""><item name=""android:background"">@drawable/navdrawer_item_selectable_light</item><item name=""android:shape"">oval</item></style><!-- Dark style is set programmatically in NavigationDrawerFragment instead of via style - see #119 --><!-- GNSS Status view --><style name=""info_label""><item name=""android:layout_height"">wrap_content</item><item name=""android:layout_width"">wrap_content</item><item name=""android:textSize"">@dimen/status_text_size</item><item name=""android:textStyle"">bold</item><item name=""android:paddingRight"">4dip</item></style><style name=""info_value""><item name=""android:layout_height"">wrap_content</item><item name=""android:layout_width"">wrap_content</item><item name=""android:textSize"">@dimen/status_text_size</item><item name=""android:textStyle"">normal</item></style></resources>",gpstest/GPSTest/src/main/res/values/styles.xml
128,"/** Copyright (C) 2017-2020 Jakob Nixdorf* Copyright (C) 2015 Bruno Bierbaumer** Permission is hereby granted, free of charge, to any person obtaining a copy* of this software and associated documentation files (the ""Software""), to deal* in the Software without restriction, including without limitation the rights* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell* copies of the Software, and to permit persons to whom the Software is* furnished to do so, subject to the following conditions:** The above copyright notice and this permission notice shall be included in all* copies or substantial portions of the Software.** THE SOFTWARE IS PROVIDED ""AS IS"", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE* SOFTWARE.*/package org.shadowice.flocke.andotp.Activities;import android.animation.ObjectAnimator;import android.app.AlertDialog;import android.app.KeyguardManager;import android.content.DialogInterface;import android.content.Intent;import android.content.SharedPreferences;import android.content.res.Configuration;import android.os.Bundle;import android.os.CountDownTimer;import android.os.Handler;import android.preference.PreferenceManager;import androidx.core.view.GravityCompat;import androidx.drawerlayout.widget.DrawerLayout;import androidx.appcompat.app.ActionBarDrawerToggle;import androidx.lifecycle.DefaultLifecycleObserver;import androidx.lifecycle.LifecycleOwner;import androidx.lifecycle.ProcessLifecycleOwner;import androidx.recyclerview.widget.LinearLayoutManager;import androidx.recyclerview.widget.RecyclerView;import androidx.appcompat.widget.SearchView;import androidx.appcompat.widget.Toolbar;import androidx.recyclerview.widget.ItemTouchHelper;import android.text.TextUtils;import android.view.KeyEvent;import android.view.Menu;import android.view.MenuItem;import android.view.View;import android.view.WindowManager;import android.view.animation.LinearInterpolator;import android.widget.AdapterView;import android.widget.CheckedTextView;import android.widget.ListView;import android.widget.ProgressBar;import android.widget.Toast;import com.google.zxing.integration.android.IntentIntegrator;import com.google.zxing.integration.android.IntentResult;import com.leinardi.android.speeddial.SpeedDialActionItem;import com.leinardi.android.speeddial.SpeedDialView;import org.shadowice.flocke.andotp.Database.Entry;import org.shadowice.flocke.andotp.R;import org.shadowice.flocke.andotp.Utilities.Constants;import org.shadowice.flocke.andotp.Utilities.EncryptionHelper;import org.shadowice.flocke.andotp.Utilities.KeyStoreHelper;import org.shadowice.flocke.andotp.Utilities.NotificationHelper;import org.shadowice.flocke.andotp.Utilities.ScanQRCodeFromFile;import org.shadowice.flocke.andotp.Utilities.TokenCalculator;import org.shadowice.flocke.andotp.View.EntriesCardAdapter;import org.shadowice.flocke.andotp.View.ItemTouchHelper.SimpleItemTouchHelperCallback;import org.shadowice.flocke.andotp.Dialogs.ManualEntryDialog;import org.shadowice.flocke.andotp.View.TagsAdapter;import java.util.ArrayList;import java.util.HashMap;import javax.crypto.SecretKey;import static org.shadowice.flocke.andotp.Utilities.Constants.AuthMethod;import static org.shadowice.flocke.andotp.Utilities.Constants.EncryptionType;import static org.shadowice.flocke.andotp.Utilities.Constants.SortMode;public class MainActivity extends BaseActivityimplements SharedPreferences.OnSharedPreferenceChangeListener {public static long animatorDuration = 1000;private static final String INTENT_SCAN_QR = ""org.shadowice.flocke.andotp.intent.SCAN_QR"";private static final String INTENT_IMPORT_QR = ""org.shadowice.flocke.andotp.intent.IMPORT_QR"";private static final String INTENT_ENTER_DETAILS = ""org.shadowice.flocke.andotp.intent.ENTER_DETAILS"";private EntriesCardAdapter adapter;private SpeedDialView speedDial;private MenuItem sortMenu;private SimpleItemTouchHelperCallback touchHelperCallback;private EncryptionType encryptionType = EncryptionType.KEYSTORE;private boolean requireAuthentication = false;private boolean recreateActivity = false;private boolean cacheEncKey = false;private Handler handler;private Runnable handlerTask;private DrawerLayout tagsDrawerLayout;private ListView tagsDrawerListView;private TagsAdapter tagsDrawerAdapter;private ActionBarDrawerToggle tagsToggle;private String filterString;private CountDownTimer countDownTimer;// QR code scanningprivate void scanQRCode(){new IntentIntegrator(MainActivity.this).setOrientationLocked(false).setBeepEnabled(false).setCaptureActivity(SecureCaptureActivity.class).initiateScan();}private void showFirstTimeWarning() {Intent introIntent = new Intent(this, IntroScreenActivity.class);startActivityForResult(introIntent, Constants.INTENT_MAIN_INTRO);}public void authenticate(int messageId) {AuthMethod authMethod = settings.getAuthMethod();if (authMethod == AuthMethod.DEVICE) {KeyguardManager km = (KeyguardManager) getSystemService(KEYGUARD_SERVICE);if (km.isKeyguardSecure()) {Intent authIntent = km.createConfirmDeviceCredentialIntent(getString(R.string.dialog_title_auth), getString(R.string.dialog_msg_auth));startActivityForResult(authIntent, Constants.INTENT_MAIN_AUTHENTICATE);}} else if (authMethod == AuthMethod.PASSWORD || authMethod == AuthMethod.PIN) {Intent authIntent = new Intent(this, AuthenticateActivity.class);authIntent.putExtra(Constants.EXTRA_AUTH_MESSAGE, messageId);startActivityForResult(authIntent, Constants.INTENT_MAIN_AUTHENTICATE);}}private void restoreSortMode() {if (settings != null && adapter != null && touchHelperCallback != null) {SortMode mode = settings.getSortMode();adapter.setSortMode(mode);if (mode == SortMode.UNSORTED)touchHelperCallback.setDragEnabled(true);elsetouchHelperCallback.setDragEnabled(false);}}private void saveSortMode(SortMode mode) {if (settings != null)settings.setSortMode(mode);}private void populateAdapter() {adapter.loadEntries();tagsDrawerAdapter.setTags(TagsAdapter.createTagsMap(adapter.getEntries(), settings));adapter.filterByTags(tagsDrawerAdapter.getActiveTags());}// Initialize the main application@Overrideprotected void onCreate(Bundle savedInstanceState) {super.onCreate(savedInstanceState);setTitle(R.string.app_name);if (! settings.getScreenshotsEnabled())getWindow().setFlags(WindowManager.LayoutParams.FLAG_SECURE, WindowManager.LayoutParams.FLAG_SECURE);setContentView(R.layout.activity_main);Toolbar toolbar = findViewById(R.id.toolbar);setSupportActionBar(toolbar);PreferenceManager.setDefaultValues(this, R.xml.preferences, false);settings.registerPreferenceChangeListener(this);encryptionType = settings.getEncryption();if (settings.getAuthMethod() != AuthMethod.NONE && savedInstanceState == null)requireAuthentication = true;setBroadcastCallback(new BroadcastReceivedCallback() {@Overridepublic void onReceivedScreenOff() {if (settings.getRelockOnScreenOff() && settings.getAuthMethod() != AuthMethod.NONE)requireAuthentication = true;}});ProcessLifecycleOwner.get().getLifecycle().addObserver(new ProcessLifecycleObserver());if (! settings.getFirstTimeWarningShown()) {showFirstTimeWarning();}speedDial = findViewById(R.id.speedDial);speedDial.inflate(R.menu.menu_fab);speedDial.getMainFab().setContentDescription(getString(R.string.button_add));speedDial.setOnActionSelectedListener(new SpeedDialView.OnActionSelectedListener() {@Overridepublic boolean onActionSelected(SpeedDialActionItem speedDialActionItem) {switch (speedDialActionItem.getId()) {case R.id.fabScanQR:scanQRCode();return false;case R.id.fabEnterDetails:ManualEntryDialog.show(MainActivity.this, settings, adapter);return false;case R.id.fabScanQRFromImage:showOpenFileSelector(Constants.INTENT_MAIN_QR_OPEN_IMAGE);return false;default:return false;}}});speedDial.setOnChangeListener(new SpeedDialView.OnChangeListener() {@Overridepublic boolean onMainActionSelected() {return false;}@Overridepublic void onToggleChanged(boolean isOpen) {if (isOpen) {speedDial.getMainFab().setContentDescription(getString(R.string.button_close_menu));} else {speedDial.getMainFab().setContentDescription(getString(R.string.button_add));}}});final ProgressBar progressBar = findViewById(R.id.progressBar);progressBar.setVisibility(settings.isHideGlobalTimeoutEnabled() ? View.GONE : View.VISIBLE);RecyclerView recList = findViewById(R.id.cardList);recList.setHasFixedSize(true);LinearLayoutManager llm = new LinearLayoutManager(this);llm.setOrientation(LinearLayoutManager.VERTICAL);recList.setLayoutManager(llm);tagsDrawerAdapter = new TagsAdapter(this, new HashMap<String, Boolean>());adapter = new EntriesCardAdapter(this, tagsDrawerAdapter);if (savedInstanceState != null) {byte[] encKey = savedInstanceState.getByteArray(""encKey"");if (encKey != null) {adapter.setEncryptionKey(EncryptionHelper.generateSymmetricKey(encKey));requireAuthentication = false;}}recList.setAdapter(adapter);touchHelperCallback = new SimpleItemTouchHelperCallback(adapter);ItemTouchHelper touchHelper = new ItemTouchHelper(touchHelperCallback);touchHelper.attachToRecyclerView(recList);NotificationHelper.initializeNotificationChannels(this);restoreSortMode();float durationScale = android.provider.Settings.Global.getFloat(this.getContentResolver(), android.provider.Settings.Global.ANIMATOR_DURATION_SCALE, 0);if (durationScale == 0)durationScale = 1;animatorDuration = (long) (1000 / durationScale);adapter.setCallback(new EntriesCardAdapter.Callback() {@Overridepublic void onMoveEventStart() {stopUpdater();}@Overridepublic void onMoveEventStop() {startUpdater();}});handler = new Handler();handlerTask = new Runnable(){@Overridepublic void run() {if (!settings.isHideGlobalTimeoutEnabled()) {int progress = (int) (TokenCalculator.TOTP_DEFAULT_PERIOD - (System.currentTimeMillis() / 1000) % TokenCalculator.TOTP_DEFAULT_PERIOD);progressBar.setProgress(progress * 100);ObjectAnimator animation = ObjectAnimator.ofInt(progressBar, ""progress"", (progress - 1) * 100);animation.setDuration(animatorDuration);animation.setInterpolator(new LinearInterpolator());animation.start();}adapter.updateTimeBasedTokens();handler.postDelayed(this, 1000);}};setupDrawer();if (savedInstanceState != null) {setFilterString(savedInstanceState.getString(""filterString"", """"));}}private void checkIntent() {Intent callingIntent = getIntent();if (callingIntent != null && callingIntent.getAction() != null) {// Cache and reset the action to prevent the same intent from being evaluated multiple timesString intentAction = callingIntent.getAction();callingIntent.setAction(null);if (intentAction.equals(INTENT_SCAN_QR)) {scanQRCode();} else if (intentAction.equals(INTENT_IMPORT_QR)) {showOpenFileSelector(Constants.INTENT_MAIN_QR_OPEN_IMAGE);} else if (intentAction.equals(INTENT_ENTER_DETAILS)) {ManualEntryDialog.show(MainActivity.this, settings, adapter);} else if (intentAction.equals(Intent.ACTION_VIEW)) {try {Entry entry = new Entry(callingIntent.getDataString());entry.updateOTP();entry.setLastUsed(System.currentTimeMillis());adapter.addEntry(entry);Toast.makeText(this, R.string.toast_intent_creation_succeeded, Toast.LENGTH_LONG).show();} catch (Exception e) {Toast.makeText(this, R.string.toast_intent_creation_failed, Toast.LENGTH_LONG).show();}}}}@Overrideprotected void onPostCreate(Bundle savedInstanceState) {super.onPostCreate(savedInstanceState);tagsToggle.syncState();}// Controls for the updater background taskpublic void stopUpdater() {handler.removeCallbacks(handlerTask);}public void startUpdater() {handler.post(handlerTask);}@Overridepublic void onResume() {super.onResume();if (requireAuthentication) {if (settings.getAuthMethod() != AuthMethod.NONE) {requireAuthentication = false;authenticate(R.string.auth_msg_authenticate);}} else {if (settings.getFirstTimeWarningShown()) {if (adapter.getEncryptionKey() == null) {updateEncryption(null);} else {populateAdapter();}checkIntent();}if (setCountDownTimerNow())countDownTimer.start();}if (filterString != null) {// ensure the current filter string is applied after a resumesetFilterString(this.filterString);}View cardList = findViewById(R.id.cardList);if(cardList.getVisibility() == View.INVISIBLE)cardList.setVisibility(View.VISIBLE);startUpdater();}@Overridepublic void onPause() {if(settings.getAuthMethod() == AuthMethod.DEVICE)runOnUiThread(new Runnable() {@Overridepublic void run() {findViewById(R.id.cardList).setVisibility(View.INVISIBLE);}});super.onPause();stopUpdater();if (countDownTimer != null)countDownTimer.cancel();}@Overrideprotected void onSaveInstanceState(Bundle outState) {super.onSaveInstanceState(outState);outState.putString(""filterString"", filterString);if (cacheEncKey) {outState.putByteArray(""encKey"", adapter.getEncryptionKey().getEncoded());cacheEncKey = false;}}public void onSharedPreferenceChanged(SharedPreferences prefs, String key) {if (key.equals(getString(R.string.settings_key_label_size)) ||key.equals(getString(R.string.settings_key_label_scroll)) ||key.equals(getString(R.string.settings_key_split_group_size)) ||key.equals(getString(R.string.settings_key_thumbnail_size))) {adapter.notifyDataSetChanged();} else if (key.equals(getString(R.string.settings_key_search_includes))) {adapter.clearFilter();} else if (key.equals(getString(R.string.settings_key_tap_single)) ||key.equals(getString(R.string.settings_key_tap_double)) ||key.equals(getString(R.string.settings_key_theme)) ||key.equals(getString(R.string.settings_key_lang)) ||key.equals(getString(R.string.settings_key_enable_screenshot)) ||key.equals(getString(R.string.settings_key_tag_functionality)) ||key.equals(getString(R.string.settings_key_label_highlight_token)) ||key.equals(getString(R.string.settings_key_card_layout)) ||key.equals(getString(R.string.settings_key_hide_global_timeout))) {recreateActivity = true;}}@Overridepublic void onConfigurationChanged(Configuration newConfig) {super.onConfigurationChanged(newConfig);tagsToggle.onConfigurationChanged(newConfig);}// Activity results@Overrideprotected void onActivityResult(int requestCode, int resultCode, Intent intent) {super.onActivityResult(requestCode, resultCode, intent);IntentResult result = IntentIntegrator.parseActivityResult(requestCode, resultCode, intent);if(result != null) {if(result.getContents() != null) {addQRCode(result.getContents());}} else if (requestCode == Constants.INTENT_MAIN_BACKUP && resultCode == RESULT_OK) {if (intent.getBooleanExtra(""reload"", false)) {adapter.loadEntries();refreshTags();}} else if (requestCode == Constants.INTENT_MAIN_SETTINGS && resultCode == RESULT_OK) {boolean encryptionChanged = intent.getBooleanExtra(Constants.EXTRA_SETTINGS_ENCRYPTION_CHANGED, false);byte[] newKey = intent.getByteArrayExtra(Constants.EXTRA_SETTINGS_ENCRYPTION_KEY);if (encryptionChanged)updateEncryption(newKey);if (recreateActivity) {cacheEncKey = true;recreate();}} else if (requestCode == Constants.INTENT_MAIN_AUTHENTICATE) {if (resultCode != RESULT_OK) {Toast.makeText(getBaseContext(), R.string.toast_auth_failed_fatal, Toast.LENGTH_LONG).show();finishAndRemoveTask();} else {requireAuthentication = false;byte[] authKey = null;if (intent != null)authKey = intent.getByteArrayExtra(Constants.EXTRA_AUTH_PASSWORD_KEY);updateEncryption(authKey);}} else if (requestCode == Constants.INTENT_MAIN_QR_OPEN_IMAGE && resultCode == RESULT_OK) {if (intent != null) {addQRCode(ScanQRCodeFromFile.scanQRImage(this, intent.getData()));}}}private void updateEncryption(byte[] newKey) {SecretKey encryptionKey = null;encryptionType = settings.getEncryption();if (encryptionType == EncryptionType.KEYSTORE) {encryptionKey = KeyStoreHelper.loadEncryptionKeyFromKeyStore(this, false);} else if (encryptionType == EncryptionType.PASSWORD) {if (newKey != null && newKey.length > 0) {encryptionKey = EncryptionHelper.generateSymmetricKey(newKey);} else {authenticate(R.string.auth_msg_confirm_encryption);}}if (encryptionKey != null)adapter.setEncryptionKey(encryptionKey);populateAdapter();}// Options menu@Overridepublic boolean onCreateOptionsMenu(Menu menu) {getMenuInflater().inflate(R.menu.menu_main, menu);sortMenu = menu.findItem(R.id.menu_sort);if (adapter != null) {SortMode mode = adapter.getSortMode();if (mode == SortMode.UNSORTED) {sortMenu.setIcon(R.drawable.ic_sort_inverted_white);menu.findItem(R.id.menu_sort_none).setChecked(true);} else if (mode == SortMode.ISSUER) {sortMenu.setIcon(R.drawable.ic_sort_inverted_label_white);menu.findItem(R.id.menu_sort_issuer).setChecked(true);} else if (mode == SortMode.LABEL) {sortMenu.setIcon(R.drawable.ic_sort_inverted_label_white);menu.findItem(R.id.menu_sort_label).setChecked(true);} else if (mode == SortMode.LAST_USED) {sortMenu.setIcon(R.drawable.ic_sort_inverted_time_white);menu.findItem(R.id.menu_sort_last_used).setChecked(true);} else if (mode == SortMode.MOST_USED) {sortMenu.setIcon(R.drawable.ic_sort_inverted_time_white);menu.findItem(R.id.menu_sort_most_used).setChecked(true);}}MenuItem searchItem = menu.findItem(R.id.menu_search);SearchView searchView = (SearchView) searchItem.getActionView();searchView.setOnQueryTextListener(new SearchView.OnQueryTextListener() {@Overridepublic boolean onQueryTextSubmit(String query) {return false;}@Overridepublic boolean onQueryTextChange(String newText) {setFilterString(newText);return false;}});searchItem.setOnActionExpandListener(new MenuItem.OnActionExpandListener() {@Overridepublic boolean onMenuItemActionExpand(MenuItem menuItem) {speedDial.setVisibility(View.GONE);touchHelperCallback.setDragEnabled(false);if (sortMenu != null)sortMenu.setVisible(false);return true;}@Overridepublic boolean onMenuItemActionCollapse(MenuItem menuItem) {speedDial.setVisibility(View.VISIBLE);if (adapter == null || adapter.getSortMode() == SortMode.UNSORTED)touchHelperCallback.setDragEnabled(true);if (sortMenu != null)sortMenu.setVisible(true);return true;}});return true;}private void setFilterString(String newText) {if (newText.isEmpty())adapter.filterByTags(tagsDrawerAdapter.getActiveTags());elseadapter.getFilter().filter(newText);this.filterString = newText;}@Overridepublic boolean onOptionsItemSelected(MenuItem item) {int id = item.getItemId();if (id == R.id.action_backup) {Intent backupIntent = new Intent(this, BackupActivity.class);backupIntent.putExtra(Constants.EXTRA_BACKUP_ENCRYPTION_KEY, adapter.getEncryptionKey().getEncoded());startActivityForResult(backupIntent, Constants.INTENT_MAIN_BACKUP);} else if (id == R.id.action_settings) {Intent settingsIntent = new Intent(this, SettingsActivity.class);if (adapter.getEncryptionKey() != null)settingsIntent.putExtra(Constants.EXTRA_SETTINGS_ENCRYPTION_KEY, adapter.getEncryptionKey().getEncoded());startActivityForResult(settingsIntent, Constants.INTENT_MAIN_SETTINGS);} else if (id == R.id.action_about){Intent aboutIntent = new Intent(this, AboutActivity.class);startActivity(aboutIntent);return true;} else if (id == R.id.menu_sort_none) {item.setChecked(true);sortMenu.setIcon(R.drawable.ic_sort_inverted_white);saveSortMode(SortMode.UNSORTED);if (adapter != null) {adapter.setSortMode(SortMode.UNSORTED);touchHelperCallback.setDragEnabled(true);}} else if (id == R.id.menu_sort_issuer) {item.setChecked(true);sortMenu.setIcon(R.drawable.ic_sort_inverted_label_white);saveSortMode(SortMode.ISSUER);if(adapter != null) {adapter.setSortMode(SortMode.ISSUER);touchHelperCallback.setDragEnabled(false);}} else if (id == R.id.menu_sort_label) {item.setChecked(true);sortMenu.setIcon(R.drawable.ic_sort_inverted_label_white);saveSortMode(SortMode.LABEL);if (adapter != null) {adapter.setSortMode(SortMode.LABEL);touchHelperCallback.setDragEnabled(false);}} else if (id == R.id.menu_sort_last_used) {item.setChecked(true);sortMenu.setIcon(R.drawable.ic_sort_inverted_time_white);saveSortMode(SortMode.LAST_USED);if (adapter != null) {adapter.setSortMode(SortMode.LAST_USED);touchHelperCallback.setDragEnabled(false);}if (! settings.getUsedTokensDialogShown())showUsedTokensDialog();} else if (id == R.id.menu_sort_most_used) {item.setChecked(true);sortMenu.setIcon(R.drawable.ic_sort_inverted_time_white);saveSortMode(SortMode.MOST_USED);if (adapter != null) {adapter.setSortMode(SortMode.MOST_USED);touchHelperCallback.setDragEnabled(false);}if (! settings.getUsedTokensDialogShown())showUsedTokensDialog();} else if (tagsToggle.onOptionsItemSelected(item)) {return true;}return super.onOptionsItemSelected(item);}private void showUsedTokensDialog() {AlertDialog.Builder builder = new AlertDialog.Builder(this);builder.setTitle(R.string.dialog_title_used_tokens).setMessage(R.string.dialog_msg_used_tokens).setPositiveButton(android.R.string.ok, (DialogInterface dialogInterface, int i) -> settings.setUsedTokensDialogShown(true)).create().show();}private void setupDrawer() {tagsDrawerListView = findViewById(R.id.tags_list_in_drawer);tagsDrawerLayout = findViewById(R.id.drawer_layout);tagsToggle = new ActionBarDrawerToggle(this, tagsDrawerLayout, R.string.drawer_open, R.string.drawer_close) {@Overridepublic void onDrawerOpened(View drawerView) {super.onDrawerOpened(drawerView);getSupportActionBar().setTitle(R.string.label_tags);invalidateOptionsMenu();}@Overridepublic void onDrawerClosed(View view) {super.onDrawerClosed(view);getSupportActionBar().setTitle(R.string.app_name);invalidateOptionsMenu();}};tagsToggle.setDrawerIndicatorEnabled(true);tagsDrawerLayout.addDrawerListener(tagsToggle);final CheckedTextView noTagsButton = findViewById(R.id.no_tags_entries);final CheckedTextView allTagsButton = findViewById(R.id.all_tags_in_drawer);allTagsButton.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View view) {CheckedTextView checkedTextView = ((CheckedTextView)view);checkedTextView.setChecked(!checkedTextView.isChecked());settings.setAllTagsToggle(checkedTextView.isChecked());for(int i = 0; i < tagsDrawerListView.getChildCount(); i++) {CheckedTextView childCheckBox = (CheckedTextView) tagsDrawerListView.getChildAt(i);childCheckBox.setChecked(checkedTextView.isChecked());}for (String tag: tagsDrawerAdapter.getTags()) {tagsDrawerAdapter.setTagState(tag, checkedTextView.isChecked());settings.setTagToggle(tag, checkedTextView.isChecked());}if(checkedTextView.isChecked()) {adapter.filterByTags(tagsDrawerAdapter.getActiveTags());} else {adapter.filterByTags(new ArrayList<String>());}}});allTagsButton.setChecked(settings.getAllTagsToggle());noTagsButton.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View view) {CheckedTextView checkedTextView = ((CheckedTextView)view);checkedTextView.setChecked(!checkedTextView.isChecked());if(settings.getTagFunctionality() == Constants.TagFunctionality.SINGLE) {checkedTextView.setChecked(true);allTagsButton.setChecked(false);settings.setAllTagsToggle(false);for (String tag: tagsDrawerAdapter.getTags()) {settings.setTagToggle(tag, false);tagsDrawerAdapter.setTagState(tag, false);}}settings.setNoTagsToggle(checkedTextView.isChecked());adapter.filterByTags(tagsDrawerAdapter.getActiveTags());}});noTagsButton.setChecked(settings.getNoTagsToggle());tagsDrawerListView.setAdapter(tagsDrawerAdapter);tagsDrawerListView.setOnItemClickListener(new AdapterView.OnItemClickListener() {@Overridepublic void onItemClick(AdapterView<?> parent, View view, int position, long id) {CheckedTextView checkedTextView = ((CheckedTextView)view);if(settings.getTagFunctionality() == Constants.TagFunctionality.SINGLE) {allTagsButton.setChecked(false);settings.setAllTagsToggle(false);noTagsButton.setChecked(false);settings.setNoTagsToggle(false);for (String tag: tagsDrawerAdapter.getTags()) {settings.setTagToggle(tag, false);tagsDrawerAdapter.setTagState(tag, false);}checkedTextView.setChecked(true);}else {checkedTextView.setChecked(!checkedTextView.isChecked());}settings.setTagToggle(checkedTextView.getText().toString(), checkedTextView.isChecked());tagsDrawerAdapter.setTagState(checkedTextView.getText().toString(), checkedTextView.isChecked());if (! checkedTextView.isChecked()) {allTagsButton.setChecked(false);settings.setAllTagsToggle(false);}if (tagsDrawerAdapter.allTagsActive()) {allTagsButton.setChecked(true);settings.setAllTagsToggle(true);}adapter.filterByTags(tagsDrawerAdapter.getActiveTags());}});adapter.filterByTags(tagsDrawerAdapter.getActiveTags());}public void refreshTags() {HashMap<String, Boolean> tagsHashMap = new HashMap<>();for(String tag: tagsDrawerAdapter.getTags()) {tagsHashMap.put(tag, false);}for(String tag: tagsDrawerAdapter.getActiveTags()) {tagsHashMap.put(tag, true);}for(String tag: adapter.getTags()) {if(!tagsHashMap.containsKey(tag))tagsHashMap.put(tag, true);}tagsDrawerAdapter.setTags(tagsHashMap);adapter.filterByTags(tagsDrawerAdapter.getActiveTags());}@Overridepublic void onUserInteraction(){super.onUserInteraction();// Refresh Blackout Timerif (countDownTimer != null)countDownTimer.cancel();if (setCountDownTimerNow())countDownTimer.start();}private boolean setCountDownTimerNow() {int secondsToBlackout = 1000 * settings.getAuthInactivityDelay();if (settings.getAuthMethod() == AuthMethod.NONE || !settings.getAuthInactivity() || secondsToBlackout == 0)return false;countDownTimer = new CountDownTimer(secondsToBlackout, 1000) {@Overridepublic void onTick(long millisUntilFinished) {}@Overridepublic void onFinish() {authenticate(R.string.auth_msg_authenticate);this.cancel();}};return true;}private void showOpenFileSelector(int intentId){Intent intent = new Intent(Intent.ACTION_OPEN_DOCUMENT);intent.addCategory(Intent.CATEGORY_OPENABLE);intent.setType(""image/*"");startActivityForResult(intent, intentId);}private void addQRCode(String result){if(!TextUtils.isEmpty(result)) {try {Entry e = new Entry(result);e.updateOTP();e.setLastUsed(System.currentTimeMillis());adapter.addEntry(e);refreshTags();} catch (Exception e) {Toast.makeText(this, R.string.toast_invalid_qr_code, Toast.LENGTH_LONG).show();}}}private class ProcessLifecycleObserver implements DefaultLifecycleObserver {@Overridepublic void onStop(LifecycleOwner owner) {if (MainActivity.this.settings.getRelockOnBackground())MainActivity.this.requireAuthentication = true;}}@Overridepublic boolean onKeyDown(int keyCode, KeyEvent event) {if (keyCode == KeyEvent.KEYCODE_BACK) {if (speedDial.isOpen()) {speedDial.close();return true;}if (tagsDrawerLayout.isDrawerOpen(GravityCompat.START)) {tagsDrawerLayout.closeDrawer(GravityCompat.START);return true;}return super.onKeyDown(keyCode, event);}return super.onKeyDown(keyCode, event);}@Overrideprotected void onDestroy() {settings.unregisterPreferenceChangeListener(this);super.onDestroy();}}",andOTP/app/src/main/java/org/shadowice/flocke/andotp/Activities/MainActivity.java
128,"/** Copyright (C) 2017-2020 Jakob Nixdorf** Permission is hereby granted, free of charge, to any person obtaining a copy* of this software and associated documentation files (the ""Software""), to deal* in the Software without restriction, including without limitation the rights* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell* copies of the Software, and to permit persons to whom the Software is* furnished to do so, subject to the following conditions:** The above copyright notice and this permission notice shall be included in all* copies or substantial portions of the Software.** THE SOFTWARE IS PROVIDED ""AS IS"", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE* SOFTWARE.*/package org.shadowice.flocke.andotp.Activities;import android.app.backup.BackupManager;import android.app.AlertDialog;import android.content.DialogInterface;import android.content.Intent;import android.content.SharedPreferences;import android.net.Uri;import android.os.Build;import android.os.Bundle;import android.preference.CheckBoxPreference;import android.preference.EditTextPreference;import android.preference.ListPreference;import android.preference.Preference;import android.preference.PreferenceCategory;import android.preference.PreferenceFragment;import android.preference.PreferenceManager;import androidx.appcompat.widget.Toolbar;import android.provider.DocumentsContract;import android.view.ViewStub;import android.widget.Toast;import org.openintents.openpgp.util.OpenPgpAppPreference;import org.openintents.openpgp.util.OpenPgpKeyPreference;import org.shadowice.flocke.andotp.Database.Entry;import org.shadowice.flocke.andotp.Preferences.CredentialsPreference;import org.shadowice.flocke.andotp.R;import org.shadowice.flocke.andotp.Utilities.BackupHelper;import org.shadowice.flocke.andotp.Utilities.Constants;import org.shadowice.flocke.andotp.Utilities.DatabaseHelper;import org.shadowice.flocke.andotp.Utilities.EncryptionHelper;import org.shadowice.flocke.andotp.Utilities.KeyStoreHelper;import org.shadowice.flocke.andotp.Utilities.Settings;import org.shadowice.flocke.andotp.Utilities.UIHelper;import java.util.ArrayList;import java.util.Locale;import javax.crypto.SecretKey;import static org.shadowice.flocke.andotp.Utilities.Constants.AuthMethod;import static org.shadowice.flocke.andotp.Utilities.Constants.EncryptionType;public class SettingsActivity extends BaseActivityimplements SharedPreferences.OnSharedPreferenceChangeListener{private SettingsFragment fragment;private SharedPreferences prefs;private SecretKey encryptionKey = null;private boolean encryptionChanged = false;@Overrideprotected void onCreate(Bundle savedInstanceState) {super.onCreate(savedInstanceState);setTitle(R.string.settings_activity_title);setContentView(R.layout.activity_container);Toolbar toolbar = findViewById(R.id.container_toolbar);setSupportActionBar(toolbar);ViewStub stub = findViewById(R.id.container_stub);stub.inflate();Intent callingIntent = getIntent();byte[] keyMaterial = callingIntent.getByteArrayExtra(Constants.EXTRA_SETTINGS_ENCRYPTION_KEY);if (keyMaterial != null && keyMaterial.length > 0)encryptionKey = EncryptionHelper.generateSymmetricKey(keyMaterial);if (savedInstanceState != null) {encryptionChanged = savedInstanceState.getBoolean(Constants.EXTRA_SETTINGS_ENCRYPTION_CHANGED, false);byte[] encKey = savedInstanceState.getByteArray(Constants.EXTRA_SETTINGS_ENCRYPTION_KEY);if (encKey != null) {encryptionKey = EncryptionHelper.generateSymmetricKey(encKey);}}fragment = new SettingsFragment();getFragmentManager().beginTransaction().replace(R.id.container_content, fragment).commit();prefs = PreferenceManager.getDefaultSharedPreferences(this);prefs.registerOnSharedPreferenceChangeListener(this);}@Overrideprotected void onSaveInstanceState(Bundle outState) {super.onSaveInstanceState(outState);outState.putBoolean(Constants.EXTRA_SETTINGS_ENCRYPTION_CHANGED, encryptionChanged);outState.putByteArray(Constants.EXTRA_SETTINGS_ENCRYPTION_KEY, encryptionKey.getEncoded());}public void finishWithResult() {Intent data = new Intent();data.putExtra(Constants.EXTRA_SETTINGS_ENCRYPTION_CHANGED, encryptionChanged);if (encryptionKey != null)data.putExtra(Constants.EXTRA_SETTINGS_ENCRYPTION_KEY, encryptionKey.getEncoded());setResult(RESULT_OK, data);finish();}@Overridepublic boolean onSupportNavigateUp() {finishWithResult();return true;}@Overridepublic void onBackPressed() {finishWithResult();super.onBackPressed();}public void onSharedPreferenceChanged(SharedPreferences prefs, String key) {BackupManager backupManager = new BackupManager(this);backupManager.dataChanged();if (key.equals(getString(R.string.settings_key_theme)) ||key.equals(getString(R.string.settings_key_lang)) ||key.equals(getString(R.string.settings_key_special_features)) ||key.equals(getString(R.string.settings_key_backup_location))) {recreate();} else if(key.equals(getString(R.string.settings_key_encryption))) {if (settings.getEncryption() != EncryptionType.PASSWORD) {if (settings.getAndroidBackupServiceEnabled()) {UIHelper.showGenericDialog(this,R.string.settings_dialog_title_android_sync,R.string.settings_dialog_msg_android_sync_disabled_encryption);}settings.setAndroidBackupServiceEnabled(false);if (fragment.useAndroidSync != null) {fragment.useAndroidSync.setEnabled(false);fragment.useAndroidSync.setChecked(false);}} else {if (fragment.useAndroidSync != null)fragment.useAndroidSync.setEnabled(true);}}fragment.updateAutoBackup();}private void generateNewEncryptionKey() {if (settings.getEncryption() == EncryptionType.KEYSTORE) {encryptionKey = KeyStoreHelper.loadEncryptionKeyFromKeyStore(this, false);encryptionChanged = true;}}private void tryEncryptionChangeWithAuth(EncryptionType newEnc) {Intent authIntent = new Intent(this, AuthenticateActivity.class);authIntent.putExtra(Constants.EXTRA_AUTH_NEW_ENCRYPTION, newEnc.name());authIntent.putExtra(Constants.EXTRA_AUTH_MESSAGE, R.string.auth_msg_confirm_encryption);startActivityForResult(authIntent, Constants.INTENT_SETTINGS_AUTHENTICATE);}private boolean tryEncryptionChange(EncryptionType newEnc, byte[] newKey) {Toast upgrading = Toast.makeText(this, R.string.settings_toast_encryption_changing, Toast.LENGTH_LONG);upgrading.show();if (DatabaseHelper.backupDatabase(this)) {ArrayList<Entry> entries;if (encryptionKey != null)entries = DatabaseHelper.loadDatabase(this, encryptionKey);elseentries = new ArrayList<>();SecretKey newEncryptionKey;if (newEnc == EncryptionType.KEYSTORE) {newEncryptionKey = KeyStoreHelper.loadEncryptionKeyFromKeyStore(this, true);} else if (newKey != null && newKey.length > 0) {newEncryptionKey = EncryptionHelper.generateSymmetricKey(newKey);} else {upgrading.cancel();DatabaseHelper.restoreDatabaseBackup(this);return false;}if (DatabaseHelper.saveDatabase(this, entries, newEncryptionKey)) {encryptionKey = newEncryptionKey;encryptionChanged = true;fragment.encryption.setValue(newEnc.name().toLowerCase());upgrading.cancel();Toast.makeText(this, R.string.settings_toast_encryption_change_success, Toast.LENGTH_LONG).show();return true;}DatabaseHelper.restoreDatabaseBackup(this);upgrading.cancel();Toast.makeText(this, R.string.settings_toast_encryption_change_failed, Toast.LENGTH_LONG).show();} else {upgrading.cancel();Toast.makeText(this, R.string.settings_toast_encryption_backup_failed, Toast.LENGTH_LONG).show();}return false;}private void requestBackupAccess() {Intent intent = new Intent(Intent.ACTION_OPEN_DOCUMENT_TREE);intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION| Intent.FLAG_GRANT_WRITE_URI_PERMISSION| Intent.FLAG_GRANT_PERSISTABLE_URI_PERMISSION| Intent.FLAG_GRANT_PREFIX_URI_PERMISSION);if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.O && settings.isBackupLocationSet())intent.putExtra(DocumentsContract.EXTRA_INITIAL_URI, settings.getBackupLocation());startActivityForResult(intent, Constants.INTENT_SETTINGS_BACKUP_LOCATION);}@Overrideprotected void onActivityResult(int requestCode, int resultCode, Intent data) {super.onActivityResult(requestCode, resultCode, data);if (requestCode == Constants.INTENT_SETTINGS_AUTHENTICATE) {if (resultCode == RESULT_OK) {byte[] authKey = data.getByteArrayExtra(Constants.EXTRA_AUTH_PASSWORD_KEY);String newEnc = data.getStringExtra(Constants.EXTRA_AUTH_NEW_ENCRYPTION);if (authKey != null && authKey.length > 0 && newEnc != null && !newEnc.isEmpty()) {EncryptionType newEncType = EncryptionType.valueOf(newEnc);tryEncryptionChange(newEncType, authKey);} else {Toast.makeText(this, R.string.settings_toast_encryption_no_key, Toast.LENGTH_LONG).show();}} else {Toast.makeText(this, R.string.settings_toast_encryption_auth_failed, Toast.LENGTH_LONG).show();}} else if (requestCode == Constants.INTENT_SETTINGS_BACKUP_LOCATION && resultCode == RESULT_OK) {Uri treeUri = data.getData();if (treeUri != null) {final int takeFlags = data.getFlags() & (Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);getContentResolver().takePersistableUriPermission(treeUri, takeFlags);settings.setBackupLocation(treeUri);}} else if (fragment.pgpSigningKey.handleOnActivityResult(requestCode, resultCode, data)) {// handled by OpenPgpKeyPreferencereturn;}}@Overrideprotected void onDestroy() {prefs.unregisterOnSharedPreferenceChangeListener(this);prefs = null;super.onDestroy();}public static class SettingsFragment extends PreferenceFragment {private PreferenceCategory catSecurity;private Settings settings;private ListPreference encryption;private Preference backupLocation;private ListPreference useAutoBackup;private CheckBoxPreference useAndroidSync;private OpenPgpAppPreference pgpProvider;private EditTextPreference pgpEncryptionKey;private OpenPgpKeyPreference pgpSigningKey;public void encryptionChangeWithDialog(final EncryptionType encryptionType) {AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());builder.setTitle(R.string.settings_dialog_title_warning).setMessage(R.string.settings_dialog_msg_encryption_change).setPositiveButton(android.R.string.ok, new DialogInterface.OnClickListener() {@Overridepublic void onClick(DialogInterface dialogInterface, int i) {if (encryptionType == EncryptionType.PASSWORD)((SettingsActivity) getActivity()).tryEncryptionChangeWithAuth(encryptionType);else if (encryptionType == EncryptionType.KEYSTORE)((SettingsActivity) getActivity()).tryEncryptionChange(encryptionType, null);}}).setNegativeButton(android.R.string.cancel, new DialogInterface.OnClickListener() {@Overridepublic void onClick(DialogInterface dialogInterface, int i) {}}).create().show();}public void updateAutoBackup() {if (useAutoBackup != null) {useAutoBackup.setEnabled(BackupHelper.autoBackupType(getActivity()) == Constants.BackupType.ENCRYPTED);if (!useAutoBackup.isEnabled())useAutoBackup.setValue(Constants.AutoBackup.OFF.toString().toLowerCase(Locale.ENGLISH));if (useAutoBackup.isEnabled()) {useAutoBackup.setSummary(R.string.settings_desc_auto_backup_password_enc);} else {useAutoBackup.setSummary(R.string.settings_desc_auto_backup_requirements);}}}@Overridepublic void onCreate(Bundle savedInstanceState) {super.onCreate(savedInstanceState);settings = new Settings(getActivity());final SharedPreferences sharedPref = PreferenceManager.getDefaultSharedPreferences(getActivity().getBaseContext());addPreferencesFromResource(R.xml.preferences);CredentialsPreference credentialsPreference = (CredentialsPreference) findPreference(getString(R.string.settings_key_auth));credentialsPreference.setEncryptionChangeCallback(new CredentialsPreference.EncryptionChangeCallback() {@Overridepublic boolean testEncryptionChange(byte[] newKey) {return ((SettingsActivity) getActivity()).tryEncryptionChange(settings.getEncryption(), newKey);}});CheckBoxPreference blockAutofill = (CheckBoxPreference) findPreference(getString(R.string.settings_key_block_autofill));if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {blockAutofill.setEnabled(true);blockAutofill.setSummary(R.string.settings_desc_block_autofill);} else {blockAutofill.setEnabled(false);blockAutofill.setSummary(R.string.settings_desc_block_autofill_android);}// AuthenticationcatSecurity = (PreferenceCategory) findPreference(getString(R.string.settings_key_cat_security));encryption = (ListPreference) findPreference(getString(R.string.settings_key_encryption));encryption.setOnPreferenceChangeListener(new Preference.OnPreferenceChangeListener() {@Overridepublic boolean onPreferenceChange(final Preference preference, Object o) {String newEncryption = (String) o;EncryptionType encryptionType = EncryptionType.valueOf(newEncryption.toUpperCase());EncryptionType oldEncryptionType = settings.getEncryption();AuthMethod authMethod = settings.getAuthMethod();if (encryptionType != oldEncryptionType) {if (encryptionType == EncryptionType.PASSWORD) {if (authMethod != AuthMethod.PASSWORD && authMethod != AuthMethod.PIN) {UIHelper.showGenericDialog(getActivity(), R.string.settings_dialog_title_error, R.string.settings_dialog_msg_encryption_invalid_with_auth);return false;} else {if (settings.getAuthCredentials().isEmpty()) {UIHelper.showGenericDialog(getActivity(), R.string.settings_dialog_title_error, R.string.settings_dialog_msg_encryption_invalid_without_credentials);return false;}}encryptionChangeWithDialog(EncryptionType.PASSWORD);} else if (encryptionType == EncryptionType.KEYSTORE) {encryptionChangeWithDialog(EncryptionType.KEYSTORE);}}return false;}});// Backup locationbackupLocation = findPreference(getString(R.string.settings_key_backup_location));if (settings.isBackupLocationSet()) {backupLocation.setSummary(R.string.settings_desc_backup_location_set);} else {backupLocation.setSummary(R.string.settings_desc_backup_location);}backupLocation.setOnPreferenceClickListener(new Preference.OnPreferenceClickListener() {@Overridepublic boolean onPreferenceClick(Preference preference) {((SettingsActivity) getActivity()).requestBackupAccess();return true;}});// OpenPGPpgpProvider = (OpenPgpAppPreference) findPreference(getString(R.string.settings_key_openpgp_provider));pgpEncryptionKey = (EditTextPreference) findPreference(getString(R.string.settings_key_openpgp_key_encrypt));pgpSigningKey = (OpenPgpKeyPreference) findPreference(getString(R.string.settings_key_openpgp_key_sign));pgpSigningKey.setOpenPgpProvider(pgpProvider.getValue());if (pgpProvider.getValue() != null && ! pgpProvider.getValue().isEmpty()) {pgpEncryptionKey.setEnabled(true);} else {pgpEncryptionKey.setEnabled(false);}pgpProvider.setOnPreferenceChangeListener(new Preference.OnPreferenceChangeListener() {@Overridepublic boolean onPreferenceChange(Preference preference, Object newValue) {if (newValue != null && ! ((String) newValue).isEmpty()) {pgpEncryptionKey.setEnabled(true);} else {pgpEncryptionKey.setEnabled(false);}pgpSigningKey.setOpenPgpProvider((String) newValue);return true;}});useAutoBackup = (ListPreference)findPreference(getString(R.string.settings_key_auto_backup_password_enc));updateAutoBackup();useAndroidSync = (CheckBoxPreference) findPreference(getString(R.string.settings_key_enable_android_backup_service));useAndroidSync.setEnabled(settings.getEncryption() == EncryptionType.PASSWORD);if(!useAndroidSync.isEnabled())useAndroidSync.setChecked(false);if (sharedPref.contains(getString(R.string.settings_key_special_features)) &&sharedPref.getBoolean(getString(R.string.settings_key_special_features), false)) {addPreferencesFromResource(R.xml.preferences_special);Preference clearKeyStore = findPreference(getString(R.string.settings_key_clear_keystore));clearKeyStore.setOnPreferenceClickListener(new Preference.OnPreferenceClickListener() {@Overridepublic boolean onPreferenceClick(Preference preference) {AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());builder.setTitle(R.string.settings_dialog_title_clear_keystore);if (settings.getEncryption() == EncryptionType.PASSWORD)builder.setMessage(R.string.settings_dialog_msg_clear_keystore_password);else if (settings.getEncryption() == EncryptionType.KEYSTORE)builder.setMessage(R.string.settings_dialog_msg_clear_keystore_keystore);builder.setPositiveButton(android.R.string.ok, new DialogInterface.OnClickListener() {@Overridepublic void onClick(DialogInterface dialogInterface, int i) {KeyStoreHelper.wipeKeys(getActivity());if (settings.getEncryption() == EncryptionType.KEYSTORE) {DatabaseHelper.wipeDatabase(getActivity());((SettingsActivity) getActivity()).generateNewEncryptionKey();}}});builder.setNegativeButton(android.R.string.cancel, new DialogInterface.OnClickListener() {@Overridepublic void onClick(DialogInterface dialogInterface, int i) {}});builder.create().show();return false;}});}}}}",andOTP/app/src/main/java/org/shadowice/flocke/andotp/Activities/SettingsActivity.java
128,"/** Copyright (C) 2017-2020 Jakob Nixdorf** Permission is hereby granted, free of charge, to any person obtaining a copy* of this software and associated documentation files (the ""Software""), to deal* in the Software without restriction, including without limitation the rights* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell* copies of the Software, and to permit persons to whom the Software is* furnished to do so, subject to the following conditions:** The above copyright notice and this permission notice shall be included in all* copies or substantial portions of the Software.** THE SOFTWARE IS PROVIDED ""AS IS"", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE* SOFTWARE.*/package org.shadowice.flocke.andotp.Utilities;import android.content.Context;import android.content.SharedPreferences;import android.net.Uri;import android.preference.PreferenceManager;import android.util.Base64;import org.shadowice.flocke.andotp.Preferences.CredentialsPreference;import org.shadowice.flocke.andotp.R;import java.nio.charset.StandardCharsets;import java.security.KeyPair;import java.security.NoSuchAlgorithmException;import java.security.spec.InvalidKeySpecException;import java.util.ArrayList;import java.util.Arrays;import java.util.Collections;import java.util.HashSet;import java.util.List;import java.util.Locale;import java.util.Set;import static org.shadowice.flocke.andotp.Utilities.Constants.AuthMethod;import static org.shadowice.flocke.andotp.Utilities.Constants.EncryptionType;import static org.shadowice.flocke.andotp.Utilities.Constants.SortMode;public class Settings {private static final List<String> newLangs = Arrays.asList(""ar"",    ""bg"",    ""ca"",    ""cs"",    ""de"",    ""el"",    ""en"",    ""es"",    ""fa"",    ""fr"",    ""gl"",    ""hi"",    ""hu"",    ""it"",    ""ja"",    ""nl"",    ""pl"",    ""pt_BR"", ""ru"",    ""sl"",    ""sv"",    ""tr"",    ""uk"",    ""zh_CN"", ""zh_TW"");private static final List<String> oldLangs = Arrays.asList(""ar_SA"", ""bg_BG"", ""ca_ES"", ""cs_CZ"", ""de_DE"", ""el_GR"", ""en_US"", ""es_ES"", ""fa_IR"", ""fr_FR"", ""gl_ES"", ""hi_IN"", ""hu_HU"", ""it_IT"", ""ja_JP"", ""nl_NL"", ""pl_PL"", ""pt_BR"", ""ru_RU"", ""sl_SI"", ""sv_SE"", ""tr_TR"", ""uk_UA"", ""zh_CN"", ""zh_TW"");private Context context;private SharedPreferences settings;public Settings(Context context) {this.context = context;this.settings = PreferenceManager.getDefaultSharedPreferences(context);migrateDeprecatedSettings();}private void migrateDeprecatedSettings() {if (settings.contains(getResString(R.string.settings_key_auth_password))) {setAuthCredentials(getString(R.string.settings_key_auth_password, """"));remove(R.string.settings_key_auth_password);}if (settings.contains(getResString(R.string.settings_key_auth_pin))) {setAuthCredentials(getString(R.string.settings_key_auth_pin, """"));remove(R.string.settings_key_auth_pin);}if (settings.contains(getResString(R.string.settings_key_locale))) {String lang = getString(R.string.settings_key_locale, R.string.settings_default_lang);if (oldLangs.contains(lang))setLocale(newLangs.get(oldLangs.indexOf(lang)));remove(R.string.settings_key_locale);}if (settings.contains(getResString(R.string.settings_key_tap_to_reveal))) {if (getBoolean(R.string.settings_key_tap_to_reveal, false)) {setString(R.string.settings_key_tap_single, Constants.TapMode.REVEAL.toString().toLowerCase(Locale.ENGLISH));}remove(R.string.settings_key_tap_to_reveal);}if (settings.contains(getResString(R.string.settings_key_backup_password))) {String plainPassword = getBackupPassword();try {KeyPair key = KeyStoreHelper.loadOrGenerateAsymmetricKeyPair(context, Constants.KEYSTORE_ALIAS_PASSWORD);byte[] encPassword = EncryptionHelper.encrypt(key.getPublic(), plainPassword.getBytes(StandardCharsets.UTF_8));setString(R.string.settings_key_backup_password_enc, Base64.encodeToString(encPassword, Base64.URL_SAFE));remove(R.string.settings_key_backup_password);} catch (Exception e) {e.printStackTrace();}}}private String getResString(int resId) {return context.getString(resId);}private int getResInt(int resId) {return context.getResources().getInteger(resId);}private String getString(int keyId, int defaultId) {return settings.getString(getResString(keyId), getResString(defaultId));}private String getString(int keyId, String defaultValue) {return settings.getString(getResString(keyId), defaultValue);}private boolean getBoolean(int keyId, boolean defaultValue) {return settings.getBoolean(getResString(keyId), defaultValue);}private int getInt(int keyId, int defaultId) {return settings.getInt(getResString(keyId), getResInt(defaultId));}private int getIntValue(int keyId, int defaultValue) {return settings.getInt(getResString(keyId), defaultValue);}private long getLong(int keyId, long defaultValue) {return settings.getLong(getResString(keyId), defaultValue);}private Set<String> getStringSet(int keyId, Set<String> defaultValue) {return new HashSet<String>(settings.getStringSet(getResString(keyId), defaultValue));}private void setBoolean(int keyId, boolean value) {settings.edit().putBoolean(getResString(keyId), value).apply();}private void setInt(int keyId, int value) {settings.edit().putInt(getResString(keyId), value).apply();}private void setString(int keyId, String value) {settings.edit().putString(getResString(keyId), value).apply();}private void setStringSet(int keyId, Set<String> value) {settings.edit().putStringSet(getResString(keyId), value).apply();}private void remove(int keyId) {settings.edit().remove(getResString(keyId)).apply();}public void clear(boolean keep_auth) {AuthMethod authMethod = getAuthMethod();String authCredentials = getAuthCredentials();byte[] authSalt = getSalt();int authIterations = getIterations();boolean warningShown = getFirstTimeWarningShown();SharedPreferences.Editor editor = settings.edit();editor.clear();editor.putBoolean(getResString(R.string.settings_key_security_backup_warning), warningShown);if (keep_auth) {editor.putString(getResString(R.string.settings_key_auth), authMethod.toString().toLowerCase());if (! authCredentials.isEmpty()) {editor.putString(getResString(R.string.settings_key_auth_credentials), authCredentials);editor.putInt(getResString(R.string.settings_key_auth_iterations), authIterations);String encodedSalt = Base64.encodeToString(authSalt, Base64.URL_SAFE);editor.putString(getResString(R.string.settings_key_auth_salt), encodedSalt);}}editor.commit();PreferenceManager.setDefaultValues(context, R.xml.preferences, true);}public void registerPreferenceChangeListener(SharedPreferences.OnSharedPreferenceChangeListener listener) {settings.registerOnSharedPreferenceChangeListener(listener);}public void unregisterPreferenceChangeListener(SharedPreferences.OnSharedPreferenceChangeListener listener) {settings.unregisterOnSharedPreferenceChangeListener(listener);}public boolean getTapToReveal() {return getTapSingle() == Constants.TapMode.REVEAL || getTapDouble() == Constants.TapMode.REVEAL;}public int getTapToRevealTimeout() {return getInt(R.string.settings_key_tap_to_reveal_timeout, R.integer.settings_default_tap_to_reveal_timeout);}public AuthMethod getAuthMethod() {String authString = getString(R.string.settings_key_auth, CredentialsPreference.DEFAULT_VALUE.name().toLowerCase(Locale.ENGLISH));return AuthMethod.valueOf(authString.toUpperCase(Locale.ENGLISH));}public void setAuthMethod(AuthMethod authMethod) {setString(R.string.settings_key_auth, authMethod.name().toLowerCase(Locale.ENGLISH));}public void removeAuthPasswordHash() {remove(R.string.settings_key_auth_password_hash);}public void removeAuthPINHash() {remove(R.string.settings_key_auth_pin_hash);}public String getOldCredentials(AuthMethod method) {if (method == AuthMethod.PASSWORD)return getString(R.string.settings_key_auth_password_hash, """");else if (method == AuthMethod.PIN)return getString(R.string.settings_key_auth_pin_hash, """");elsereturn """";}public String getAuthCredentials() {return getString(R.string.settings_key_auth_credentials, """");}public byte[] setAuthCredentials(String plainPassword) {byte[] key = null;try {int iterations = EncryptionHelper.generateRandomIterations();EncryptionHelper.PBKDF2Credentials credentials = EncryptionHelper.generatePBKDF2Credentials(plainPassword, getSalt(), iterations);String password = Base64.encodeToString(credentials.password, Base64.URL_SAFE);setIterations(iterations);setString(R.string.settings_key_auth_credentials, password);key = credentials.key;} catch (NoSuchAlgorithmException | InvalidKeySpecException e) {e.printStackTrace();}return key;}public void setSalt(byte[] bytes) {String encodedSalt = Base64.encodeToString(bytes, Base64.URL_SAFE);setString(R.string.settings_key_auth_salt, encodedSalt);}public byte[] getSalt() {String storedSalt = getString(R.string.settings_key_auth_salt, """");if (storedSalt.isEmpty()) {byte[] newSalt = EncryptionHelper.generateRandom(Constants.PBKDF2_SALT_LENGTH);setSalt(newSalt);return newSalt;} else {return Base64.decode(storedSalt, Base64.URL_SAFE);}}public int getIterations() {return getIntValue(R.string.settings_key_auth_iterations, Constants.PBKDF2_DEFAULT_ITERATIONS);}public void setIterations(int value) {setInt(R.string.settings_key_auth_iterations, value);}public EncryptionType getEncryption() {String encType = getString(R.string.settings_key_encryption, R.string.settings_default_encryption);return EncryptionType.valueOf(encType.toUpperCase());}public void setEncryption(EncryptionType encryptionType) {setEncryption(encryptionType.name().toLowerCase());}public void setEncryption(String encryption) {setString(R.string.settings_key_encryption, encryption);}public Set<String> getPanicResponse() {return settings.getStringSet(getResString(R.string.settings_key_panic), Collections.<String>emptySet());}public boolean getRelockOnScreenOff() {return getBoolean(R.string.settings_key_relock_screen_off, true);}public boolean getRelockOnBackground() {return getBoolean(R.string.settings_key_relock_background, false);}public boolean getBlockAccessibility() {return getBoolean(R.string.settings_key_block_accessibility, false);}public void setLocale(String locale) {setString(R.string.settings_key_lang, locale);}public Locale getLocale() {String lang = getString(R.string.settings_key_lang, R.string.settings_default_lang);if (lang.equals(""system"")) {return Tools.getSystemLocale();} else {String[] splitLang =  lang.split(""_"");if (splitLang.length > 1) {return new Locale(splitLang[0], splitLang[1]);} else {return new Locale(lang);}}}public int getTheme() {String themeName = getString(R.string.settings_key_theme, R.string.settings_default_theme);int theme = R.style.AppTheme_NoActionBar;if (themeName.equals(""light"")) {theme = R.style.AppTheme_NoActionBar;} else if (themeName.equals(""dark"")) {theme = R.style.AppTheme_Dark_NoActionBar;} else if (themeName.equals(""black"")) {theme = R.style.AppTheme_Black_NoActionBar;}return theme;}public int getLabelSize() {return getInt(R.string.settings_key_label_size, R.integer.settings_default_label_size);}public boolean getScrollLabel() {return getBoolean(R.string.settings_key_label_scroll, false);}public boolean getFirstTimeWarningShown() {return getBoolean(R.string.settings_key_security_backup_warning, false);}public void setFirstTimeWarningShown(boolean value) {setBoolean(R.string.settings_key_security_backup_warning, value);}public boolean getSpecialFeatures() {return getBoolean(R.string.settings_key_special_features, false);}public void setSpecialFeatures(boolean value) {setBoolean(R.string.settings_key_special_features, value);}public SortMode getSortMode() {String modeStr = getString(R.string.settings_key_sort_mode, SortMode.UNSORTED.toString());return SortMode.valueOf(modeStr);}public void setSortMode(SortMode value) {setString(R.string.settings_key_sort_mode, value.toString());}public List<Constants.SearchIncludes> getSearchValues() {Set<String> stringValues = settings.getStringSet(getResString(R.string.settings_key_search_includes), new HashSet<>(Arrays.asList(context.getResources().getStringArray(R.array.settings_defaults_search_includes))));List<Constants.SearchIncludes> values = new ArrayList<>();for (String value : stringValues) {values.add(Constants.SearchIncludes.valueOf(value.toUpperCase(Locale.ENGLISH)));}return values;}public Constants.CardLayouts getCardLayout() {String stringValue = getString(R.string.settings_key_card_layout, R.string.settings_default_card_layout);return Constants.CardLayouts.valueOf(stringValue.toUpperCase(Locale.ENGLISH));}public boolean getBackupAsk() {return getBoolean(R.string.settings_key_backup_ask, true);}public String getBackupPassword() {return getString(R.string.settings_key_backup_password, """");}public String getBackupPasswordEnc() {String base64Password = getString(R.string.settings_key_backup_password_enc, """");byte[] encPassword = Base64.decode(base64Password, Base64.URL_SAFE);String password = """";try {KeyPair key = KeyStoreHelper.loadOrGenerateAsymmetricKeyPair(context, Constants.KEYSTORE_ALIAS_PASSWORD);password = new String(EncryptionHelper.decrypt(key.getPrivate(), encPassword), StandardCharsets.UTF_8);} catch (Exception e) {e.printStackTrace();}return password;}public Set<String> getBackupBroadcasts() {return settings.getStringSet(getResString(R.string.settings_key_backup_broadcasts), Collections.<String>emptySet());}public boolean isPlainTextBackupBroadcastEnabled() {return getBackupBroadcasts().contains(""plain"");}public boolean isEncryptedBackupBroadcastEnabled() {return getBackupBroadcasts().contains(""encrypted"");}public String getOpenPGPProvider() {return getString(R.string.settings_key_openpgp_provider, """");}public String getOpenPGPEncryptionUserIDs() {return getString(R.string.settings_key_openpgp_key_encrypt, """");}public long getOpenPGPSigningKey() {return getLong(R.string.settings_key_openpgp_key_sign, 0);}public boolean getOpenPGPVerify() {return getBoolean(R.string.settings_key_openpgp_verify, false);}public boolean getAllTagsToggle() {return getBoolean(R.string.settings_key_all_tags_toggle, true);}public void setAllTagsToggle(Boolean value) {setBoolean(R.string.settings_key_all_tags_toggle, value);}public boolean getNoTagsToggle() {return getBoolean(R.string.settings_key_no_tags_toggle, true);}public void setNoTagsToggle(Boolean value) {setBoolean(R.string.settings_key_no_tags_toggle, value);}public boolean getTagToggle(String tag) {//The tag toggle holds tags that are unchecked in order to default to checked.Set<String> toggledTags = getStringSet(R.string.settings_key_tags_toggles, new HashSet<String>());return !toggledTags.contains(tag);}public void setTagToggle(String tag, Boolean value) {Set<String> toggledTags = getStringSet(R.string.settings_key_tags_toggles, new HashSet<String>());if(value)toggledTags.remove(tag);elsetoggledTags.add(tag);setStringSet(R.string.settings_key_tags_toggles, toggledTags);}public boolean getThumbnailVisible() {return getThumbnailSize() > 0;}public int getThumbnailSize() {try {String dimen = getString(R.string.settings_key_thumbnail_size, context.getResources().getString(R.string.settings_default_thumbnail_size));return DimensionConverter.stringToDimensionPixelSize(dimen, context.getResources().getDisplayMetrics());} catch(Exception e) {e.printStackTrace();return context.getResources().getDimensionPixelSize(R.dimen.card_thumbnail_size);}}public int getTokenSplitGroupSize() {// the setting is of type ""String"", because ListPreference does not support integer arrays for its entryValuesreturn  Integer.valueOf(getString(R.string.settings_key_split_group_size, R.string.settings_default_split_group_size));}public Constants.TagFunctionality getTagFunctionality() {String tagFunctionality = getString(R.string.settings_key_tag_functionality, R.string.settings_default_tag_functionality);return Constants.TagFunctionality.valueOf(tagFunctionality.toUpperCase());}public boolean getScreenshotsEnabled() {return getBoolean(R.string.settings_key_enable_screenshot, false);}public boolean getUsedTokensDialogShown() {return getBoolean(R.string.settings_key_last_used_dialog_shown, false);}public void setUsedTokensDialogShown(boolean value) {setBoolean(R.string.settings_key_last_used_dialog_shown, value);}public boolean getAndroidBackupServiceEnabled() {return getBoolean(R.string.settings_key_enable_android_backup_service, true);}public void setAndroidBackupServiceEnabled(boolean value) {setBoolean(R.string.settings_key_enable_android_backup_service, value);}public boolean getIsAppendingDateTimeToBackups() {return getBoolean(R.string.settings_key_backup_append_date_time, true);}public int getAuthInactivityDelay() {return getIntValue(R.string.settings_key_auth_inactivity_delay, 0);}public boolean getAuthInactivity() {return getBoolean(R.string.settings_key_auth_inactivity, false);}public boolean isMinimizeAppOnCopyEnabled() {return  getBoolean(R.string.settings_key_minimize_on_copy, false);}private Constants.AutoBackup getAutoBackupEncryptedSetting() {String stringValue = getString(R.string.settings_key_auto_backup_password_enc, R.string.settings_default_auto_backup_password_enc);return Constants.AutoBackup.valueOf(stringValue.toUpperCase(Locale.ENGLISH));}public boolean getAutoBackupEncryptedPasswordsEnabled() {return getAutoBackupEncryptedSetting() != Constants.AutoBackup.OFF;}public boolean getAutoBackupEncryptedFullEnabled() {return getAutoBackupEncryptedSetting() == Constants.AutoBackup.ALL_EDITS;}public boolean isHighlightTokenOptionEnabled() {return getBoolean(R.string.settings_key_label_highlight_token,true);}public boolean isHideGlobalTimeoutEnabled() {return getBoolean(R.string.settings_key_hide_global_timeout, false);}public boolean isShowIndividualTimeoutsEnabled() {return getBoolean(R.string.settings_key_show_individual_timeouts, false);}public Constants.TapMode getTapSingle() {String singleTap = getString(R.string.settings_key_tap_single, R.string.settings_default_tap_single);return Constants.TapMode.valueOf(singleTap.toUpperCase(Locale.ENGLISH));}public Constants.TapMode getTapDouble() {String doubleTap = getString(R.string.settings_key_tap_double, R.string.settings_default_tap_double);return Constants.TapMode.valueOf(doubleTap.toUpperCase(Locale.ENGLISH));}public void setBackupLocation(Uri uri) {setString(R.string.settings_key_backup_location, uri.toString());}public Uri getBackupLocation() {return Uri.parse(getString(R.string.settings_key_backup_location, """"));}public boolean isBackupLocationSet() {return !getString(R.string.settings_key_backup_location, """").isEmpty();}public boolean getBlockAutofill() {return getBoolean(R.string.settings_key_block_autofill, false);}}",andOTP/app/src/main/java/org/shadowice/flocke/andotp/Utilities/Settings.java
128,"<?xml version=""1.0"" encoding=""utf-8""?><resources><!-- Keys --><string name=""settings_key_cat_security"" translatable=""false"">pref_cat_security</string><string name=""settings_key_tap_to_reveal"" translatable=""false"">pref_tap_to_reveal</string>  <!-- Deprecated --><string name=""settings_key_tap_to_reveal_timeout"" translatable=""false"">pref_tap_to_reveal_timeout</string><string name=""settings_key_auth"" translatable=""false"">pref_auth</string><string name=""settings_key_auth_password"" translatable=""false"">pref_auth_password</string>    <!-- Deprecated --><string name=""settings_key_auth_password_hash"" translatable=""false"">pref_auth_password_hash</string>    <!-- Deprecated --><string name=""settings_key_auth_pin"" translatable=""false"">pref_auth_pin</string>    <!-- Deprecated --><string name=""settings_key_auth_pin_hash"" translatable=""false"">pref_auth_pin_hash</string>    <!-- Deprecated --><string name=""settings_key_auth_credentials"" translatable=""false"">pref_auth_credentials</string><string name=""settings_key_auth_iterations"" translatable=""false"">pref_auth_iterations</string><string name=""settings_key_auth_salt"" translatable=""false"">pref_auth_salt</string><string name=""settings_key_encryption"" translatable=""false"">pref_encryption</string><string name=""settings_key_panic"" translatable=""false"">pref_panic</string><string name=""settings_key_relock_screen_off"" translatable=""false"">pref_relock_screen_off</string><string name=""settings_key_relock_background"" translatable=""false"">pref_relock_background</string><string name=""settings_key_auth_inactivity"" translatable=""false"">pref_auth_inactivity</string><string name=""settings_key_auth_inactivity_delay"" translatable=""false"">pref_auth_inactivity_timeout</string><string name=""settings_key_block_accessibility"" translatable=""false"">pref_block_accessibility</string><string name=""settings_key_block_autofill"" translatable=""false"">pref_block_autofill</string><string name=""settings_key_lang"" translatable=""false"">pref_lang</string><string name=""settings_key_locale"" translatable=""false"">pref_locale</string>                        <!-- Deprecated --><string name=""settings_key_theme"" translatable=""false"">pref_theme</string><string name=""settings_key_label_size"" translatable=""false"">pref_label_size_sp</string><string name=""settings_key_card_layout"" translatable=""false"">pref_card_layout</string><string name=""settings_key_label_scroll"" translatable=""false"">pref_label_scroll</string><string name=""settings_key_tap_single"" translatable=""false"">pref_tap_single</string><string name=""settings_key_tap_double"" translatable=""false"">pref_tap_double</string><string name=""settings_key_minimize_on_copy"" translatable=""false"">pref_minimize_on_copy</string><string name=""settings_key_thumbnail_size"" translatable=""false"">pref_thumbnail_size</string><string name=""settings_key_split_group_size"" translatable=""false"">pref_split_group_size</string><string name=""settings_key_tag_functionality"" translatable=""false"">pref_tag_functionality</string><string name=""settings_key_search_includes"" translatable=""false"">pref_search_includes</string><string name=""settings_key_label_highlight_token"" translatable=""false"">pref_label_highlight_token</string><string name=""settings_key_hide_global_timeout"" translatable=""false"">pref_hide_global_timeout</string><string name=""settings_key_show_individual_timeouts"" translatable=""false"">pref_show_individual_timeouts</string><string name=""settings_key_backup_append_date_time"" translatable=""false"">pref_backup_append_date_time</string><string name=""settings_key_backup_ask"" translatable=""false"">pref_backup_ask</string><string name=""settings_key_backup_location"" translatable=""false"">pref_backup_location</string><string name=""settings_key_backup_directory"" translatable=""false"">pref_backup_directory</string>    <!-- Deprecated --><string name=""settings_key_backup_password"" translatable=""false"">pref_backup_password</string>      <!-- Deprecated --><string name=""settings_key_backup_password_enc"" translatable=""false"">pref_backup_password_enc</string><string name=""settings_key_auto_backup_password_enc"" translatable=""false"">pref_backup_auto_password_enc</string><string name=""settings_key_backup_broadcasts"" translatable=""false"">pref_backup_broadcasts</string><string name=""settings_key_openpgp_provider"" translatable=""false"">pref_openpgp_provider</string><string name=""settings_key_openpgp_key_encrypt"" translatable=""false"">pref_openpgp_key_encrypt</string><string name=""settings_key_openpgp_key_sign"" translatable=""false"">pref_openpgp_key_sign</string><string name=""settings_key_openpgp_verify"" translatable=""false"">pref_openpgp_verify</string><string name=""settings_key_new_backup_format_dialog_shown"" translatable=""false"">pref_new_backup_dialog_shown</string>   <!--Deprecated --><string name=""settings_key_security_backup_warning"" translatable=""false"">pref_security_backup_warning_shown</string><string name=""settings_key_sort_mode"" translatable=""false"">pref_sort_mode</string><string name=""settings_key_special_features"" translatable=""false"">pref_special_features</string><string name=""settings_key_all_tags_toggle"" translatable=""false"">pref_all_tags_toggle</string><string name=""settings_key_no_tags_toggle"" translatable=""false"">pref_no_tags_toggle</string><string name=""settings_key_tags_toggles"" translatable=""false"">pref_tags_toggles</string><string name=""settings_key_enable_screenshot"" translatable=""false"">pref_enable_screenshot</string><string name=""settings_key_enable_android_backup_service"" translatable=""false"">pref_enable_android_backup_service</string><string name=""settings_key_clear_keystore"" translatable=""false"">pref_clear_keystore</string><string name=""settings_key_last_used_dialog_shown"" translatable=""false"">pref_last_used_dialog_shown</string><string name=""settings_key_android21_deprecation_notice_shown"" translatable=""false"">pref_android21_deprecation_notice_shown</string>    <!-- Deprecated --><!-- Default values --><integer name=""settings_default_tap_to_reveal_timeout"">30</integer><integer name=""settings_default_auth_inactivity_delay"">30</integer><string name=""settings_default_encryption"" translatable=""false"">keystore</string><string name=""settings_default_lang"" translatable=""false"">system</string><string name=""settings_default_theme"" translatable=""false"">light</string><integer name=""settings_default_label_size"">18</integer><string name=""settings_default_card_layout"" translatable=""false"">default</string><string name=""settings_default_tap_single"" translatable=""false"">nothing</string><string name=""settings_default_tap_double"" translatable=""false"">nothing</string><string name=""settings_default_thumbnail_size"" translatable=""false"">46dp</string><string name=""settings_default_split_group_size"" translatable=""false"">3</string><string name=""settings_default_tag_functionality"" translatable=""false"">or</string><string name=""settings_default_auto_backup_password_enc"" translatable=""false"">off</string><string-array name=""settings_defaults_search_includes""><item>label</item><item>issuer</item></string-array><!-- All of the possible tile background colors --><array name=""letter_tile_colors""><item>#f16364</item><item>#f58559</item><item>#f9a43e</item><item>#e4c62e</item><item>#67bf74</item><item>#59a2be</item><item>#2093cd</item><item>#ad62a7</item></array><!-- List values --><string-array name=""settings_values_encryption"" translatable=""false""><item>keystore</item><item>password</item></string-array><string-array name=""settings_values_panic"" translatable=""false""><item>accounts</item><item>settings</item></string-array><string-array name=""settings_values_card_layout"" translatable=""false""><item>compact</item><item>default</item><item>full</item></string-array><string-array name=""settings_values_tap"" translatable=""false""><item>nothing</item><item>reveal</item><item>copy</item><item>copy_background</item></string-array><string-array name=""settings_values_search_includes"" translatable=""false""><item>label</item><item>issuer</item><item>tags</item></string-array><string-array name=""settings_values_auto_backup_password_enc"" translatable=""false""><item>off</item><item>new_entries</item><item>all_edits</item></string-array><string-array name=""settings_values_lang"" translatable=""false""><item>system</item><item>ca</item><item>de</item><item>en</item><item>es</item><item>fr</item><item>gl</item><item>it</item><item>hu</item><item>nl</item><item>pl</item><item>pt_BR</item><item>sl</item><item>sv</item><item>tr</item><item>cs</item><item>el</item><item>ru</item><item>uk</item><item>bg</item><item>ar</item><item>fa</item><item>hi</item><item>ja</item><item>zh_CN</item><item>zh_TW</item></string-array><string-array name=""settings_values_theme"" translatable=""false""><item>light</item><item>dark</item><item>black</item></string-array><string-array name=""settings_values_thumbnail_size"" translatable=""false""><item>0dp</item><item>24dp</item><item>32dp</item><item>46dp</item><item>64dp</item><item>96dp</item></string-array><string-array name=""settings_values_split_group_size"" translatable=""false""><item>0</item><item>2</item><item>3</item></string-array><string-array name=""settings_values_tag_functionality"" translatable=""false""><item>or</item><item>and</item><item>single</item></string-array><string-array name=""settings_values_backup_broadcasts"" translatable=""false""><item>plain</item><item>encrypted</item></string-array><string-array name=""settings_entries_lang"" translatable=""false""><item>@string/settings_lang_sys_default</item><item>Català</item><item>Deutsch</item><item>English</item><item>Español</item><item>Français</item><item>Galego</item><item>Italiano</item><item>Magyar</item><item>Nederlands</item><item>Polski</item><item>Português (Brasil)</item><item>Slovenščina</item><item>Svenska</item><item>Türkçe</item><item>Čeština</item><item>Ελληνικά</item><item>Русский</item><item>Українська</item><item>български</item><item>العربية</item><item>فارسی</item><item>हिन्दी</item><item>日本語</item><item>简体中文</item><item>繁體中文</item></string-array><!-- Misc --><string-array name=""settings_empty_array"" translatable=""false""></string-array><!-- Constraints --><integer name=""settings_min_tap_to_reveal_timeout"">5</integer><integer name=""settings_max_tap_to_reveal_timeout"">60</integer><integer name=""settings_min_label_size"">12</integer><integer name=""settings_max_label_size"">24</integer><integer name=""settings_auth_min_inactivity_delay"">10</integer><integer name=""settings_auth_max_inactivity_delay"">360</integer></resources>",andOTP/app/src/main/res/values/settings.xml
128,"<?xml version=""1.0"" encoding=""utf-8""?><PreferenceScreenxmlns:android=""http://schemas.android.com/apk/res/android""xmlns:app=""http://schemas.android.com/apk/res-auto""><PreferenceCategoryandroid:key=""@string/settings_key_cat_security""android:title=""@string/settings_category_title_security""><com.vanniktech.vntnumberpickerpreference.VNTNumberPickerPreferenceandroid:key=""@string/settings_key_tap_to_reveal_timeout""android:title=""@string/settings_title_tap_to_reveal_timeout""android:dialogMessage=""@string/settings_desc_tap_to_reveal_timeout""android:defaultValue=""@integer/settings_default_tap_to_reveal_timeout""app:vnt_minValue=""@integer/settings_min_tap_to_reveal_timeout""app:vnt_maxValue=""@integer/settings_max_tap_to_reveal_timeout"" /><org.shadowice.flocke.andotp.Preferences.CredentialsPreferenceandroid:key=""@string/settings_key_auth""android:title=""@string/settings_title_auth"" /><ListPreferenceandroid:key=""@string/settings_key_encryption""android:title=""@string/settings_title_encryption""android:summary=""%s""android:entries=""@array/settings_entries_encryption""android:entryValues=""@array/settings_values_encryption""android:defaultValue=""@string/settings_default_encryption"" /><MultiSelectListPreferenceandroid:key=""@string/settings_key_panic""android:title=""@string/settings_title_panic""android:summary=""@string/settings_desc_panic""android:entries=""@array/settings_entries_panic""android:entryValues=""@array/settings_values_panic""android:defaultValue=""@array/settings_empty_array"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_relock_screen_off""android:title=""@string/settings_title_relock_screen_off""android:summary=""@string/settings_desc_relock_screen_off""android:defaultValue=""true"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_relock_background""android:title=""@string/settings_title_relock_background""android:summary=""@string/settings_desc_relock_background""android:defaultValue=""false"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_auth_inactivity""android:title=""@string/settings_title_auth_inactivity""android:summary=""@string/settings_desc_auth_inactivity""android:defaultValue=""false"" /><com.vanniktech.vntnumberpickerpreference.VNTNumberPickerPreferenceandroid:key=""@string/settings_key_auth_inactivity_delay""android:title=""@string/settings_title_auth_inactivity_delay""android:dialogMessage=""@string/settings_desc_auth_inactivity_delay""android:defaultValue=""@integer/settings_default_auth_inactivity_delay""android:dependency=""@string/settings_key_auth_inactivity""app:vnt_minValue=""@integer/settings_auth_min_inactivity_delay""app:vnt_maxValue=""@integer/settings_auth_max_inactivity_delay"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_block_accessibility""android:title=""@string/settings_title_block_accessibility""android:summary=""@string/settings_desc_block_accessibility""android:defaultValue=""false"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_block_autofill""android:title=""@string/settings_title_block_autofill""android:summary=""@string/settings_desc_block_autofill""android:defaultValue=""false"" /></PreferenceCategory><PreferenceCategoryandroid:title=""@string/settings_category_title_ui""><ListPreferenceandroid:key=""@string/settings_key_lang""android:title=""@string/settings_title_lang""android:summary=""%s""android:entries=""@array/settings_entries_lang""android:entryValues=""@array/settings_values_lang""android:defaultValue=""@string/settings_default_lang"" /><ListPreferenceandroid:key=""@string/settings_key_theme""android:title=""@string/settings_title_theme""android:summary=""%s""android:entries=""@array/settings_entries_theme""android:entryValues=""@array/settings_values_theme""android:defaultValue=""@string/settings_default_theme"" /><ListPreferenceandroid:key=""@string/settings_key_card_layout""android:title=""@string/settings_title_card_layout""android:summary=""%s""android:entries=""@array/settings_entries_card_layout""android:entryValues=""@array/settings_values_card_layout""android:defaultValue=""@string/settings_default_card_layout"" /><ListPreferenceandroid:key=""@string/settings_key_tap_single""android:title=""@string/settings_title_tap_single""android:summary=""%s""android:entries=""@array/settings_entries_tap""android:entryValues=""@array/settings_values_tap""android:defaultValue=""@string/settings_default_tap_single"" /><ListPreferenceandroid:key=""@string/settings_key_tap_double""android:title=""@string/settings_title_tap_double""android:summary=""%s""android:entries=""@array/settings_entries_tap""android:entryValues=""@array/settings_values_tap""android:defaultValue=""@string/settings_default_tap_double"" /><com.vanniktech.vntnumberpickerpreference.VNTNumberPickerPreferenceandroid:key=""@string/settings_key_label_size""android:title=""@string/settings_title_label_size""android:defaultValue=""@integer/settings_default_label_size""app:vnt_maxValue=""@integer/settings_max_label_size""app:vnt_minValue=""@integer/settings_min_label_size"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_label_scroll""android:title=""@string/settings_title_label_scroll""android:summary=""@string/settings_desc_label_scroll""android:defaultValue=""false"" /><ListPreferenceandroid:key=""@string/settings_key_thumbnail_size""android:title=""@string/settings_title_thumbnail_size_ask""android:summary=""%s""android:entries=""@array/settings_entries_thumbnail_size""android:entryValues=""@array/settings_values_thumbnail_size""android:defaultValue=""@string/settings_default_thumbnail_size"" /><ListPreferenceandroid:key=""@string/settings_key_split_group_size""android:title=""@string/settings_title_split_group_size""android:summary=""%s""android:entries=""@array/settings_entries_split_group_size""android:entryValues=""@array/settings_values_split_group_size""android:defaultValue=""@string/settings_default_split_group_size"" /><ListPreferenceandroid:key=""@string/settings_key_tag_functionality""android:title=""@string/settings_title_tag_functionality""android:summary=""%s""android:entries=""@array/settings_entries_tag_functionality""android:entryValues=""@array/settings_values_tag_functionality""android:defaultValue=""@string/settings_default_tag_functionality"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_minimize_on_copy""android:title=""@string/settings_title_minimize_on_copy""android:summary=""@string/settings_desc_minimize_on_copy""android:defaultValue=""false"" /><MultiSelectListPreferenceandroid:key=""@string/settings_key_search_includes""android:title=""@string/settings_title_search_includes""android:summary=""@string/settings_desc_search_includes""android:entries=""@array/settings_entries_search_includes""android:entryValues=""@array/settings_values_search_includes""android:defaultValue=""@array/settings_defaults_search_includes"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_label_highlight_token""android:title=""@string/settings_title_label_highlight_token""android:summary=""@string/settings_desc_label_highlight_token""android:defaultValue=""true"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_hide_global_timeout""android:title=""@string/settings_title_hide_global_timeout""android:summary=""@string/settings_desc_hide_global_timeout""android:defaultValue=""false"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_show_individual_timeouts""android:title=""@string/settings_title_show_individual_timeouts""android:summary=""@string/settings_desc_show_individual_timeouts""android:defaultValue=""false"" /></PreferenceCategory><PreferenceCategoryandroid:title=""@string/settings_category_title_backup""><CheckBoxPreferenceandroid:key=""@string/settings_key_enable_android_backup_service""android:title=""@string/settings_title_enable_android_backup_service""android:summary=""@string/settings_desc_enable_android_backup_service""android:defaultValue=""true"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_backup_append_date_time""android:title=""@string/settings_title_backup_append_date""android:summary=""@string/settings_desc_backup_append_date""android:defaultValue=""true"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_backup_ask""android:title=""@string/settings_title_backup_ask""android:summary=""@string/settings_desc_backup_ask""android:disableDependentsState=""true""android:defaultValue=""true"" /><Preferenceandroid:key=""@string/settings_key_backup_location""android:title=""@string/settings_title_backup_location""android:summary=""@string/settings_desc_backup_location"" /><org.shadowice.flocke.andotp.Preferences.PasswordEncryptedPreferenceandroid:key=""@string/settings_key_backup_password_enc""android:title=""@string/settings_title_backup_password""android:summary=""@string/settings_desc_backup_password"" /><ListPreferenceandroid:key=""@string/settings_key_auto_backup_password_enc""android:title=""@string/settings_title_auto_backup_password_enc""android:summary=""@string/settings_desc_auto_backup_password_enc""android:entries=""@array/settings_entries_auto_backup_password_enc""android:entryValues=""@array/settings_values_auto_backup_password_enc""android:defaultValue=""@string/settings_default_auto_backup_password_enc"" /><MultiSelectListPreferenceandroid:key=""@string/settings_key_backup_broadcasts""android:title=""@string/settings_title_backup_broadcasts""android:summary=""@string/settings_desc_backup_broadcasts""android:entries=""@array/settings_entries_backup_broadcasts""android:entryValues=""@array/settings_values_backup_broadcasts""android:defaultValue=""@array/settings_empty_array"" /><org.openintents.openpgp.util.OpenPgpAppPreferenceandroid:key=""@string/settings_key_openpgp_provider""android:title=""@string/settings_title_openpgp_provider"" /><EditTextPreferenceandroid:key=""@string/settings_key_openpgp_key_encrypt""android:title=""@string/settings_title_openpgp_key_encrypt""android:summary=""@string/settings_desc_openpgp_key_encrypt""android:enabled=""false"" /><org.openintents.openpgp.util.OpenPgpKeyPreferenceandroid:key=""@string/settings_key_openpgp_key_sign""android:title=""@string/settings_title_openpgp_key_sign"" /><CheckBoxPreferenceandroid:key=""@string/settings_key_openpgp_verify""android:title=""@string/settings_title_openpgp_verify""android:summary=""@string/settings_desc_openpgp_verify""android:defaultValue=""false"" /></PreferenceCategory></PreferenceScreen>",andOTP/app/src/main/res/xml/preferences.xml
2,"package io.github.zwieback.familyfinance.business.chart.fragment;import android.graphics.RectF;import android.os.Bundle;import android.support.annotation.ColorRes;import android.support.annotation.NonNull;import android.support.annotation.Nullable;import android.support.annotation.StringRes;import android.support.v4.content.ContextCompat;import android.view.View;import com.annimon.stream.Collectors;import com.annimon.stream.Stream;import com.github.mikephil.charting.charts.HorizontalBarChart;import com.github.mikephil.charting.components.Legend;import com.github.mikephil.charting.components.XAxis;import com.github.mikephil.charting.components.YAxis;import com.github.mikephil.charting.data.BarData;import com.github.mikephil.charting.data.BarDataSet;import com.github.mikephil.charting.data.BarEntry;import com.github.mikephil.charting.data.Entry;import com.github.mikephil.charting.formatter.IAxisValueFormatter;import com.github.mikephil.charting.formatter.IValueFormatter;import com.github.mikephil.charting.formatter.IndexAxisValueFormatter;import com.github.mikephil.charting.formatter.LargeValueFormatter;import com.github.mikephil.charting.formatter.PercentFormatter;import com.github.mikephil.charting.highlight.Highlight;import com.github.mikephil.charting.listener.OnChartValueSelectedListener;import com.github.mikephil.charting.utils.MPPointF;import java.util.List;import java.util.Map;import java.util.Set;import io.github.zwieback.familyfinance.R;import io.github.zwieback.familyfinance.business.chart.display.BarChartDisplay;import io.github.zwieback.familyfinance.business.chart.display.HorizontalBarChartDisplay;import io.github.zwieback.familyfinance.business.chart.exception.UnsupportedHorizontalBarChartGroupByTypeException;import io.github.zwieback.familyfinance.business.chart.marker.HorizontalBarChartMarkerView;import io.github.zwieback.familyfinance.business.chart.service.builder.IdIndexMapStatefulBuilder;import io.github.zwieback.familyfinance.business.chart.service.converter.OperationConverter;import io.github.zwieback.familyfinance.business.chart.service.converter.bar.OperationHorizontalBarConverter;import io.github.zwieback.familyfinance.business.chart.service.converter.bar.OperationHorizontalBarPercentConverter;import io.github.zwieback.familyfinance.business.chart.service.formatter.LocalizedValueFormatter;import io.github.zwieback.familyfinance.business.chart.service.grouper.OperationGrouper;import io.github.zwieback.familyfinance.business.chart.service.grouper.pie.OperationGrouperByArticle;import io.github.zwieback.familyfinance.business.chart.service.grouper.pie.OperationGrouperByArticleParent;import io.github.zwieback.familyfinance.business.operation.filter.OperationFilter;import io.github.zwieback.familyfinance.core.model.Article;import io.github.zwieback.familyfinance.core.model.OperationView;public abstract class HorizontalBarChartFragment<F extends OperationFilter>extends ChartFragment<HorizontalBarChart, BarEntry, F, HorizontalBarChartDisplay>implements OnChartValueSelectedListener {private static final float NORMAL_GRANULARITY = 1f;private static final int Y_AXIS_ANIMATION_DURATION = 500;private int maxBarCountOnScreen;private float barValueTextSize;private RectF onValueSelectedRectF;private IdIndexMapStatefulBuilder idIndexMapStatefulBuilder;@Overridepublic void onCreate(@Nullable Bundle savedInstanceState) {super.onCreate(savedInstanceState);maxBarCountOnScreen =getResources().getInteger(R.integer.max_horizontal_bar_count_on_screen);barValueTextSize = getResources().getDimension(R.dimen.bar_value_text_size);onValueSelectedRectF = new RectF();}@Overridepublic void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {super.onViewCreated(view, savedInstanceState);refreshData();}@Overrideprotected int getFragmentChartLayout() {return R.layout.fragment_chart_bar_horizontal;}@Overrideprotected int getChartId() {return R.id.horizontal_bar_chart;}@Overrideprotected String getDisplayName() {return BarChartDisplay.BAR_CHART_DISPLAY;}@Overrideprotected HorizontalBarChartDisplay createDefaultDisplay() {return new HorizontalBarChartDisplay();}@Overrideprotected void setupChart() {chart.setOnChartValueSelectedListener(this);chart.setDrawValueAboveBar(true);chart.getDescription().setEnabled(false);int yAxisMinimum = getResources().getInteger(R.integer.y_axis_minimum);XAxis leftAxis = chart.getXAxis();leftAxis.setPosition(XAxis.XAxisPosition.BOTTOM);leftAxis.setDrawGridLines(false);leftAxis.setGranularity(NORMAL_GRANULARITY);leftAxis.setLabelCount(maxBarCountOnScreen);YAxis topAxis = chart.getAxisLeft();topAxis.setDrawGridLines(true);topAxis.setAxisMinimum(yAxisMinimum);YAxis bottomAxis = chart.getAxisRight();bottomAxis.setDrawGridLines(false);bottomAxis.setAxisMinimum(yAxisMinimum);disableLegend();}private void disableLegend() {Legend legend = chart.getLegend();legend.setEnabled(false);}private void setupXAxisValueFormatter(@NonNull IAxisValueFormatter xAxisFormatter) {XAxis xAxis = chart.getXAxis();xAxis.setValueFormatter(xAxisFormatter);}private void setupMarker(@NonNull IAxisValueFormatter xAxisFormatter,@NonNull IAxisValueFormatter yAxisFormatter) {HorizontalBarChartMarkerView mv = new HorizontalBarChartMarkerView(extractContext(),xAxisFormatter, yAxisFormatter);mv.setChartView(chart);chart.setMarker(mv);}@Overrideprotected void showData(Map<Float, List<OperationView>> groupedOperations) {if (groupedOperations.isEmpty()) {clearData(R.string.chart_no_data);return;}List<BarEntry> barEntries = convertOperations(groupedOperations);Map<Float, Float> idIndexMap = idIndexMapStatefulBuilder.build();String[] articleNames = convertToArticleNames(idIndexMap);IAxisValueFormatter xAxisFormatter = determineXAxisFormatter(articleNames);setupXAxisValueFormatter(xAxisFormatter);setupMarker(xAxisFormatter, determineYAxisFormatter());BarDataSet expenseSet = buildBarDataSet(barEntries, getDataSetLabel(), getDataSetColor(),display.isViewValues());BarData data = new BarData(expenseSet);data.setValueTextSize(barValueTextSize);data.setValueFormatter(determineDataSetValueFormatter());chart.setData(data);chart.setVisibleXRangeMaximum(maxBarCountOnScreen);fixChartWidth(groupedOperations.size());chart.moveViewTo(0, 0, YAxis.AxisDependency.LEFT);chart.animateY(Y_AXIS_ANIMATION_DURATION);}@StringResprotected abstract int getDataSetLabel();@ColorResprotected abstract int getDataSetColor();private String[] convertToArticleNames(Map<Float, Float> idIndexMap) {Set<Integer> articleIds = Stream.of(idIndexMap.keySet()).map(Float::intValue).collect(Collectors.toSet());List<Article> articles = data.select(Article.class, Article.ID, Article.NAME).where(Article.ID.in(articleIds)).get().toList();String[] articleNames = new String[articles.size()];Stream.of(articles).forEach(article -> {float articleId = article.getId();int barIndex = idIndexMap.get(articleId).intValue();articleNames[barIndex] = article.getName();});return articleNames;}private BarDataSet buildBarDataSet(List<BarEntry> barEntries,@StringRes int dataSetLabel,@ColorRes int dataSetColor,boolean drawValuesEnabled) {BarDataSet dataSet = new BarDataSet(barEntries, getString(dataSetLabel));dataSet.setDrawIcons(false);dataSet.setColors(ContextCompat.getColor(extractContext(), dataSetColor));dataSet.setDrawValues(drawValuesEnabled);return dataSet;}private void fixChartWidth(int numberOfEntries) {if (numberOfEntries < maxBarCountOnScreen) {chart.fitScreen();} else {scaleToAcceptableSize(numberOfEntries);}}private void scaleToAcceptableSize(int numberOfEntries) {chart.getViewPortHandler().setMaximumScaleX(numberOfEntries / 2);}private void updateDrawValues() {BarData chartData = chart.getData();if (chartData != null) {chartData.setDrawValues(display.isViewValues());}chart.invalidate();}@Overridepublic void onValueSelected(Entry e, Highlight h) {if (e == null) {return;}RectF bounds = onValueSelectedRectF;chart.getBarBounds((BarEntry) e, bounds);MPPointF position = chart.getPosition(e,chart.getData().getDataSetByIndex(h.getDataSetIndex()).getAxisDependency());MPPointF.recycleInstance(position);}@Overridepublic void onNothingSelected() {// do nothing}@Overridepublic void onApplyDisplay(HorizontalBarChartDisplay display) {if (this.display.needRefreshData(display)) {this.display = display;operationGrouper = determineOperationGrouper();operationConverter = determineOperationConverter();refreshData();} else {this.display = display;updateDrawValues();}}@Overrideprotected OperationConverter<BarEntry> determineOperationConverter() {idIndexMapStatefulBuilder = IdIndexMapStatefulBuilder.create();if (display.isUsePercentValues()) {return new OperationHorizontalBarPercentConverter(extractContext(),idIndexMapStatefulBuilder);}return new OperationHorizontalBarConverter(extractContext(), idIndexMapStatefulBuilder);}@Overrideprotected OperationGrouper determineOperationGrouper() {switch (display.getGroupByType()) {case ARTICLE:return new OperationGrouperByArticle();case ARTICLE_PARENT:return new OperationGrouperByArticleParent();}throw new UnsupportedHorizontalBarChartGroupByTypeException();}@NonNullprivate IAxisValueFormatter determineXAxisFormatter(String[] articleNames) {return new IndexAxisValueFormatter(articleNames);}@NonNullprivate IAxisValueFormatter determineYAxisFormatter() {if (display.isUsePercentValues()) {return new PercentFormatter();}return new LocalizedValueFormatter();}@NonNullprivate IValueFormatter determineDataSetValueFormatter() {if (display.isUsePercentValues()) {return new PercentFormatter();}return new LargeValueFormatter();}}",FamilyFinance/app/src/main/java/io/github/zwieback/familyfinance/business/chart/fragment/HorizontalBarChartFragment.java
2,"package io.github.zwieback.familyfinance.business.chart.fragment;import android.content.res.Configuration;import android.graphics.Color;import android.os.Bundle;import android.support.annotation.Nullable;import android.support.annotation.StringRes;import com.github.mikephil.charting.animation.Easing;import com.github.mikephil.charting.charts.PieChart;import com.github.mikephil.charting.components.Legend;import com.github.mikephil.charting.data.PieData;import com.github.mikephil.charting.data.PieDataSet;import com.github.mikephil.charting.data.PieEntry;import com.github.mikephil.charting.formatter.IValueFormatter;import com.github.mikephil.charting.formatter.LargeValueFormatter;import com.github.mikephil.charting.formatter.PercentFormatter;import java.util.Collections;import java.util.List;import java.util.Map;import io.github.zwieback.familyfinance.R;import io.github.zwieback.familyfinance.business.chart.display.PieChartDisplay;import io.github.zwieback.familyfinance.business.chart.exception.UnsupportedPieChartGroupByTypeException;import io.github.zwieback.familyfinance.business.chart.exception.UnsupportedPieChartGroupingTypeException;import io.github.zwieback.familyfinance.business.chart.marker.PieChartMarkerView;import io.github.zwieback.familyfinance.business.chart.service.converter.OperationConverter;import io.github.zwieback.familyfinance.business.chart.service.converter.pie.OperationPieLimitConverter;import io.github.zwieback.familyfinance.business.chart.service.converter.pie.OperationPieSimpleConverter;import io.github.zwieback.familyfinance.business.chart.service.formatter.LocalizedValueFormatter;import io.github.zwieback.familyfinance.business.chart.service.grouper.OperationGrouper;import io.github.zwieback.familyfinance.business.chart.service.grouper.pie.OperationGrouperByArticle;import io.github.zwieback.familyfinance.business.chart.service.grouper.pie.OperationGrouperByArticleParent;import io.github.zwieback.familyfinance.business.operation.filter.OperationFilter;import io.github.zwieback.familyfinance.core.model.OperationView;import io.github.zwieback.familyfinance.util.ColorUtils;import io.github.zwieback.familyfinance.util.ConfigurationUtils;public abstract class PieChartFragment<F extends OperationFilter> extends ChartFragment<PieChart,PieEntry, F, PieChartDisplay> {private static final float SLICE_SPACE = 2f;private static final int Y_AXIS_ANIMATION_DURATION = 500;private float pieValueTextSize;@Overridepublic void onCreate(@Nullable Bundle savedInstanceState) {super.onCreate(savedInstanceState);pieValueTextSize = getResources().getDimension(R.dimen.pie_value_text_size);}@Overrideprotected int getFragmentChartLayout() {return R.layout.fragment_chart_pie;}@Overrideprotected int getChartId() {return R.id.pie_chart;}@Overrideprotected String getDisplayName() {return PieChartDisplay.PIE_CHART_DISPLAY;}@Overrideprotected PieChartDisplay createDefaultDisplay() {return new PieChartDisplay();}@Overrideprotected void setupChart() {chart.setUsePercentValues(display.isUsePercentValues());chart.getDescription().setEnabled(false);chart.setEntryLabelColor(Color.BLACK);chart.setEntryLabelTextSize(pieValueTextSize);setupLegend();setupMarker();}private void setupLegend() {Legend legend = chart.getLegend();legend.setVerticalAlignment(Legend.LegendVerticalAlignment.TOP);legend.setOrientation(determineLegendOrientation());legend.setWordWrapEnabled(true);}private Legend.LegendOrientation determineLegendOrientation() {return ConfigurationUtils.getOrientation() == Configuration.ORIENTATION_PORTRAIT? Legend.LegendOrientation.HORIZONTAL: Legend.LegendOrientation.VERTICAL;}private void setupMarker() {PieChartMarkerView mv = new PieChartMarkerView(extractContext(),new LocalizedValueFormatter());mv.setChartView(chart);chart.setMarker(mv);}@Overrideprotected void showData(Map<Float, List<OperationView>> groupedOperations) {if (groupedOperations.isEmpty()) {clearData(R.string.chart_no_data);return;}PieDataSet expenseSet = buildPieDataSet(groupedOperations, getDataSetLabel());PieData data = new PieData(expenseSet);data.setValueFormatter(determineFormatter());data.setDrawValues(display.isViewValues());chart.setUsePercentValues(display.isUsePercentValues());chart.setData(data);chart.animateY(Y_AXIS_ANIMATION_DURATION, Easing.EasingOption.EaseInOutQuad);}@StringResprotected abstract int getDataSetLabel();private PieDataSet buildPieDataSet(Map<Float, List<OperationView>> operations,@StringRes int dataSetLabel) {List<Integer> colors = collectDataColors();List<PieEntry> pieEntries = convertOperations(operations);PieDataSet dataSet = new PieDataSet(pieEntries, getString(dataSetLabel));dataSet.setDrawIcons(false);dataSet.setColors(colors);dataSet.setSliceSpace(SLICE_SPACE);dataSet.setValueTextSize(pieValueTextSize);return dataSet;}private List<Integer> collectDataColors() {List<Integer> colors = ColorUtils.collectMaterialDesignColors(extractContext());Collections.shuffle(colors);return colors;}@Overridepublic void onApplyFilter(F filter) {this.filter = filter;refreshData();}@Overridepublic void onApplyDisplay(PieChartDisplay display) {if (this.display.needRefreshData(display)) {this.display = display;operationConverter = determineOperationConverter();operationGrouper = determineOperationGrouper();refreshData();} else {this.display = display;PieData chartData = chart.getData();if (chartData != null) {chartData.setDrawValues(display.isViewValues());chartData.setValueFormatter(determineFormatter());}chart.setUsePercentValues(display.isUsePercentValues());chart.invalidate();}}@Overrideprotected OperationConverter<PieEntry> determineOperationConverter() {switch (display.getGroupingType()) {case SIMPLE:return new OperationPieSimpleConverter(extractContext(), display.getGroupByType());case LIMIT:return new OperationPieLimitConverter(extractContext(), display.getGroupByType());}throw new UnsupportedPieChartGroupingTypeException();}@Overrideprotected OperationGrouper determineOperationGrouper() {switch (display.getGroupByType()) {case ARTICLE:return new OperationGrouperByArticle();case ARTICLE_PARENT:return new OperationGrouperByArticleParent();}throw new UnsupportedPieChartGroupByTypeException();}private IValueFormatter determineFormatter() {return display.isUsePercentValues()? new PercentFormatter(): new LargeValueFormatter();}}",FamilyFinance/app/src/main/java/io/github/zwieback/familyfinance/business/chart/fragment/PieChartFragment.java
53,"/*#######################################################**   Maintained by Gregor Santner, 2018-*   https://gsantner.net/**   License of this file: Apache 2.0 (Commercial upon request)*     https://www.apache.org/licenses/LICENSE-2.0*#########################################################*/package net.gsantner.markor.ui;import android.annotation.SuppressLint;import android.app.Dialog;import android.os.Build;import android.os.Bundle;import android.os.Handler;import android.support.annotation.NonNull;import android.support.v4.app.DialogFragment;import android.support.v4.provider.DocumentFile;import android.support.v7.app.AlertDialog;import android.text.InputFilter;import android.text.TextUtils;import android.view.LayoutInflater;import android.view.View;import android.view.Window;import android.view.WindowManager;import android.widget.CheckBox;import android.widget.EditText;import android.widget.Spinner;import net.gsantner.markor.R;import net.gsantner.markor.format.todotxt.TodoTxtTask;import net.gsantner.markor.util.AppSettings;import net.gsantner.markor.util.ShareUtil;import net.gsantner.opoc.ui.AndroidSpinnerOnItemSelectedAdapter;import net.gsantner.opoc.util.Callback;import net.gsantner.opoc.util.ContextUtils;import java.io.File;import java.security.SecureRandom;import java.util.Date;import java.util.concurrent.atomic.AtomicBoolean;import other.de.stanetz.jpencconverter.JavaPasswordbasedCryption;import other.de.stanetz.jpencconverter.PasswordStore;public class NewFileDialog extends DialogFragment {public static final String FRAGMENT_TAG = ""net.gsantner.markor.ui.NewFileDialog"";public static final String EXTRA_DIR = ""EXTRA_DIR"";private Callback.a2<Boolean, File> callback;public static NewFileDialog newInstance(File sourceFile, Callback.a2<Boolean, File> callback) {NewFileDialog dialog = new NewFileDialog();Bundle args = new Bundle();args.putSerializable(EXTRA_DIR, sourceFile);dialog.setArguments(args);dialog.callback = callback;return dialog;}@NonNull@Overridepublic Dialog onCreateDialog(Bundle savedInstanceState) {final File file = (File) getArguments().getSerializable(EXTRA_DIR);LayoutInflater inflater = LayoutInflater.from(getActivity());AlertDialog.Builder dialogBuilder = makeDialog(file, inflater);AlertDialog dialog = dialogBuilder.show();Window w;if ((w = dialog.getWindow()) != null) {w.setLayout(WindowManager.LayoutParams.MATCH_PARENT, WindowManager.LayoutParams.WRAP_CONTENT);}return dialog;}@SuppressLint(""SetTextI18n"")private AlertDialog.Builder makeDialog(final File basedir, LayoutInflater inflater) {View root;AlertDialog.Builder dialogBuilder;final AppSettings appSettings = new AppSettings(inflater.getContext());dialogBuilder = new AlertDialog.Builder(inflater.getContext(), appSettings.isDarkThemeEnabled() ? R.style.Theme_AppCompat_Dialog : R.style.Theme_AppCompat_Light_Dialog);root = inflater.inflate(R.layout.new_file_dialog, null);final EditText fileNameEdit = root.findViewById(R.id.new_file_dialog__name);final EditText fileExtEdit = root.findViewById(R.id.new_file_dialog__ext);final CheckBox encryptCheckbox = root.findViewById(R.id.new_file_dialog__encrypt);final Spinner typeSpinner = root.findViewById(R.id.new_file_dialog__type);final Spinner templateSpinner = root.findViewById(R.id.new_file_dialog__template);final String[] typeSpinnerToExtension = getResources().getStringArray(R.array.new_file_types__file_extension);if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT && appSettings.hasPasswordBeenSetOnce()) {encryptCheckbox.setChecked(appSettings.getNewFileDialogLastUsedEncryption());} else {encryptCheckbox.setVisibility(View.GONE);}fileExtEdit.setText(appSettings.getNewFileDialogLastUsedExtension());fileNameEdit.requestFocus();new Handler().postDelayed(new ContextUtils.DoTouchView(fileNameEdit), 200);fileNameEdit.setFilters(new InputFilter[]{ContextUtils.INPUTFILTER_FILENAME});fileExtEdit.setFilters(fileNameEdit.getFilters());final AtomicBoolean typeSpinnerNoTriggerOnFirst = new AtomicBoolean(true);typeSpinner.setOnItemSelectedListener(new AndroidSpinnerOnItemSelectedAdapter(pos -> {if (typeSpinnerNoTriggerOnFirst.getAndSet(false)) {return;}String ext = pos < typeSpinnerToExtension.length ? typeSpinnerToExtension[pos] : """";if (ext != null) {if (encryptCheckbox.isChecked()) {fileExtEdit.setText(ext + JavaPasswordbasedCryption.DEFAULT_ENCRYPTION_EXTENSION);} else {fileExtEdit.setText(ext);}}fileNameEdit.setSelection(fileNameEdit.length());appSettings.setNewFileDialogLastUsedType(typeSpinner.getSelectedItemPosition());}));typeSpinner.setSelection(appSettings.getNewFileDialogLastUsedType());templateSpinner.setOnItemSelectedListener(new AndroidSpinnerOnItemSelectedAdapter(pos -> {String prefix = null;if (pos == 3) { // Jekyllprefix = TodoTxtTask.DATEF_YYYY_MM_DD.format(new Date()) + ""-"";}if (!TextUtils.isEmpty(prefix) && !fileNameEdit.getText().toString().startsWith(prefix)) {fileNameEdit.setText(prefix + fileNameEdit.getText().toString());}fileNameEdit.setSelection(fileNameEdit.length());}));encryptCheckbox.setOnCheckedChangeListener((buttonView, isChecked) -> {final String currentExtention = fileExtEdit.getText().toString();if (isChecked) {if (!currentExtention.endsWith(JavaPasswordbasedCryption.DEFAULT_ENCRYPTION_EXTENSION)) {fileExtEdit.setText(currentExtention + JavaPasswordbasedCryption.DEFAULT_ENCRYPTION_EXTENSION);}} else if (currentExtention.endsWith(JavaPasswordbasedCryption.DEFAULT_ENCRYPTION_EXTENSION)) {fileExtEdit.setText(currentExtention.replace(JavaPasswordbasedCryption.DEFAULT_ENCRYPTION_EXTENSION, """"));}appSettings.setNewFileDialogLastUsedEncryption(isChecked);});dialogBuilder.setView(root);fileNameEdit.requestFocus();final ShareUtil shareUtil = new ShareUtil(getContext());dialogBuilder.setNegativeButton(R.string.cancel, (dialogInterface, i) -> dialogInterface.dismiss()).setPositiveButton(getString(android.R.string.ok), (dialogInterface, i) -> {if (ez(fileNameEdit)) {return;}appSettings.setNewFileDialogLastUsedExtension(fileExtEdit.getText().toString().trim());final File f = new File(basedir, fileNameEdit.getText().toString().trim() + fileExtEdit.getText().toString().trim());final byte[] templateContents = getTemplateContent(templateSpinner, basedir, encryptCheckbox.isChecked());shareUtil.writeFile(f, false, (arg_ok, arg_fos) -> {try {if (f.exists() && f.length() < ShareUtil.MIN_OVERWRITE_LENGTH && templateContents != null) {arg_fos.write(templateContents);}} catch (Exception ignored) {}callback(arg_ok || f.exists(), f);dialogInterface.dismiss();});}).setNeutralButton(R.string.folder, (dialogInterface, i) -> {if (ez(fileNameEdit)) {return;}File f = new File(basedir, fileNameEdit.getText().toString());if (shareUtil.isUnderStorageAccessFolder(f)) {DocumentFile dof = shareUtil.getDocumentFile(f, true);callback(dof != null && dof.exists(), f);} else {callback(f.mkdirs() || f.exists(), f);}dialogInterface.dismiss();});return dialogBuilder;}private boolean ez(EditText et) {return et.getText().toString().isEmpty();}private void callback(boolean ok, File file) {try {callback.callback(ok, file);} catch (Exception ignored) {}}// How to get content out of a file:// 1) Replace \n with \\n | copy to clipboard//    cat markor-markdown-reference.md  | sed 's@\\@\\\\@g' | sed -z 's@\n@\\n@g'  | xclip//// 2) t = ""<cursor>"";  | ctrl+shift+v ""paste without formatting""//private byte[] getTemplateContent(final Spinner templateSpinner, final File basedir, final boolean encrypt) {String t = null;byte[] bytes = null;switch (templateSpinner.getSelectedItemPosition()) {case 1: {t = ""# Markdown Reference\nAutomatically generate _table of contents_ by checking the option here: `Settings > Format > Markdown`.\n\n## H2 Header\n### H3 header\n#### H4 Header\n##### H5 Header\n###### H6 Header\n\n<!-- --------------- -->\n\n## Format Text\n\n*Italic emphasis* , _Alternative italic emphasis_\n\n**Bold emphasis** , __Alternative bold emphasis__\n\n~~Strikethrough~~\n\nBreak line (two spaces at end of line)  \n\n> Block quote\n\n`Inline code`\n\n```\nCode blocks\nare\nawesome\n```\n\n<!-- --------------- -->\n \n## Lists\n### Ordered & unordered\n\n* Unordered list\n* ...with asterisk/star\n* Test\n\n- Another unordered list\n- ...with hyphen/minus\n- Test\n\n1. Ordered list\n2. Test\n3. Test\n4. Test\n\n- Nested lists\n    * Unordered nested list\n    * Test\n    * Test\n    * Test\n- Ordered nested list\n    1. Test\n    2. Test\n    3. Test\n    4. Test\n- Double-nested unordered list\n    - Test\n    - Unordered\n        - Test a\n        - Test b\n    - Ordered\n        1. Test 1\n        2. Test 2\n\n### Checklist\n* [ ] Salad\n* [x] Potatoes\n\n1. [x] Clean\n2. [ ] Cook\n\n<!-- --------------- -->\n\n## Links\n[Link](https://duckduckgo.com/)\n\n[File in same folder as the document.](markor-markdown-reference.md) Use %20 for spaces!\n\n<!-- --------------- -->\n\n## Tables\n\n| Left aligned | Middle aligned | Right aligned |\n| :--------------- | :------------------: | -----------------: |\n| Test                 | Test                      | Test                    |\n| Test                 | Test                      | Test                    |\n\n÷÷÷÷\n\nShorter | Table | Syntax\n:---: | ---: | :---\nTest | Test | Test\nTest | Test | Test\n\n<!-- Comment: Not visibile in view. Can also span across multiple lines. End with:-->\n\n<!-- --------------- -->\n\n## Math (KaTeX)\nSee [reference](https://katex.org/docs/supported.html) & [examples](https://github.com/waylonflinn/markdown-it-katex/blob/master/README.md). Enable by checking Math at `Settings > Markdown`.\n\n### Math inline\n\n$ I = \\frac V R $\n\n### Math block\n\n<div>\n$$\\begin{array}{c} \\nabla \\times \\vec{\\mathbf{B}} -\\, \\frac1c\\, \\frac{\\partial\\vec{\\mathbf{E}}}{\\partial t} & = \\frac{4\\pi}{c}\\vec{\\mathbf{j}} \\nabla \\cdot \\vec{\\mathbf{E}} & = 4 \\pi \\rho \\\\ \\nabla \\times \\vec{\\mathbf{E}}\\, +\\, \\frac1c\\, \\frac{\\partial\\vec{\\mathbf{B}}}{\\partial t} & = \\vec{\\mathbf{0}} \\\\ \\nabla \\cdot \\vec{\\mathbf{B}} & = 0 \\end{array}$$\n</div>\n\n\n$$\\frac{k_t}{k_e} = \\sqrt{2}$$\n\n<!-- --------------- -->\n\n## Format Text (continued)\n\n### Text color\n\n<span style='background-color:#ffcb2e;'>Text with background color / highlight</span>\n\n<span style='color:#3333ff;'>Text foreground color</span>\n\n<span style='text-shadow: 0px 0px 2px #FF0000;'>Text with colored outline</span> / <span style='text-shadow: 0px 0px 2px #0000FF; color: white'>Text with colored outline</span>\n\n\n### Text sub & superscript\n\n<u>Underline</u>\n\nThe <sub>Subway</sub> sandwich was <sup>super</sup>\n\nSuper special characters: ⁰ ¹ ² ³ ⁴ ⁵ ⁶ ⁷ ⁸ ⁹ ⁺ ⁻ ⁼ ⁽ ⁾ ⁿ ™ ® ℠\n\n### Text positioning\n<div markdown='1' align='right'>\n\ntext on the **right**\n\n</div>\n\n<div markdown='1' align='center'>\n\ntext in the **center**  \n(one empy line above and below  \nrequired for Markdown support OR markdown='1')\n\n</div>\n\n### Block Text\n\n<div markdown='1' style='text-align: justify; text-justify: inter-word;'>\nlorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. \n</div>\n\n### Dropdown\n\n<details markdown='1'><summary>Click to Expand/Collapse</summary>\n\nExpanded content. Shows up and keeps visible when clicking expand. Hide again by clicking the dropdown button again.\n\n</details>\n\n\n<!-- --------------- -->\n\n## Multimedia\n\n### Images\n![Image](https://gsantner.net/assets/blog/img/markor/markor-v1-7-showcase-3.jpg)\n\n### Videos\n**Youtube** [Welcome to Upper Austria](https://www.youtube.com/watch?v=RJREFH7Lmm8)\n<iframe width='360' height='200' src='https://www.youtube.com/embed/RJREFH7Lmm8'> </iframe>\n\n**Peertube** [Road in the wood](https://open.tube/videos/watch/8116312a-dbbd-43a3-9260-9ea6367c72fc)\n<div><video controls><source src='https://peertube.mastodon.host/download/videos/8116312a-dbbd-43a3-9260-9ea6367c72fc-480.mp4' </source></video></div>\n\n<!-- **Local video** <div><video controls><source src='voice-parrot.mp4' </source></video></div> -->\n\n### Audio & Music\n**Web audio** [Guifrog - Xia Yu](https://www.freemusicarchive.org/music/Guifrog/Xia_Yu)\n<audio controls src='https://files.freemusicarchive.org/storage-freemusicarchive-org/music/ccCommunity/Guifrog/Xia_Yu/Guifrog_-_Xia_Yu.mp3'></audio>\n\n**Local audio** Yellowcard - Lights up in the sky\n<audio controls src='../Music/mp3/Yellowcard/[2007]%20Paper%20Walls/Yellowcard%20-%2005%20-%20Light%20Up%20the%20Sky.mp3'></audio>\n\n------------------\n\nThis Markdown reference file was created for the [Markor](https://gsantner.net/project/markor?source=markdownref) project by [Gregor Santner](https://gsantner.net) and is licensed [Creative Commons Zero 1.0](https://creativecommons.org/publicdomain/zero/1.0/legalcode) (public domain). File revision 2.\n\n------------------\n\n\n"";break;}case 2: {t = ""(A) Call Mom @mobile +family\n(A) Schedule annual checkup +health\n(A) Urgently buy milk @shop\n(B) Outline chapter 5 +novel @computer\n(C) Add cover sheets @work +myproject\nPlan backyard herb garden @home\nBuy salad @shop\nWrite blog post @pc\nInstall Markor @mobile\n2019-06-24 scan photos @home +blog\n2019-06-25 draw diagram @work \nx This has been done @home +renovations"";break;}case 3: {t = ""---\nlayout: post\ntags: []\ncategories: []\n#date: 2019-06-25 13:14:15\n#excerpt: ''\n#image: 'BASEURL/assets/blog/img/.png'\n#description:\n#permalink:\ntitle: 'title'\n---\n\n\n"";break;}case 4: {t = ""# Title\n## Description\n\n![Text](picture.png)\n\n### Ingredients\n\n|  Ingredient   | Amount |\n|:--------------|:-------|\n| 1             | 1      |\n| 2             | 2      |\n| 3             | 3      |\n| 4             | 4      |\n\n\n### Preparation\n\n1. Text\n2. Text\n\n"";break;}case 5: {t = ""---\nclass: beamer\n---\n\n-----------------\n# Cool presentation\n\n## Abed Nadir\n\n{{ post.date_today }}\n\n<!-- Overall slide design -->\n<style>\n.slide {\nbackground:url() no-repeat center center fixed; background-size: cover;\n}\n.slide_type_title {\nbackground: slategrey;\n}\n</style>\n\n-----------------\n\n## Slide title\n\n\n1. All Markdown features of Markor are **supported** for Slides too ~~strikeout~~ _italic_ `code`\n2. Start new slides with 3 more hyphens (---) separated by empty lines\n3. End last slide with hyphens too\n4. Slide backgrounds can be configured using CSS, for all and individual slides\n5. Print / PDF export in landscape mode\n6. Create title only slides (like first slide) by starting the slide (line after `---`) with title `# title`\n\n\n-----------------\n## Slide with centered image\n* Images can be centered by adding 'imghcenter' in alt text & grown to page size with 'imgbig'\n* Example: `![text imghcenter imgbig text](a.jpg)`\n\n![imghcenter imgbig](file:///android_asset/img/flowerfield.jpg)\n\n\n\n\n-----------------\n## Page with gradient background\n* and a picture\n* configure background color/image with CSS .slide_p4 { } (4 = the slide page number)\n\n![pic](file:///android_asset/img/flowerfield.jpg)\n\n\n<style> .slide_p4 { background: linear-gradient(to bottom, #11998e, #38ef7d); } </style>\n\n-----------------\n## Page with image background\n* containing text and a table\n\n| Left aligned | Middle aligned | Right aligned |\n| :------------------- | :----------------------: | --------------------: |\n| Test               | Test                    | Test                |\n| Test               | Test                    | Test                |\n\n\n\n<style> \n.slide_p5 { background: url('file:///android_asset/img/schindelpattern.jpg') no-repeat center center fixed; background-size: cover; }\n.slide_p5 > .slide_body > * { color: black; }\n</style>\n\n-----------------\n"";break;}case 6: {t = ""Content-Type: text/x-zim-wiki\nWiki-Format: zim 0.4\nCreation-Date: 2019-01-28T20:53:47+01:00\n\n====== Zim Wiki ======\nLet me try to gather a list of the formatting options Zim provides.\n\n====== Head 1 ======\n\n===== Head 2 =====\n\n==== Head 3 ====\n\n=== Head 4 ===\n\n== Head 5 ==\n\n**Bold**\n//italics//\n__marked (yellow Background)__\n~~striked~~\n\n* Unordered List\n* second item\n	* [[Sub-Item]]\n		* Subsub-Item\n			* and one more sub\n* Back to first indent level\n\n1. ordered list\n2. second item\n	a. item 2a\n		1. Item 2a1\n		2. Item 2a2\n	b. item 2b\n		1. 2b1\n			a. 2b1a\n3. an so on...\n\n[ ] Checklist\n[ ] unchecked item\n[*] checked item\n[x] crossed item\n[>] Item marked with a yellow left-to-right-arrow\n[ ] another unchecked item\n\n\nThis ist ''preformatted text'' inline.\n\n'''\nThis is a preformatted text block.\nIt spans multiple lines.\nAnd it's visually indented.\n'''\n\nWe also have _{subscript} and ^{superscript}.\n\nIt seems there is no way to combine those styles.\n//**this is simply italic**// and you can see the asterisks.\n**//This is simply bold//** and you can see the slashes.\n__**This is simply marked yellow**__ and you can see the asterisks.\n\nThis is a web link: [[https://github.com/gsantner/markor|Markor on Github]]\nLinks inside the Zim Wiki project can be made by simply using the [[Page Name]] in double square brackets.\nThis my also contain some hierarchy information, like [[Folder:Subfolder:Document Name]]\n\n\nThis zim wiki reference file was created for the [[https://gsantner.net/project/markor?source=markdownref|Markor]] project by [[https://gsantner.net|Gregor Santner]] and is licensed [[https://creativecommons.org/publicdomain/zero/1.0/legalcode|Creative Commons Zero 1.0]] (public domain). File revision 1."";break;}case 7: {t = ""---\ntags: []\ncreated: '{{ template.timestamp_date_yyyy_mm_dd }}'\ntitle: ''\n---\n\n"";if (basedir != null && new File(basedir.getParentFile(), "".notabledir"").exists()) {t = t.replace(""created:"", ""modified:"");}break;}default:case 0: {return null; // Empty file template (that doesn't overwrite anything}}t = t.replace(""{{ template.timestamp_date_yyyy_mm_dd }}"", TodoTxtTask.DATEF_YYYY_MM_DD.format(new Date()));if (encrypt && Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {bytes = new JavaPasswordbasedCryption(JavaPasswordbasedCryption.Version.V001, new SecureRandom()).encrypt(t, new PasswordStore(getContext()).loadKey(R.string.pref_key__default_encryption_password));} else {bytes = t.getBytes();}return bytes;}}",markor/app/src/main/java/net/gsantner/markor/ui/NewFileDialog.java
53,"/*#######################################################**   Maintained by Gregor Santner, 2017-*   https://gsantner.net/**   License of this file: Apache 2.0 (Commercial upon request)*     https://www.apache.org/licenses/LICENSE-2.0*#########################################################*/package net.gsantner.markor.util;import android.content.Context;import android.content.SharedPreferences;import android.graphics.Color;import android.os.Build;import android.os.Environment;import android.support.annotation.ColorRes;import android.support.annotation.IdRes;import android.support.v4.util.Pair;import net.gsantner.markor.App;import net.gsantner.markor.BuildConfig;import net.gsantner.markor.R;import net.gsantner.opoc.preference.SharedPreferencesPropertyBackend;import net.gsantner.opoc.ui.FilesystemViewerAdapter;import net.gsantner.opoc.ui.FilesystemViewerFragment;import java.io.File;import java.util.ArrayList;import java.util.Arrays;import java.util.Collections;import java.util.Comparator;import java.util.List;import java.util.Locale;import java.util.Random;@SuppressWarnings(""SameParameterValue"")public class AppSettings extends SharedPreferencesPropertyBackend {private final SharedPreferences _prefCache;private final SharedPreferences _prefHistory;public static Boolean isDeviceGoodHardware = null;private static final File LOCAL_TESTFOLDER_FILEPATH = new File(""/storage/emulated/0/00_sync/documents/special"");public AppSettings(Context _context) {super(_context);_prefCache = _context.getSharedPreferences(""cache"", Context.MODE_PRIVATE);_prefHistory = _context.getSharedPreferences(""history"", Context.MODE_PRIVATE);if (isDeviceGoodHardware == null) {ContextUtils cu = new ContextUtils(_context);isDeviceGoodHardware = cu.isDeviceGoodHardware();cu.freeContextRef();}}public static AppSettings get() {return new AppSettings(App.get());}public void setDarkThemeEnabled(boolean enabled) {setString(R.string.pref_key__app_theme, enabled ? ""dark"" : ""light"");}public boolean isDarkThemeEnabled() {switch (getString(R.string.pref_key__app_theme, ""light"")) {case ""light"": {return false;}case ""dark"": {return true;}case ""auto"":default: {return !isCurrentHourOfDayBetween(9, 17);}}}public int getBackgroundColor() {return isDarkThemeEnabled() ? rcolor(R.color.dark__background) : rcolor(R.color.light__background);}public boolean isLoadLastDirectoryAtStartup() {return getBool(R.string.pref_key__load_last_directory_at_startup, false);}public boolean isPreviewFirst() {return getBool(R.string.pref_key__is_preview_first, false);}public void setSaveDirectory(String value) {setString(R.string.pref_key__notebook_directory, value);}public File getNotebookDirectory() {return new File(getNotebookDirectoryAsStr());}public String getNotebookDirectoryAsStr() {String dir = getString(R.string.pref_key__notebook_directory, """");if (dir.isEmpty() && LOCAL_TESTFOLDER_FILEPATH.exists() && !BuildConfig.IS_TEST_BUILD) {dir = LOCAL_TESTFOLDER_FILEPATH.getParentFile().getParent();setSaveDirectory(dir);}if (dir.isEmpty()) {dir = new File(new File(Environment.getExternalStorageDirectory(), ""/Documents""), rstr(R.string.app_name).toLowerCase(Locale.ROOT)).getAbsolutePath();setSaveDirectory(dir);}return dir;}public File getQuickNoteFile() {String defaultValue = new File(getNotebookDirectoryAsStr(), rstr(R.string.quicknote_default_filename)).getAbsolutePath();if (LOCAL_TESTFOLDER_FILEPATH.exists() && !BuildConfig.IS_TEST_BUILD) {defaultValue = new File(LOCAL_TESTFOLDER_FILEPATH, rstr(R.string.quicknote_default_filename)).getAbsolutePath();}return new File(getString(R.string.pref_key__quicknote_filepath, defaultValue));}public void setQuickNoteFile(File file) {setString(R.string.pref_key__quicknote_filepath, file.getAbsolutePath());}public File getTodoFile() {String defaultValue = new File(getNotebookDirectoryAsStr(), rstr(R.string.todo_default_filename)).getAbsolutePath();if (LOCAL_TESTFOLDER_FILEPATH.exists() && !BuildConfig.IS_TEST_BUILD) {defaultValue = new File(LOCAL_TESTFOLDER_FILEPATH, rstr(R.string.todo_default_filename)).getAbsolutePath();}return new File(getString(R.string.pref_key__todo_filepath, defaultValue));}public void setTodoFile(File file) {setString(R.string.pref_key__todo_filepath, file.getAbsolutePath());}public String getFontFamily() {return getString(R.string.pref_key__font_family, rstr(R.string.default_font_family));}public int getFontSize() {return getInt(R.string.pref_key__editor_font_size, 15);}public int getViewFontSize() {int size = getInt(R.string.pref_key__view_font_size, -1);return size < 2 ? getFontSize() : size;}public boolean isHighlightingEnabled() {return getBool(R.string.pref_key__is_highlighting_activated, true);}public int getMarkdownHighlightingDelay() {return getInt(R.string.pref_key__markdown__hl_delay_v2, 650);}public boolean isMarkdownHighlightLineEnding() {return getBool(R.string.pref_key__markdown__highlight_lineending_two_or_more_space, false);}public boolean isMarkdownHighlightCodeFontMonospaceAllowed() {return getBool(R.string.pref_key__markdown__monospace_some_parts, false);}public boolean isMarkdownDisableCodeBlockHighlight() {return getBool(R.string.pref_key__markdown__disable_code_block_highlight, false);}public boolean isMarkdownAutoUpdateList() {return true;// return getBool(R.string.pref_key__markdown__auto_renumber_ordered_list, false);}public int getHighlightingDelayTodoTxt() {return getInt(R.string.pref_key__todotxt__hl_delay, 870);}public String getLastOpenedDirectory() {return getString(R.string.pref_key__last_opened_directory, getNotebookDirectoryAsStr());}public void setLastOpenedDirectory(String value) {setString(R.string.pref_key__last_opened_directory, value);}public boolean isRenderRtl() {return getBool(R.string.pref_key__is_render_rtl, false);}public boolean isMarkdownMathEnabled() {return getBool(R.string.pref_key__markdown_render_math, false);}public boolean isMarkdownTableOfContentsEnabled() {return getBool(R.string.pref_key__markdown_show_toc, false);}public boolean isEditorStatusBarHidden() {return getBool(R.string.pref_key__is_editor_statusbar_hidden, false);}public boolean isSpecialFileLaunchersEnabled() {if (BuildConfig.IS_TEST_BUILD) {return false;}return getBool(R.string.pref_key__is_launcher_for_special_files_enabled, false);}public boolean isKeepScreenOn() {return getBool(R.string.pref_key__is_keep_screen_on, !BuildConfig.IS_TEST_BUILD);}public boolean isOverviewStatusBarHidden() {return getBool(R.string.pref_key__is_overview_statusbar_hidden, false);}public String getLanguage() {return getString(R.string.pref_key__language, """");}public void setRecreateMainRequired(boolean value) {setBool(R.string.pref_key__is_main_recreate_required, value);}public boolean isRecreateMainRequired() {boolean ret = getBool(R.string.pref_key__is_main_recreate_required, false);setBool(R.string.pref_key__is_main_recreate_required, false);return ret;}public void setSortMethod(int value) {setInt(R.string.pref_key__sort_method, value);}public int getSortMethod() {return getInt(R.string.pref_key__sort_method, FilesystemViewerFragment.SORT_BY_NAME);}public void setSortReverse(boolean value) {setBool(R.string.pref_key__sort_reverse, value);}public boolean isSortReverse() {return getBool(R.string.pref_key__sort_reverse, false);}public boolean isShowSettingsOptionInMainToolbar() {return true;//getBool(R.string.pref_key__show_settings_option_in_main_toolbar, true);}public boolean isHighlightingHexColorEnabled() {return getBool(R.string.pref_key__is_highlighting_for_hexcolor_activated, false);}public boolean isTodoAppendProConOnEndEnabled() {return getBool(R.string.pref_key__todotxt__append_contexts_and_projects_on_end_of_task, true);}public boolean isTodoStartTasksWithTodaysDateEnabled() {return getBool(R.string.pref_key__todotxt__start_new_tasks_with_todays_date, true);}public boolean isTodoAddCompletionDateEnabled() {return getBool(R.string.pref_key__todotxt__add_completion_date_for_todos, true);}public boolean isAppCurrentVersionFirstStart(boolean doSet) {int value = getInt(R.string.pref_key__app_first_start_current_version, -1);if (doSet) {setInt(R.string.pref_key__app_first_start_current_version, BuildConfig.VERSION_CODE);}return value != BuildConfig.VERSION_CODE;}public float getEditorLineSpacing() {return getInt(R.string.pref_key__editor_line_spacing, 100) / 100f;}public void setLastTodoUsedArchiveFilename(String value) {setString(R.string.pref_key__todotxt__last_used_archive_filename, value);}public String getLastTodoUsedArchiveFilename() {return getString(R.string.pref_key__todotxt__last_used_archive_filename, ""todo.archive.txt"");}public boolean isEditorStartOnBotttom() {return getBool(R.string.pref_key__editor_start_editing_on_bottom, true);}public boolean isEditorStartEditingInCenter() {return getBool(R.string.pref_key__editor_start_editing_in_center, false);}public int getEditorTextActionItemPadding() {return getInt(R.string.pref_key__editor_textaction_bar_item_padding, 8);}public boolean isDisableSpellingRedUnderline() {return getBool(R.string.pref_key__editor_disable_spelling_red_underline, true);}public void addRecentDocument(File file) {if (!listFileInRecents(file)) {return;}if (!file.equals(getTodoFile()) && !file.equals(getQuickNoteFile())) {ArrayList<String> recent = getRecentDocuments();recent.add(0, file.getAbsolutePath());recent.remove(getTodoFile().getAbsolutePath());recent.remove(getQuickNoteFile().getAbsolutePath());recent.remove("""");recent.remove(null);setInt(file.getAbsolutePath(), getInt(file.getAbsolutePath(), 0, _prefCache) + 1, _prefCache);setRecentDocuments(recent);}ShortcutUtils.setShortcuts(_context);}public void toggleFavouriteFile(File file) {List<String> list = new ArrayList<>();List<File> favourites = getFavouriteFiles();for (File f : favourites) {if (f != null && (f.exists() || FilesystemViewerAdapter.isVirtualStorage(f))) {list.add(f.getAbsolutePath());}}String abs = file.getAbsolutePath();if (list.contains(abs)) {list.remove(abs);} else {list.add(abs);}setStringList(R.string.pref_key__favourite_files, list);}private static final String PREF_PREFIX_EDIT_POS_CHAR = ""PREF_PREFIX_EDIT_POS_CHAR"";private static final String PREF_PREFIX_EDIT_POS_SCROLL = ""PREF_PREFIX_EDIT_POS_SCROLL"";public void setLastEditPosition(File file, int pos, int scrolloffset) {if (file == null || !file.exists()) {return;}if (!file.equals(getTodoFile()) && !file.equals(getQuickNoteFile())) {setInt(PREF_PREFIX_EDIT_POS_CHAR + file.getAbsolutePath(), pos, _prefCache);setInt(PREF_PREFIX_EDIT_POS_SCROLL + file.getAbsolutePath(), scrolloffset, _prefCache);}}public int getLastEditPositionChar(File file) {if (file == null || !file.exists()) {return -1;}if (file.equals(getTodoFile()) || file.equals(getQuickNoteFile())) {return -2;}return getInt(PREF_PREFIX_EDIT_POS_CHAR + file.getAbsolutePath(), -3, _prefCache);}public int getLastEditPositionScroll(File file) {if (file == null || !file.exists()) {return 0;}return getInt(PREF_PREFIX_EDIT_POS_SCROLL + file.getAbsolutePath(), 0, _prefCache);}private List<String> getPopularDocumentsSorted() {List<String> popular = getRecentDocuments();Collections.sort(popular, new Comparator<String>() {@Overridepublic int compare(String o1, String o2) {return Integer.compare(getInt(o1, 0, _prefCache), getInt(o2, 0, _prefCache));}});return popular;}public List<String> getPopularDocuments() {return getStringList(R.string.pref_key__popular_documents);}public void setPopularDocuments(List<String> v) {limitListTo(v, 20, true);setStringList(R.string.pref_key__popular_documents, v, _prefApp);}public void setRecentDocuments(List<String> v) {limitListTo(v, 20, true);setStringList(R.string.pref_key__recent_documents, v, _prefApp);setPopularDocuments(getPopularDocumentsSorted());}public ArrayList<String> getRecentDocuments() {ArrayList<String> list = getStringList(R.string.pref_key__recent_documents);for (int i = 0; i < list.size(); i++) {if (!new File(list.get(i)).isFile()) {list.remove(i);i--;}}return list;}public ArrayList<File> getAsFileList(List<String> list) {ArrayList<File> r = new ArrayList<>();for (String f : list) {r.add(new File(f));}return r;}public ArrayList<File> getFavouriteFiles() {ArrayList<File> list = new ArrayList<>();for (String fp : getStringList(R.string.pref_key__favourite_files)) {File f = new File(fp);if (f.exists() || FilesystemViewerAdapter.isVirtualStorage(f)) {list.add(f);}}return list;}public String getInjectedHeader() {return getString(R.string.pref_key__inject_to_head, rstr(R.string.inject_to_head_default));}public String getInjectedBody() {return getString(R.string.pref_key__inject_to_body, """");}public boolean isEditorHistoryEnabled() {return true;//getBool(R.string.pref_key__editor_history_enabled3, true);}public boolean isTodoTxtAlternativeNaming() {return getBool(R.string.pref_key__todotxt__alternative_naming_context_project, true);}public int getEditorBasicColorSchemeId() {return 0;}public int getEditorForegroundColor() {/*switch (getEditorBasicColorSchemeId()) {default:case 0:return rcolor(darkMode ? R.color.white : R.color.dark_grey);case 1:return rcolor(darkMode ? R.color.white : R.color.black);case 2:return rcolor(R.color.solarized_fg);case 3:return rcolor(R.color.solarized_fg);}*/boolean darkMode = isDarkThemeEnabled();int defval = rcolor(darkMode ? R.color.white : R.color.dark_grey);return getInt(darkMode ? R.string.pref_key__editor_basic_color_scheme__fg_dark : R.string.pref_key__editor_basic_color_scheme__fg_light, defval);}public int getEditorBackgroundColor() {/*switch (getEditorBasicColorSchemeId()) {default:case 0:return rcolor(darkMode ? R.color.dark_grey : R.color.light__background);case 1:return rcolor(darkMode ? R.color.black : R.color.white);case 2:return rcolor(darkMode ? R.color.solarized_bg_dark : R.color.solarized_bg_light);case 3:return rcolor(darkMode ? R.color.solarized_bg_dark : R.color.solarized_bg_light);}*/boolean darkMode = isDarkThemeEnabled();int defval = rcolor(darkMode ? R.color.dark_grey : R.color.light__background);return getInt(darkMode ? R.string.pref_key__editor_basic_color_scheme__bg_dark : R.string.pref_key__editor_basic_color_scheme__bg_light, defval);}public int getEditorTextactionBarColor() {return rcolor(isDarkThemeEnabled() ? R.color.dark__background_2 : R.color.lighter_grey);}public void setEditorBasicColor(boolean forDarkMode, @ColorRes int fgColor, @ColorRes int bgColor) {int resIdFg = forDarkMode ? R.string.pref_key__editor_basic_color_scheme__fg_dark : R.string.pref_key__editor_basic_color_scheme__fg_light;int resIdBg = forDarkMode ? R.string.pref_key__editor_basic_color_scheme__bg_dark : R.string.pref_key__editor_basic_color_scheme__bg_light;setInt(resIdFg, rcolor(fgColor));setInt(resIdBg, rcolor(bgColor));}public boolean isMultiWindowEnabled() {if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {return getBool(R.string.pref_key__is_multi_window_enabled, true);} else {return false;}}public @IdResint getAppStartupTab() {int i = getIntOfStringPref(R.string.pref_key__app_start_tab_v2, R.id.nav_notebook);switch (i) {case 1:return R.id.nav_todo;case 2:return R.id.nav_quicknote;}return R.id.nav_notebook;}public boolean isSwipeToChangeMode() {return getBool(R.string.pref_key__swipe_to_change_mode, false);}public void setFilesystemListFolderFirst(boolean checked) {setBool(R.string.pref_key__filesystem_folder_first, checked);}public boolean isFilesystemListFolderFirst() {return getBool(R.string.pref_key__filesystem_folder_first, true);}public String getNavigationBarColor() {return getString(R.string.pref_key__navigationbar_color, ""#000000"");}public @IdResInteger getAppStartupFolderMenuId() {switch (getString(R.string.pref_key__app_start_folder, ""notebook"")) {case ""favourites"":return R.id.action_go_to_favourite_files;case ""internal_storage"":return R.id.action_go_to_storage;case ""appdata_public"":return R.id.action_go_to_appdata_public;case ""appdata_private"":return R.id.action_go_to_appdata_private;case ""popular_documents"":return R.id.action_go_to_popular_files;case ""recently_viewed_documents"":return R.id.action_go_to_recent_files;}return R.id.action_go_to_home;}public File getFolderToLoadByMenuId(int itemId) {ContextUtils contextUtils = new ContextUtils(_context);List<Pair<File, String>> appDataPublicDirs = contextUtils.getAppDataPublicDirs(false, true, false);switch (itemId) {case R.id.action_go_to_home: {return getNotebookDirectory();}case R.id.action_go_to_popular_files: {return FilesystemViewerAdapter.VIRTUAL_STORAGE_POPULAR;}case R.id.action_go_to_recent_files: {return FilesystemViewerAdapter.VIRTUAL_STORAGE_RECENTS;}case R.id.action_go_to_favourite_files: {return FilesystemViewerAdapter.VIRTUAL_STORAGE_FAVOURITE;}case R.id.action_go_to_appdata_private: {return contextUtils.getAppDataPrivateDir();}case R.id.action_go_to_storage: {return Environment.getExternalStorageDirectory();}case R.id.action_go_to_appdata_sdcard_1: {if (appDataPublicDirs.size() > 0) {return appDataPublicDirs.get(0).first;}return Environment.getExternalStorageDirectory();}case R.id.action_go_to_appdata_sdcard_2: {if (appDataPublicDirs.size() > 1) {return appDataPublicDirs.get(1).first;}return Environment.getExternalStorageDirectory();}case R.id.action_go_to_appdata_public: {appDataPublicDirs = contextUtils.getAppDataPublicDirs(true, false, false);if (appDataPublicDirs.size() > 0) {return appDataPublicDirs.get(0).first;}return contextUtils.getAppDataPrivateDir();}}return getNotebookDirectory();}public void setShowDotFiles(boolean value) {setBool(R.string.pref_key__show_dot_files, value);}public boolean isShowDotFiles() {return getBool(R.string.pref_key__show_dot_files, false);}public int getTabWidth() {return getInt(R.string.pref_key__tab_width_v2, 1);}public boolean listFileInRecents(File file) {return getBool(file.getAbsolutePath() + ""_list_in_recents"", true);}public void setListFileInRecents(File file, boolean value) {setBool(file.getAbsolutePath() + ""_list_in_recents"", value);if (!value) {ArrayList<String> recent = getRecentDocuments();if (recent.contains(file.getAbsolutePath())) {recent.remove(file.getAbsolutePath());setRecentDocuments(recent);}}}/*public ArrayList<String> getFilesRatedWith(int rating) {return getFilesTaggedWith(""rating_"" + Integer.toString(rating));}public ArrayList<String> getFilesTaggedWith(String tag) {return getStringList(""files_tagged_with"" + tag, _prefHistory);}*/public int getRating(File file) {return getInt(file.getAbsolutePath() + ""_rating"", 0);}public void setRating(File file, int value) {setInt(file.getAbsolutePath() + ""_rating"", value);}public boolean isEditorLineBreakingEnabled() {return getBool(R.string.pref_key__editor_enable_line_breaking, true);}private List<String> extSettingCache;public synchronized boolean isExtOpenWithThisApp(String ext) {if (ext.equals("""")) {ext = ""None"";}if (extSettingCache == null) {String pref = getString(R.string.pref_key__exts_to_always_open_in_this_app, """");extSettingCache = Arrays.asList(pref.toLowerCase().replace("",,"", "",None,"").replace("" "", """").split("",""));}return extSettingCache.contains(ext) || extSettingCache.contains("".*"");}public boolean isDebugLogEnabled() {return getBool(R.string.pref_key__is_debug_log_enabled, BuildConfig.IS_TEST_BUILD);}public boolean isExperimentalFeaturesEnabled() {return getBool(R.string.pref_key__is_enable_experimental_features, BuildConfig.IS_TEST_BUILD);}public boolean isMarkdownBiggerHeadings() {return getBool(R.string.pref_key__editor_markdown_bigger_headings_2, false);}public String getViewModeLinkColor() {return ContextUtils.colorToHexString(getInt(R.string.pref_key__view_mode_link_color, Color.parseColor(""#388E3C"")));}public String getUnorderedListCharacter() {return getString(R.string.pref_key__editor_unordered_list_character, ""-"");}public boolean isTodoNewTaskWithHuuidEnabled() {return getBool(R.string.pref_key__todotxt__start_new_tasks_with_huuid_v3, false);}public String getHuuidDeviceId() {String deviceid = getString(""huuid_deviceid"", null);if (deviceid == null) {deviceid = String.format(""%08x"", new Random().nextInt()).substring(0, 4);setString(""huuid_deviceid"", deviceid);}return deviceid;}public boolean hasPasswordBeenSetOnce() {return getBool(R.string.pref_key__default_encryption_password_set_once, false);}public void setPasswordHasBeenSetOnce(boolean b) {setBool(R.string.pref_key__default_encryption_password_set_once, b);}public boolean getNewFileDialogLastUsedEncryption() {return getBool(R.string.pref_key__new_file_dialog_lastused_encryption, false);}public void setNewFileDialogLastUsedEncryption(boolean b) {setBool(R.string.pref_key__new_file_dialog_lastused_encryption, b);}public String getNewFileDialogLastUsedExtension() {return getString(R.string.pref_key__new_file_dialog_lastused_extension, "".md"");}public void setNewFileDialogLastUsedExtension(String v) {setString(R.string.pref_key__new_file_dialog_lastused_extension, v);}public int getNewFileDialogLastUsedType() {return getInt(R.string.pref_key__new_file_dialog_lastused_type, 0);}public void setNewFileDialogLastUsedType(int i) {setInt(R.string.pref_key__new_file_dialog_lastused_type, i);}}",markor/app/src/main/java/net/gsantner/markor/util/AppSettings.java
53,"<?xml version=""1.0"" encoding=""utf-8""?><!--A project by Gregor Santner (https://gsantner.net)To the extent possible under law, the person who associated CC0 withthis file has waived all copyright and related or neighboring rightsto the public domain.You should have received a copy of the CC0 legalcode along with thiswork. If not, see <https://creativecommons.org/publicdomain/zero/1.0/>.--><resources><string name=""app_name_real"">Markor</string><string name=""app_name"" translatable=""false"">@string/app_name_real</string><string name=""app_license_name"" translatable=""false"">Apache 2.0</string><string name=""app_community_url"" translatable=""false"">https://matrix.to/#/#markor:matrix.org</string><string name=""app_bugreport_url"" translatable=""false"">https://github.com/gsantner/markor/issues</string><string name=""app_translate_url"" translatable=""false"">https://crowdin.com/project/markor/invite</string><string name=""app_web_url"" translatable=""false"">https://gsantner.net/project/markor.html?source=inapp</string><string name=""sync_client_support_issue_url"" translatable=""false"">https://github.com/gsantner/markor/issues/197</string><string name=""app_source_code_url"" translatable=""false"">https://github.com/gsantner/markor</string><string name=""app_donate_url"" translatable=""false""><![CDATA[https://gsantner.net/page/supportme.html?project=markor&source=inapp_supdon]]></string><string name=""app_contribution_info_url"" translatable=""false"">https://github.com/gsantner/markor/blob/master/README.md#contributions</string><string name=""more_info_on_how_to_donate_or_otherwise_support_this_project"" translatable=""false"">@string/more_info_on_how_to_donate_or_otherwise_support_this_project_text</string><string name=""donate_"" translatable=""false"">@string/donate</string><string name=""app_contact_email_reverse"" translatable=""false"">gro.xobliam@kcabdeef+rentnasg</string><string name=""huuid"">hUUID</string><string name=""checkmark_symbol"" translatable=""false"">\u2301</string><string name=""bookmark_symbol"" translatable=""false"">\u2605</string><string name=""lightning_symbol"" translatable=""false"">\u2714</string><string name=""plus"" translatable=""false"">+</string><string name=""share_html__mime_html"" translatable=""false"">HTML</string><string name=""pdf"" translatable=""false"">PDF</string><string name=""markdown"" translatable=""false"">Markdown</string><string name=""community"" translatable=""false"">Community</string><string name=""default_font_family"" translatable=""false"">sans-serif-regular</string><string name=""quicknote"" translatable=""false"">QuickNote</string><string name=""todo"" translatable=""false"">To-Do</string><string name=""todo_txt"" translatable=""false"">todo.txt</string><string name=""quicknote_default_filename"" translatable=""false"">QuickNote.md</string><string name=""todo_default_filename"" translatable=""false"">todo.txt</string><string name=""web_browser"" translatable=""false"">Web browser</string><string name=""app_drawer_launcher_special_files_description"" translatable=""false"">App drawer launchers - To-Do, QuickNote</string><string name=""category_to_context_project_to_tag"" translatable=""false"">%1$s -> %2$s, %3$s -> %4$s</string><string name=""katex_latex"" translatable=""false"">KaTex (LaTex)\n$ a^2 + b^2 = c^2 $</string><string name=""app_theme_light"" translatable=""false"">light</string><string name=""app_theme_dark"" translatable=""false"">dark</string><string name=""app_theme_auto"" translatable=""false"">auto</string><string name=""editor_basic_color_scheme_markor"" translatable=""false"">Markor</string><string name=""editor_basic_color_scheme_black_or_white"" translatable=""false"">Black or White</string><string name=""editor_basic_color_scheme_amoled"" translatable=""false"">AMOLED</string><string name=""editor_basic_color_scheme_solarized"" translatable=""false"">Solarized</string><string name=""editor_basic_color_scheme_gruvbox"" translatable=""false"">Gruvbox</string><string name=""editor_basic_color_scheme_greenscale"" translatable=""false"">Greenscale</string><string name=""editor_basic_color_scheme_sepia"" translatable=""false"">Sepia</string><string name=""auto"" translatable=""false"">Auto</string><string name=""hexcode"" translatable=""false"">Hexcode</string><string name=""markup_formats_supported_list"" translatable=""false"">Markdown, todo.txt, Plaintext</string><string name=""sync_to_local_folder_notice_paths"" translatable=""false""><![CDATA[<b>Dropbox:</b> Android/data/com.dropbox.android/files/u123456/scratch/\n<b>Own/NextCloud:</b> %s]]></string><!-- About Screen --><string name=""copyright_license_text_official"" translatable=""false""><![CDATA[### Copyright © 2017-2019**Gregor Santner**\n**Official project sources:**[Website](https://gsantner.net/index.html?source=inapp_license_official_project_source) | [Source code](https://github.com/gsantner/markor) | [F-Droid](https://f-droid.org/repository/browse/?fdid=net.gsantner.markor) | [Google Play](https://play.google.com/store/apps/details?id=net.gsantner.markor)]]></string><string name=""inject_to_head"" translatable=""false"">Inject -> head</string><string name=""inject_to_body"" translatable=""false"">Inject -> body</string><string name=""js_css"" translatable=""false""><![CDATA[html: <head>CSS, JavaScript</head>]]></string><string name=""inject_to_head_default"" translatable=""false""><![CDATA[<style>\nhtml,body {\n  /*font-family: sans-serif-condensed;*/\n  /*font-size: 80%;*/\n}\n</style>\n\n\n<script type=\""text/javascript\"">\nfunction onPageLoaded(){\n\n/*if (\'{{ post.text_converter_name }}\' == \'MarkdownTextConverter\') {\n  window.scrollTo(0,document.body.scrollHeight);\n}*/\n\n}\n</script>]]></string><plurals name=""item_selected"" translatable=""false""><item quantity=""one"" translatable=""false"">@string/one_item_selected</item><item quantity=""other"" translatable=""false"">@string/items_selected_witharg</item></plurals><plurals name=""documents"" translatable=""false""><item quantity=""one"" translatable=""false"">@string/document</item><item quantity=""other"" translatable=""false"">@string/documents</item></plurals><string name=""tag"" translatable=""false"">Tag</string><string name=""tags"" translatable=""false"">Tags</string><string name=""dotfiles"" translatable=""false"">.dotfiles</string><string name=""tagging"" translatable=""false"">Tagging</string><!--Preference keys--><string name=""pref_key__markdown__hl_delay_v2"" translatable=""false"">pref_key__markdown__hl_delay_v2</string><string name=""pref_key__quicknote_filepath"" translatable=""false"">pref_key__quicknote_filepath</string><string name=""pref_key__markdown__highlight_lineending_two_or_more_space"" translatable=""false"">pref_key__markdown__highlight_lineending_two_or_more_space</string><string name=""pref_key__markdown__monospace_some_parts"" translatable=""false"">pref_key__markdown__monospace_some_parts</string><string name=""pref_key__markdown__disable_code_block_highlight"" translatable=""false"">pref_key__markdown__disable_code_block_highlight</string><string name=""pref_key__markdown__auto_renumber_ordered_list"" translatable=""false"">pref_key__markdown__auto_renumber_ordered_list</string><string name=""pref_key__markdown__reorder_actions"" translatable=""false"">pref_key__markdown__reorder_actions</string><string name=""pref_key__todotxt__reorder_actions"" translatable=""false"">pref_key__todotxt__reorder_actions</string><string name=""pref_key__plaintext__reorder_actions"" translatable=""false"">pref_key__plaintext__reorder_actions</string><string name=""pref_key__markdown__action_keys"" translatable=""false"">pref_key__markdown__action_keys</string><string name=""pref_key__todotxt__action_keys"" translatable=""false"">pref_key__todotxt__action_keys</string><string name=""pref_key__plaintext__action_keys"" translatable=""false"">pref_key__plaintext__action_keys</string><string name=""pref_key__todotxt__hl_delay"" translatable=""false"">pref_key__todotxt__hl_delay</string><string name=""pref_key__todo_filepath"" translatable=""false"">pref_key__todo_filepath</string><string name=""pref_key__todotxt__add_completion_date_for_todos"" translatable=""false"">pref_key__todotxt__add_completion_date_for_todos</string><string name=""pref_key__todotxt__start_new_tasks_with_todays_date"" translatable=""false"">pref_key__todotxt__start_new_tasks_with_todays_date</string><string name=""pref_key__todotxt__append_contexts_and_projects_on_end_of_task"" translatable=""false"">pref_key__todotxt__append_contexts_and_projects_on_end_of_task</string><string name=""pref_key__todotxt__last_used_archive_filename"" translatable=""false"">pref_key__todotxt__last_used_archive_filename</string><string name=""pref_key__todotxt__alternative_naming_context_project"" translatable=""false"">pref_key__todotxt__alternative_naming_context_project</string><string name=""pref_key__is_preview_first"" translatable=""false"">pref_key__is_preview_first</string><string name=""pref_key__is_render_rtl"" translatable=""false"">pref_key__is_render_rtl</string><string name=""pref_key__is_highlighting_activated"" translatable=""false"">pref_key__is_highlighting_activated</string><string name=""pref_key__load_last_directory_at_startup"" translatable=""false"">pref_key__load_last_directory_at_startup</string><string name=""pref_key__notebook_directory"" translatable=""false"">pref_key__notebook_directory</string><string name=""pref_key__last_opened_directory"" translatable=""false"">pref_key__last_opened_directory</string><string name=""pref_key__font_family"" translatable=""false"">pref_key__font_family</string><string name=""pref_key__editor_font_size"" translatable=""false"">pref_key__editor_font_size</string><string name=""pref_key__app_theme"" translatable=""false"">pref_key__app_theme</string><string name=""pref_key__is_editor_statusbar_hidden"" translatable=""false"">pref_key__is_editor_statusbar_hidden</string><string name=""pref_key__is_overview_statusbar_hidden"" translatable=""false"">pref_key__is_overview_statusbar_hidden</string><string name=""pref_key__language"" translatable=""false"">pref_key__language</string><string name=""pref_key__is_main_recreate_required"" translatable=""false"">pref_key__is_main_recreate_required</string><string name=""pref_key__sort_method"" translatable=""false"">pref_key__sort_method</string><string name=""pref_key__sort_reverse"" translatable=""false"">pref_key__sort_reverse</string><string name=""pref_key__is_highlighting_for_hexcolor_activated"" translatable=""false"">pref_key__is_highlighting_for_hexcolor_activated</string><string name=""pref_key__app_first_start_current_version"" translatable=""false"">pref_key__app_first_start_current_version</string><string name=""pref_key__editor_line_spacing"" translatable=""false"">pref_key__editor_line_spacing</string><string name=""pref_key__editor_start_editing_on_bottom"" translatable=""false"">pref_key__editor_start_editing_on_bottom</string><string name=""pref_key__editor_start_editing_in_center"" translatable=""false"">pref_key__editor_start_editing_in_center</string><string name=""pref_key__share_into__quicknote"" translatable=""false"">pref_key__share_into__quicknote</string><string name=""pref_key__share_into__todo"" translatable=""false"">pref_key__share_into__todo</string><string name=""pref_key__share_into__clipboard"" translatable=""false"">pref_key__share_into__clipboard</string><string name=""pref_key__share_into__existing_document"" translatable=""false"">pref_key__share_into__existing_document</string><string name=""pref_key__share_into__create_document"" translatable=""false"">pref_key__share_into__create_document</string><string name=""pref_key__share_into__reshare"" translatable=""false"">pref_key__share_into__reshare</string><string name=""pref_key__share_into__calendar_event"" translatable=""false"">pref_key__share_into__calendar_event</string><string name=""pref_key__more_info__settings"" translatable=""false"">pref_key__more_info__settings</string><string name=""pref_key__more_info__source_code"" translatable=""false"">pref_key__more_info__source_code</string><string name=""pref_key__more_info__project_license"" translatable=""false"">pref_key__more_info__project_license</string><string name=""pref_key__more_info__open_source_licenses"" translatable=""false"">pref_key__more_info__open_source_licenses</string><string name=""pref_key__more_info__bug_reports"" translatable=""false"">pref_key__more_info__bug_reports</string><string name=""pref_key__more_info__help"" translatable=""false"">pref_key__more_info__help</string><string name=""pref_key__more_info__rate_app"" translatable=""false"">pref_key__more_info__rate_app</string><string name=""pref_key__more_info__translate"" translatable=""false"">pref_key__more_info__translate</string><string name=""pref_key__more_info__join_community"" translatable=""false"">pref_key__more_info__join_community</string><string name=""pref_key__more_info__app"" translatable=""false"">pref_key__more_info__app</string><string name=""pref_key__more_info__donate"" translatable=""false"">pref_key__more_info__donate</string><string name=""pref_key__more_info__project_contribution_info"" translatable=""false"">pref_key__more_info__project_contribution_info</string><string name=""pref_key__more_info__project_community"" translatable=""false"">pref_key__more_info__project_community</string><string name=""pref_key__more_info__project_team"" translatable=""false"">pref_key__more_info__project_team</string><string name=""pref_key__more_info__contributors_public_info"" translatable=""false"">pref_key__more_info__contributors_public_info</string><string name=""pref_key__more_info__copy_build_information"" translatable=""false"">pref_key__more_info__copy_build_information</string><string name=""pref_key__editor_textaction_bar_item_padding"" translatable=""false"">pref_key__editor_textaction_bar_item_padding</string><string name=""pref_key__editor_disable_spelling_red_underline"" translatable=""false"">pref_key__editor_disable_spelling_red_underline</string><string name=""pref_key__editor_markdown_bigger_headings_2"" translatable=""false"">pref_key__editor_markdown_bigger_headings_2</string><string name=""pref_key__editor_unordered_list_character"" translatable=""false"">pref_key__editor_unordered_list_character</string><string name=""pref_key__recent_documents"" translatable=""false"">pref_key__recent_documents</string><string name=""pref_key__popular_documents"" translatable=""false"">pref_key__popular_documents</string><string name=""pref_key__favourite_files"" translatable=""false"">pref_key__favourite_files</string><string name=""pref_key__share_into__open_in_browser"" translatable=""false"">pref_key__share_into__open_in_browser</string><string name=""pref_key__inject_to_head"" translatable=""false"">pref_key__inject_to_head</string><string name=""pref_key__inject_to_body"" translatable=""false"">pref_key__inject_to_body</string><string name=""pref_key__markdown_render_math"" translatable=""false"">pref_key__markdown_render_math</string><string name=""pref_key__markdown_show_toc"" translatable=""false"">pref_key__markdown_show_toc</string><string name=""pref_key__is_launcher_for_special_files_enabled"" translatable=""false"">pref_key__is_launcher_for_special_files_enabled</string><string name=""pref_key__editor_basic_color_scheme__bg_light"" translatable=""false"">pref_key__editor_basic_color_scheme__bg_light</string><string name=""pref_key__editor_basic_color_scheme__fg_light"" translatable=""false"">pref_key__editor_basic_color_scheme__fg_light</string><string name=""pref_key__editor_basic_color_scheme__bg_dark"" translatable=""false"">pref_key__editor_basic_color_scheme__bg_dark</string><string name=""pref_key__editor_basic_color_scheme__fg_dark"" translatable=""false"">pref_key__editor_basic_color_scheme__fg_dark</string><string name=""pref_key__editor_basic_color_scheme_solarized"" translatable=""false"">pref_key__editor_basic_color_scheme_solarized</string><string name=""pref_key__editor_basic_color_scheme_blackorwhite"" translatable=""false"">pref_key__editor_basic_color_scheme_blackorwhite</string><string name=""pref_key__editor_basic_color_scheme_amoled"" translatable=""false"">pref_key__editor_basic_color_scheme_amoled</string><string name=""pref_key__editor_basic_color_scheme_markor"" translatable=""false"">pref_key__editor_basic_color_scheme_markor</string><string name=""pref_key__editor_basic_color_scheme_gruvbox"" translatable=""false"">pref_key__editor_basic_color_scheme_gruvbox</string><string name=""pref_key__editor_basic_color_scheme_greenscale"" translatable=""false"">pref_key__editor_basic_color_scheme_greenscale</string><string name=""pref_key__editor_basic_color_scheme_sepia"" translatable=""false"">pref_key__editor_basic_color_scheme_sepia</string><string name=""pref_key__is_keep_screen_on"" translatable=""false"">pref_key__keep_screen_on</string><string name=""tmaid_common_delete_lines"" translatable=""false"">tmaid_common_delete_lines</string><string name=""tmaid_common_attach_something"" translatable=""false"">tmaid_common_attach_something</string><string name=""tmaid_common_unordered_list_char"" translatable=""false"">tmaid_common_unordered_list_char</string><string name=""tmaid_common_ordered_list_number"" translatable=""false"">tmaid_common_ordered_list_number</string><string name=""tmaid_common_checkbox_list"" translatable=""false"">tmaid_common_checkbox_list</string><string name=""tmaid_common_special_key"" translatable=""false"">tmaid_common_special_key</string><string name=""tmaid_common_open_link_browser"" translatable=""false"">tmaid_common_open_link_browser</string><string name=""tmaid_common_color_picker"" translatable=""false"">tmaid_common_color_picker</string><string name=""tmaid_common_time"" translatable=""false"">tmaid_common_time</string><string name=""tmaid_common_jump_to_bottom"" translatable=""false"">tmaid_common_jump_to_bottom</string><string name=""tmaid_common_search_in_content_of_current_file"" translatable=""false"">tmaid_common_search_in_content_of_current_file</string><string name=""tmaid_common_accordion"" translatable=""false"">tmaid_common_accordion</string><string name=""tmaid_common_indent"" translatable=""false"">tmaid_common_indent</string><string name=""tmaid_common_deindent"" translatable=""false"">tmaid_common_deindent</string><string name=""tmaid_common_toolbar_title_clicked_edit_action"">tmaid_common_toolbar_title_clicked_edit_action</string><string name=""tmaid_markdown_quote"" translatable=""false"">tmaid_markdown_quote</string><string name=""tmaid_markdown_h1"" translatable=""false"">tmaid_markdown_h1</string><string name=""tmaid_markdown_h2"" translatable=""false"">tmaid_markdown_h2</string><string name=""tmaid_markdown_h3"" translatable=""false"">tmaid_markdown_h3</string><string name=""tmaid_markdown_bold"" translatable=""false"">tmaid_markdown_bold</string><string name=""tmaid_markdown_italic"" translatable=""false"">tmaid_markdown_italic</string><string name=""tmaid_markdown_strikeout"" translatable=""false"">tmaid_markdown_strikeout</string><string name=""tmaid_markdown_code_inline"" translatable=""false"">tmaid_markdown_code_inline</string><string name=""tmaid_markdown_horizontal_line"" translatable=""false"">tmaid_markdown_horizontal_line</string><string name=""tmaid_markdown_insert_image"" translatable=""false"">tmaid_markdown_insert_image</string><string name=""tmaid_markdown_insert_link"" translatable=""false"">tmaid_markdown_insert_link</string><string name=""tmaid_markdown_table_insert_columns"" translatable=""false"">tmaid_markdown_table_insert_columns</string><string name=""tmaid_todotxt_toggle_done"" translatable=""false"">tmaid_todotxt_toggle_done</string><string name=""tmaid_todotxt_add_context"" translatable=""false"">tmaid_todotxt_add_context</string><string name=""tmaid_todotxt_add_project"" translatable=""false"">tmaid_todotxt_add_project</string><string name=""tmaid_todotxt_priority"" translatable=""false"">tmaid_todotxt_priority</string><string name=""tmaid_todotxt_archive_done_tasks"" translatable=""false"">tmaid_todotxt_archive_done_tasks</string><string name=""tmaid_todotxt_current_date"" translatable=""false"">tmaid_todotxt_current_date</string><string name=""tmaid_todotxt_sort_todo"" translatable=""false"">tmaid_todotxt_sort_todo</string><string name=""jekyll_post"" translatable=""false"">Jekyll Post</string><string name=""zim_wiki"" translatable=""false"">Zim Wiki</string><string name=""pref_key__is_multi_window_enabled"" translatable=""false"">pref_key__is_multi_window_enabled</string><string name=""pref_key__is_enable_experimental_features"" translatable=""false"">pref_key__is_enable_experimental_features</string><string name=""pref_key__app_start_tab_v2"" translatable=""false"">pref_key__app_start_tab_v2</string><string name=""pref_key__app_start_folder"" translatable=""false"">pref_key__app_start_folder</string><string name=""pref_key__swipe_to_change_mode"" translatable=""false"">pref_key__swipe_to_change_mode</string><string name=""pref_key__filesystem_folder_first"" translatable=""false"">pref_key__filesystem_folder_first</string><string name=""pref_key__show_dot_files"" translatable=""false"">pref_key__show_dot_files</string><string name=""pref_key__tab_width_v2"" translatable=""false"">pref_key__tab_width_v2</string><string name=""pref_key__editor_enable_line_breaking"" translatable=""false"">pref_key__editor_enable_line_breaking</string><string name=""pref_key__exts_to_always_open_in_this_app"" translatable=""false"">pref_key__exts_to_always_open_in_this_app</string><string name=""pref_key__is_debug_log_enabled"" translatable=""false"">pref_key__is_debug_log_enabled</string><string name=""pref_key__view_font_size"" translatable=""false"">pref_key__view_font_size</string><string name=""pref_key__view_mode_link_color"" translatable=""false"">pref_key__view_mode_link_color</string><string name=""pref_key__todotxt__start_new_tasks_with_huuid_v3"" translatable=""false"">pref_key__todotxt__start_new_tasks_with_huuid_v3</string><string name=""features"" translatable=""false"">Features</string><string name=""file_template__md_markor_markdown_reference"" translatable=""false"">markor-markdown-reference.md</string><string name=""file_template__md_jekyll_post"" translatable=""false"">2029-01-01-jekyll-post.md</string><string name=""file_template__md_cooking_recipe"" translatable=""false"">cooking-recipe.md</string><string name=""file_template__txt_todo_sample"" translatable=""false"">todo.example.txt</string><string name=""file_template__txt_zim_wiki"" translatable=""false"">zim-wiki.txt</string><string name=""file_template__md_hugo_post_front_matter"" translatable=""false"">hugo-post-front-matter.md</string><string name=""file_template__md_presentation_beamer"" translatable=""false"">presentation-beamer.md</string><string name=""key_value"" translatable=""false"">Key - Value</string><string name=""ohm"" translatable=""false"">Ohm (Ω)</string><string name=""debug"" translatable=""false"">Debug</string><string name=""text"" translatable=""false"">Text</string><string name=""inject"" translatable=""false"">Inject</string><string name=""char_punctation_mark_arrows"" translatable=""false"">Punctuation mark (»«)</string><string name=""indent"" translatable=""false"">Indent</string><string name=""deindent"" translatable=""false"">De-indent</string><string name=""assets"" translatable=""false"">Assets</string><string name=""audio"" translatable=""false"">Audio</string><string name=""continued_overline"" translatable=""false"">Continued overline (‾‾‾‾)</string><string name=""shrug"" translatable=""false"">Shrug (¯\_(ツ)_/¯)</string><string name=""accordion"" translatable=""false"">Accordion</string><string name=""pref_key__default_encryption_password"" translatable=""false"">pref_key__default_encryption_password</string><string name=""empty_string"" translatable=""false""/><string name=""pref_key__default_encryption_password_set_once"" translatable=""false"">pref_key__default_encryption_password_set_once</string><string name=""pref_key__new_file_dialog_lastused_encryption"" translatable=""false"">pref_key__new_file_dialog_lastused_encryption</string><string name=""pref_key__new_file_dialog_lastused_extension"" translatable=""false"">pref_key__new_file_dialog_lastused_extension</string><string name=""pref_key__new_file_dialog_lastused_type"" translatable=""false"">pref_key__new_file_dialog_lastused_type</string><string name=""select_current_line"" translatable=""false"">Select current line(s)</string></resources>",markor/app/src/main/res/values/string-not_translatable.xml
8,"package de.koelle.christian.common.widget.tab;import android.annotation.SuppressLint;import android.content.Context;import android.support.annotation.NonNull;import android.support.v4.view.ViewPager;import android.util.AttributeSet;import android.view.KeyEvent;import android.view.MotionEvent;public class BlockableViewPager extends ViewPager {private boolean enabled;public BlockableViewPager(Context context, AttributeSet attrs) {super(context, attrs);this.enabled = true;}@SuppressLint(""ClickableViewAccessibility"")@Overridepublic boolean onTouchEvent(MotionEvent event) {return this.enabled && super.onTouchEvent(event);}@Overridepublic boolean onInterceptTouchEvent(MotionEvent event) {return this.enabled && super.onInterceptTouchEvent(event);}@Overridepublic boolean executeKeyEvent(@NonNull KeyEvent event) {return this.enabled && super.executeKeyEvent(event);}public void setSwipeEnabled(boolean enabled) {this.enabled = enabled;}}",trickytripper/app/src/main/java/de/koelle/christian/common/widget/tab/BlockableViewPager.java
8,"package de.koelle.christian.trickytripper;import android.app.Activity;import android.content.Intent;import android.content.res.Configuration;import android.graphics.Typeface;import android.os.Bundle;import android.support.v4.content.ContextCompat;import android.support.v4.view.GravityCompat;import android.support.v4.view.PagerAdapter;import android.support.v4.widget.DrawerLayout;import android.support.v7.app.ActionBar;import android.support.v7.app.ActionBarDrawerToggle;import android.support.v7.app.AppCompatActivity;import android.support.v7.view.ActionMode;import android.view.Menu;import android.view.MenuItem;import android.view.View;import android.view.ViewGroup;import android.widget.AdapterView;import android.widget.ArrayAdapter;import android.widget.ListView;import android.widget.TextView;import android.widget.Toast;import java.text.Collator;import java.util.ArrayList;import java.util.Comparator;import java.util.List;import de.koelle.christian.common.changelog.ChangeLog;import de.koelle.christian.common.options.OptionConstraints;import de.koelle.christian.common.options.OptionConstraintsInflater;import de.koelle.christian.common.utils.CurrencyUtil;import de.koelle.christian.common.widget.tab.BlockableViewPager;import de.koelle.christian.trickytripper.activitysupport.MainPagerAdapter;import de.koelle.christian.trickytripper.constants.Rc;import de.koelle.christian.trickytripper.controller.TripController;import de.koelle.christian.trickytripper.dialogs.DeleteDialogFragment;import de.koelle.christian.trickytripper.model.Trip;import de.koelle.christian.trickytripper.model.TripSummary;import de.koelle.christian.trickytripper.model.modelAdapter.TripSummarySymbolResolvingDelegator;public class TrickyTripperActivity extends AppCompatActivity implements DeleteDialogFragment.DeleteConfirmationCallback {private static final String SELECTED_TAB_INDEX = ""tabIndex"";private static final String DIALOG_PARAM_TRIP_SUMMARY = ""dialogParamTripSummary"";private BlockableViewPager mViewPager;private DrawerLayout mDrawerLayout;private ListView mDrawerList;private ActionBarDrawerToggle mDrawerToggle;private ArrayAdapter<TripSummary> mDrawerListAdapter;private Comparator<TripSummary> mListComparator;private CharSequence mDrawerTitle;private long previouslySelectedTripId;private MyActionModeCallback mActionModeCallback = new MyActionModeCallback();/*This action mode might also be set by the nested fragments.*/private ActionMode mActionMode;@Overridepublic void onCreate(Bundle savedInstanceState) {super.onCreate(savedInstanceState);setContentView(R.layout.tricky_tripper_main_view);ChangeLog changeLog = new ChangeLog(this);if (changeLog.firstRun()) {changeLog.getLogDialog().show();}mDrawerTitle = getResources().getString(R.string.trip_manage_view_heading);mDrawerLayout = findViewById(R.id.drawer_layout);mDrawerList =  findViewById(R.id.drawer_drawer_list_view_trips);mViewPager = findViewById(R.id.drawer_content_pager);updatePagerAdapter();mDrawerToggle = new MyActionBarDrawerToggle();mDrawerLayout.addDrawerListener(mDrawerToggle);final ActionBar actionBar = getSupportActionBar();actionBar.setDisplayShowTitleEnabled(true);// This line has to be prior to the next one.actionBar.setDisplayHomeAsUpEnabled(true);actionBar.setHomeButtonEnabled(true);setTripNameToHeader();int index = 0; // first one by defaultif (savedInstanceState != null) {index = savedInstanceState.getInt(SELECTED_TAB_INDEX);}mViewPager.setCurrentItem(index);TrickyTripperApp app = getApp();final Collator c = app.getMiscController().getDefaultStringCollator();mListComparator = new Comparator<TripSummary>() {public int compare(TripSummary object1, TripSummary object2) {return c.compare(object1.getName(), object2.getName());}};iniDrawerListView(mDrawerList);addDrawerListClickListener(mDrawerList, app);}private void iniDrawerListView(ListView listView) {mDrawerListAdapter = new ArrayAdapter<TripSummary>(this,android.R.layout.simple_list_item_1,new ArrayList<TripSummary>()) {@Overridepublic View getView(int position, View convertView, ViewGroup parent) {/* Display currency code only when not in list view. */TextView result = (TextView) super.getView(position,convertView, parent);TripSummary row = this.getItem(position);int color;int typefaceStyle;if (row.getId() == getApp().getTripController().getTripLoaded().getId()) {color = getResources().getColor(R.color.main);typefaceStyle = Typeface.BOLD;} else {color = ContextCompat.getColor(getContext(), android.R.color.tertiary_text_light);typefaceStyle = Typeface.NORMAL;}result.setText(row.toString());result.setTextColor(color);result.setTypeface(null, typefaceStyle);return result;}};listView.setAdapter(mDrawerListAdapter);listView.setChoiceMode(ListView.CHOICE_MODE_SINGLE);}private void updatePagerAdapter() {// MainPagerAdapter defines the tab activities and the tab order.PagerAdapter mPagerAdapter = new MainPagerAdapter(getSupportFragmentManager(), this);mViewPager.setAdapter(mPagerAdapter);}private void addDrawerListClickListener(final ListView listView,final TrickyTripperApp app) {listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {public void onItemClick(AdapterView<?> arg0, View arg1,int position, long id) {if (mActionMode != null) {return;}mDrawerList.setItemChecked(position, true);TripSummary selectedTripSummary = mDrawerListAdapter.getItem(position);app.getTripController().loadTrip(selectedTripSummary);mDrawerLayout.closeDrawer(GravityCompat.START);setTripNameToHeader();if (selectedTripSummary.getId() != previouslySelectedTripId) {updatePagerAdapter();}}});listView.setLongClickable(true);listView.setOnItemLongClickListener(new AdapterView.OnItemLongClickListener() {@Overridepublic boolean onItemLongClick(AdapterView<?> parent, View view, int position, long id) {if (mActionMode != null) {return false;}TripSummary selectedTrip = mDrawerListAdapter.getItem(position);mActionModeCallback.setSelectedTrip(selectedTrip);mActionMode = TrickyTripperActivity.this.startSupportActionMode(mActionModeCallback);mActionMode.setTitle(selectedTrip.toString());view.setSelected(true);return true;}});}@Overrideprotected void onPostCreate(Bundle savedInstanceState) {super.onPostCreate(savedInstanceState);mDrawerToggle.syncState();}@Overridepublic void onConfigurationChanged(Configuration newConfig) {super.onConfigurationChanged(newConfig);mDrawerToggle.onConfigurationChanged(newConfig);}@Overridepublic boolean onCreateOptionsMenu(Menu menu) {int[] optionIds;if (mDrawerLayout.isDrawerOpen(mDrawerList)) {optionIds = new int[]{R.id.option_help,R.id.option_create_trip};} else {optionIds = new int[]{R.id.option_add_participant,R.id.option_help,R.id.option_export,R.id.option_preferences};}return getApp().getMiscController().getOptionSupport().populateOptionsMenu(new OptionConstraints().activity(this).menu(menu).options(optionIds));}@Overridepublic boolean onPrepareOptionsMenu(Menu menu) {MenuItem item = menu.findItem(R.id.option_export);if (item != null) {boolean exportEnabled = getApp().getTripController().hasLoadedTripPayments();item.setEnabled(exportEnabled);item.getIcon().setAlpha((exportEnabled) ? 255 : 64);}return true;}@Overridepublic boolean onOptionsItemSelected(MenuItem item) {// Pass the event to ActionBarDrawerToggle, if it returns// true, then it has handled the app icon touch eventif (mDrawerToggle.onOptionsItemSelected(item)) {return true;}// Handle action buttonsswitch (item.getItemId()) {case R.id.option_add_participant:getApp().getViewController().openCreateParticipant();return true;case R.id.option_export:if(getApp().getExportController().hasEnabledOutputChannel()){getApp().getViewController().openExport();} else {Toast.makeText(TrickyTripperActivity.this, R.string.no_export_option, Toast.LENGTH_LONG).show();}return true;case R.id.option_preferences:getApp().getViewController().openSettings();return true;case R.id.option_help:getApp().getViewController().openHelp(getSupportFragmentManager());return true;case R.id.option_create_trip:getApp().getViewController().openEditTrip(this, null);return true;default:return super.onOptionsItemSelected(item);}}@Overrideprotected void onSaveInstanceState(Bundle outState) {super.onSaveInstanceState(outState);outState.putInt(SELECTED_TAB_INDEX, mViewPager.getCurrentItem());}private void setTripNameToHeader() {Trip trip = getApp().getTripController().getTripLoaded();String tripText = trip.getName() + "" ""+ CurrencyUtil.getSymbolToCurrency(getResources(), trip.getBaseCurrency(), true);getSupportActionBar().setTitle(tripText);}private TrickyTripperApp getApp() {return ((TrickyTripperApp) getApplication());}@Overrideprotected void onActivityResult(int requestCode, int resultCode, Intent resultData) {if (requestCode == Rc.ACTIVITY_REQ_CODE_EDIT_TRIP && resultCode == Activity.RESULT_OK) {updateList(getApp().getTripController().getAllTrips());}}void updateList(List<TripSummary> currentList) {mDrawerListAdapter.clear();for (TripSummary summary : currentList) {mDrawerListAdapter.add(new TripSummarySymbolResolvingDelegator(summary,getResources()));}mDrawerListAdapter.sort(mListComparator);}@Overridepublic void finish() {loadNextTripIfPreviousDeleted();super.finish();}private void loadNextTripIfPreviousDeleted() {TripController ctrl = getApp().getTripController();if (ctrl.getTripLoaded() == null) {ctrl.loadTrip(ctrl.getAllTrips().get(0));}}private Bundle createBundleWithTripSummaryForPopup(TripSummary selectedTripSummary) {Bundle bundle = new Bundle();bundle.putSerializable(DIALOG_PARAM_TRIP_SUMMARY, selectedTripSummary);return bundle;}private TripSummary getTripSummaryFromBundle(Bundle args) {return  (TripSummary) args.get(DIALOG_PARAM_TRIP_SUMMARY);}public String getDeleteConfirmationMsg(Bundle bundle) {TripSummary tripSummary = getTripSummaryFromBundle(bundle);return new StringBuilder().append(tripSummary.getName()).append("": "").append(getResources().getString(R.string.trip_manage_view_delete_confirmation)).toString();}public void doDelete(Bundle bundle) {TripSummary tripSummary = getTripSummaryFromBundle(bundle);getApp().getTripController().deleteTrip(tripSummary);updateList(getApp().getTripController().getAllTrips());invalidateOptionsMenu();setTripNameToHeader();updatePagerAdapter();}private class MyActionModeCallback implements ActionMode.Callback {private TripSummary selectedTrip;@Overridepublic boolean onCreateActionMode(ActionMode mode, Menu menu) {boolean canDelete = !getApp().getTripController().oneOrLessTripsLeft();int[] optionIds;if (canDelete) {optionIds = new int[]{R.id.option_delete,R.id.option_edit};} else {optionIds = new int[]{R.id.option_edit};}return getApp().getMiscController().getOptionSupport().populateOptionsMenu(new OptionConstraintsInflater().activity(mode.getMenuInflater()).menu(menu).options(optionIds));}@Overridepublic boolean onPrepareActionMode(ActionMode mode, Menu menu) {return false;}@Overridepublic boolean onActionItemClicked(ActionMode mode, MenuItem item) {switch (item.getItemId()) {case R.id.option_delete:getApp().getViewController().openDeleteConfirmationOnActivity(getSupportFragmentManager(),createBundleWithTripSummaryForPopup(getTransferableSelection()));mode.finish(); // Closes CABreturn true;case R.id.option_edit:getApp().getViewController().openEditTrip(TrickyTripperActivity.this, getTransferableSelection());mode.finish(); // Closes CABreturn true;default:return false;}}private TripSummary getTransferableSelection() {TripSummary result = new TripSummary(selectedTrip.getName(), selectedTrip.getBaseCurrency());result.setId(selectedTrip.getId());return result;}@Overridepublic void onDestroyActionMode(ActionMode mode) {mActionMode = null;}void setSelectedTrip(TripSummary selectedTrip) {this.selectedTrip = selectedTrip;}}private class MyActionBarDrawerToggle extends ActionBarDrawerToggle {MyActionBarDrawerToggle() {super(TrickyTripperActivity.this, TrickyTripperActivity.this.mDrawerLayout, R.string.drawer_open, R.string.drawer_close);}public void onDrawerClosed(View view) {super.onDrawerClosed(view);setTripNameToHeader();supportInvalidateOptionsMenu();}public void onDrawerOpened(View drawerView) {previouslySelectedTripId = getApp().getTripController().getTripLoaded().getId();super.onDrawerOpened(drawerView);updateList(getApp().getTripController().getAllTrips());getSupportActionBar().setTitle(mDrawerTitle);supportInvalidateOptionsMenu();}}public ActionMode getRunningActionMode() {return mActionMode;}public void setRunningActionMode(ActionMode actionMode) {this.mActionMode = actionMode;mViewPager.setSwipeEnabled(actionMode== null);}}",trickytripper/app/src/main/java/de/koelle/christian/trickytripper/TrickyTripperActivity.java
8,"<?xml version=""1.0"" encoding=""utf-8""?><android.support.v4.widget.DrawerLayout xmlns:android=""http://schemas.android.com/apk/res/android""android:id=""@+id/drawer_layout""android:layout_width=""match_parent""android:layout_height=""match_parent""><de.koelle.christian.common.widget.tab.BlockableViewPagerandroid:id=""@+id/drawer_content_pager""android:layout_width=""match_parent""android:layout_height=""match_parent""><android.support.v4.view.PagerTitleStripandroid:id=""@+id/drawer_content_pager_title_strip""android:layout_width=""match_parent""android:layout_height=""wrap_content""android:layout_gravity=""top""android:background=""@color/main""android:paddingBottom=""4dp""android:paddingTop=""4dp""android:textColor=""#fff"" /></de.koelle.christian.common.widget.tab.BlockableViewPager><ListViewandroid:id=""@+id/drawer_drawer_list_view_trips""android:layout_width=""240dp""android:layout_height=""match_parent""android:layout_gravity=""start""android:choiceMode=""singleChoice""android:longClickable=""true""android:divider=""@android:color/transparent""android:dividerHeight=""0dp""android:background=""#ffffff""/></android.support.v4.widget.DrawerLayout>",trickytripper/app/src/main/res/layout/tricky_tripper_main_view.xml
8,"<html><head><style type='text/css'>a                {color:purple;font-style:italic; }div.title              {color:purple;font-weight:bold;font-size:1.2em;font-weight:bold;margin-top:1em;margin-bottom:0.5em;text-align:center }div.subtitle      {color:purple;font-weight:bold;font-size:0.8em;margin-bottom:1em;text-align:center }.appinternal          {font-style:italic; }.app                 {color:purple;font-weight:bold;}</style></head><body>$ 1.6.1% Version 1.6.1_ 2019-XX-XX* Fix: Tab-Aktualisierung erfolgt wieder nach Löschung einer Zahlung.* Fix: Fehler beim Tab-Wechsel mit geöffnetem Optionsmenü.$ 1.6.0% Version 1.6.0_ 2018-10-01* Download von Wechselkursen jetzt wieder verfügbar (jedoch ohne die Währungen Colon und Kwacha).$ 1.5.9% Version 1.5.9_ 2017-09-23* Berichtsexport: Wähle die Zielanwendung Deiner Wahl über einen Auswahldialog des Geräts, bspw. Google Drive. Bisher gab es nur eine feste Auswahl von unterstützten Zielanwendungen.* Berichtsexport: Dateien können auch direkt geöffnet werden.* Unterstützung für Android O.$ 1.5.8% Version 1.5.8_ 2016-11-23* Abstürze beim Auswählen auf den Hauptdialogen behoben.$ 1.5.7% Version 1.5.7_ 2016-11-16* Fix: Die ausgewählte Reise war nicht ohne Absturz löschbar.* Verbesserung: Zahlungsbeschreibung jetzt mit Vorschlagsliste vorhandener Beschreibungen (Dank an mbrgm).$ 1.5.6% Version 1.5.6_ 2016-10-10* Spanische Übersetzung ist jetzt verfügbar (Dank an Igor Sosa Mayor).* Boxer wird für den Berichtsexport unterstützt.$ 1.5.5% Version 1.5.5_ 2016-02-27* Französische Übersetzung ist jetzt verfügbar (Dank an Nicolas Bossard).* Italienische Übersetzung erweitert (Dank an Andrea Zanella).* Das Framework für das Herunterladen von Wechselkursen wurde ersetzt.* K9-Mail wird für den Berichtsexport unterstützt.$ 1.5.4% Version 1.5.4_ 2016-01-17* Zeitauswahl für Zahlungen war auf Android 6 Geräten nicht sichtbar.* Auf einigen Geräten stürzte die App bei Verwendung des Geldwechselrechners ab.$ 1.5.3% Version 1.5.3_ 2015-10-18* Unterstützung von Android 6 (Berechtigungen).* Hilfetexte für leere Listenansichten jetzt gemäß UI-Konventionen.$ 1.5.2% Version 1.5.2_ 2015-03-08* Bugfix: Datums- und Uhrzeitauswahl funktioniert unter Android 5 anders als bisher.$ 1.5.1% Version 1.5.1_ 2015-03-07* Reiseauswahl und -verwaltung erfolgt via Drawer, zugänglich via Burger Button.* Kontextmenüs entfernt: Funktionen jetzt im kontextsensitiven Actionbar.* Auffrischung der Dialoge, Anpassung an die Material-Designvorgaben (Android 5).* Unterstützung von Android-5-Geräten.$ 1.4.3% Version 1.4.3_ 2013-12-09* Wechselkursimport aus dem Internet funktioniert nun wieder: Die bisherige Schnittstelle von Google wurde leider abgeschaltet.$ 1.4.2% Version 1.4.2_ 2013-09-29* Anzeige, Bearbeitung, Export und Sortierung von/nach Zeitpunkt einer Zahlung.* Der Berichts-Tab wurde überarbeitet: Die Schulden von allen Reisenden werden angezeigt.* Bugfix: +-Button war hin und wieder unsichtbar.$ 1.4.1% Version 1.4.1_ 2013-08-31* Die Italienische Übersetzung ist jetzt verfügbar (Dank an Andrea Zanella).* Bugfix: Das Speichern von Berichten auf SD-Karte funktioniert wieder.* Bugfix: Die Aktualisierung von Reisenden aktualisiert nun auch den Bericht, auch ohne eine Reise neu laden zu müssen.$ 1.4.0% Version 1.4.0_ 2013-06-03* Bugfix: Der Rest einer gleichmäßigen Zahlungsaufteilung wird jetzt centweise gleichmäßig auf die Reisenden verteilt.* Statt Umweg über das Kontextmenü öffnet nun ein einfacher Tap auf einen Reisenden <span class=""appinternal"">Zahlung erstellen</span>, auf eine Zahlung <span class=""appinternal"">Zahlung bearbeiten</span>.* Actionbar-Funktionen wurden den Hauptdialogen, d.h. den Tab-Reitern, hinzugefügt.* Die Funktionalität zum Hinzufügen von Reisenden zu einer Reise wurde ergonomisch verbessert.* Einige Popup-Fenster wurden durch echte Dialoge ersetzt.* Diverse Verbesserungen der inneren Codequalität.$ 1.3.1% Version 1.3.1_ 2013-05-05* Verkleinerung der App-Größe (proguard).* Das Hinzufügen von Reisenden zu einer Reise wurde vereinfacht und überarbeitet. Mehrere Reisende können in einem Rutsch hinzugefügt werden.* Actionbar findet auf den Hauptdialogen Verwendung.$ 1.3.0% Version 1.3.0_ 2013-04-05* Wechselkursverwaltung und Währungsumrechner wurden hinzugefügt.* Allgemein: Überarbeitung des Frontends.* ActionBar steht jetzt zur Verwendung auf Sekundärdialogen bereit.$ 1.2.5% Version 1.2.5_ 2013-01-11* Popups mit Eingabefeldern werden jetzt gestaucht, um die Zugänglichkeit Buttons bei eingeblendeter Tastatur auf moderneren Telefonen zu verbessern.* Bugfix: Vorhandene Summen größer als 1000 konnten nicht editiert werden.$ 1.2.4% Version 1.2.4_ 2013-01-10* Bugfix: Nachkommastellen konnten auf einigen Telefonen nicht editiert werden (bspw. HTC Desire Bravo, Samsung Galaxy S3, Samsung Galaxy 9000). Ursache: Inkonsistente Eingabe-Keyboards.$ 1.2.3% Version 1.2.3_ 10.10.2012* <span class=""appinternal"">Änderungshistorie</span> wird nach Installation angezeigt.* <span class=""appinternal"">Was ist neu</span> wird nach Update angezeigt.* Der Dialog <span class=""appinternal"">Einstellungen</span> wurde hinzugefügt.* Die Standardwährung kannst Du jetzt einstellen (über den <span class=""appinternal"">Einstellungen</span>-Dialog).* Die <span class=""appinternal"">Interaktive Hilfe</span> kann an- und ausgeschaltet werden (über den <span class=""appinternal"">Einstellungen</span>-Dialog).* Bei Reisen ist die Währung jetzt einstellbar.$ 1.2.2% Version 1.2.2_ 22.06.2012* Fehler behoben: Export funktionierte nur mit deutscher Spracheinstellung des Telefons.$ 1.2.1% Version 1.2.1_ 19.06.2012* Exportfunktion hinzugefügt.$ END_OF_CHANGE_LOG</body></html>",trickytripper/app/src/main/res/raw-de/changelog.txt
8,"<html><head><style type='text/css'>a                {color:purple;font-style:italic; }div.title              {color:purple;font-weight:bold;font-size:1.2em;font-weight:bold;margin-top:1em;margin-bottom:0.5em;text-align:center }div.subtitle      {color:purple;font-weight:bold;font-size:0.8em;margin-bottom:1em;text-align:center }.appinternal          {font-style:italic; }.app                 {color:purple;font-weight:bold;}</style></head><body>$ 1.6.1% Version 1.6.1_ 2019-XX-XX* Fix tab refresh post payment deletion, e.g. balance and report.* Fix errors on tab-change while options menu is opened.$ 1.6.0% Version 1.6.0_ 2018-10-01* Fix online retrieval of currencies, but without support for El Salvador Colon and Sambian Kwacha.$ 1.5.9% Version 1.5.9_ 2017-09-23* Report export: The Android application chooser now lets you pick the destination application of your choice, like e.g. Google Drive. The limitation to only a few supported applications has been removed.* Report export: Choose to open the files instead of sending/saving them.* Support for Android O.$ 1.5.8% Version 1.5.8_ 2016-11-23* Fixed various crashes on selection on main screens.$ 1.5.7% Version 1.5.7_ 2016-11-16* Fix: You could not delete the currently selected trip without crashing.* Improvement: The app now auto-suggests previous payment descriptions (thx mbrgm).$ 1.5.6% Version 1.5.6_ 2016-10-10* Spanish translation added (thanks to Igor Sosa Mayor).* Boxer is now available for exporting reports.$ 1.5.5% Version 1.5.5_ 2016-02-27* French translation added (thanks to Nicolas Bossard).* Italian translation extended(thanks to Andrea Zanella).* Framework for the exchange rate download has been replaced.* K9-Mail is now available for exporting reports.$ 1.5.4% Version 1.5.4_ 2016-01-17* Time picker was not visible on screen on Android 6 devices.* Fixed technical error making the app crash when using the currency calculator on some phones.$ 1.5.3% Version 1.5.3_ 2015-10-18* Support for Android 6 (permissions).* Help texts for blank list dialogs now match UI conventions.$ 1.5.2% Version 1.5.2_ 2015-03-08* Bugfix: Date- and timepicker have different behaviour in Android 5.$ 1.5.1% Version 1.5.1_ 2015-03-07* Moved trip selection and management into newly introduced drawer, accessible via burger button.* Removed context menus: Functionality now available via contextual action bar.* Refurbished dialogs and icons to suit Android 5's material design guideline.* Supports Android 5 devices.$ 1.4.3% Version 1.4.3_ 2013-12-09* Exchange rate import from the internet now works again: The former interfaces by Google had been switched off.$ 1.4.2% Version 1.4.2_ 2013-09-29* Date and time of payment: Enable display, editing, export and sorting of/by payment time.* Refurbished report tab view: All owing debts are displayed when report scope is for all travelers.* Bugfix: Add button used to be invisible from time to time.$ 1.4.1% Version 1.4.1_ 2013-08-31* Italian translation added (thanks to Andrea Zanella).* Bugfix: Saving to SD card now works again.* Bugfix: Update of a travelers's name did not update the report, unless the trip was reloaded.$ 1.4.0% Version 1.4.0_ 2013-06-03* Bugfix: The rest of the equal split division is now equally distributed among the travelers.* No detour via context menu: A Single tap on a traveler now opens <span class=""appinternal"">Create Payment</span>, on payment it opens <span class=""appinternal"">Edit Payment</span> when suitable.* Action bar features have been enabled for the primary tabs.* The functionality to add travelers to a trip has been ergonomically improved.* Various popup dialogs have been replaced by real dialogs.* Various improvements of the internal code quality.$ 1.3.1% Version 1.3.1_ 2013-04-05* Shrink app size (proguard).* Add participant to trip has been refurbished and allows to add more than one at once.* Actionbar now in use on primary dialogs.$ 1.3.0% Version 1.3.0_ 2013-04-05* Exchange rate management and currency calculator added.* Frontend refurbished and revised.* Actionbar now in use on non-primary dialogs.$ 1.2.5% Version 1.2.5_ 2013-01-11* Popups with input fields have been shrinked to improve the accessibility of buttons on modern phones.* Bugfix: Existing sums greater than 1000 could not be edited, due to a change in the delimiter handling.$ 1.2.4% Version 1.2.4_ 2013-01-10* Bugfix: Decimal place could not be edited on some phones due to inconsistent softkeyboard implementations, e.g. HTC Desire Bravo, Samsung Galaxy S3, Samsung Galaxy 9000.$ 1.2.3% Version 1.2.3_ 2012-10-10* <span class=""appinternal"">Chang Log</span> is shown after installation.* <span class=""appinternal"">What's New</span> is shown on update.* <span class=""appinternal"">Settings</span> dialog has been added.* Define your default currency (via <span class=""appinternal"">Settings</span> dialog).* Switch smart help on/off (via <span class=""appinternal"">Settings</span> dialog).* You can select your trip's base currency.$ 1.2.2% Version 1.2.2_ 2012-06-22* Bugfix for an error occurring during export execution when language was not German.$ 1.2.1% Version 1.2.1_ 2012-06-19* Export feature added.$ END_OF_CHANGE_LOG</body></html>",trickytripper/app/src/main/res/raw/changelog.txt
18,"/**    Calendula - An assistant for personal medication management.*    Copyright (C) 2014-2018 CiTIUS - University of Santiago de Compostela**    Calendula is free software; you can redistribute it and/or modify*    it under the terms of the GNU General Public License as published by*    the Free Software Foundation; either version 3 of the License, or*    (at your option) any later version.**    This program is distributed in the hope that it will be useful,*    but WITHOUT ANY WARRANTY; without even the implied warranty of*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the*    GNU General Public License for more details.**    You should have received a copy of the GNU General Public License*    along with this software.  If not, see <http://www.gnu.org/licenses/>.*/package es.usc.citius.servando.calendula.fragments;import android.app.Activity;import android.content.Context;import android.content.SharedPreferences;import android.graphics.Color;import android.graphics.drawable.Drawable;import android.os.AsyncTask;import android.os.Bundle;import android.support.annotation.NonNull;import android.support.v4.app.Fragment;import android.text.Editable;import android.text.TextWatcher;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.view.inputmethod.InputMethodManager;import android.widget.CompoundButton;import android.widget.HorizontalScrollView;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.NumberPicker;import android.widget.RelativeLayout;import android.widget.ScrollView;import android.widget.Switch;import android.widget.TextView;import com.afollestad.materialdialogs.DialogAction;import com.afollestad.materialdialogs.MaterialDialog;import com.codetroopers.betterpickers.numberpicker.NumberPickerBuilder;import com.codetroopers.betterpickers.numberpicker.NumberPickerDialogFragment;import com.github.javiersantos.materialstyleddialogs.MaterialStyledDialog;import com.github.javiersantos.materialstyleddialogs.enums.Style;import com.j256.ormlite.stmt.PreparedQuery;import com.mikepenz.community_material_typeface_library.CommunityMaterial;import com.mikepenz.iconics.IconicsDrawable;import com.mikepenz.iconics.typeface.IIcon;import com.mikepenz.iconics.view.IconicsImageView;import org.joda.time.LocalDate;import java.math.BigDecimal;import java.math.BigInteger;import java.sql.SQLException;import java.util.ArrayList;import java.util.List;import butterknife.BindView;import butterknife.ButterKnife;import butterknife.OnClick;import butterknife.Unbinder;import es.usc.citius.servando.calendula.CalendulaApp;import es.usc.citius.servando.calendula.R;import es.usc.citius.servando.calendula.activities.MedicinesActivity;import es.usc.citius.servando.calendula.activities.ScheduleCreationActivity;import es.usc.citius.servando.calendula.database.DB;import es.usc.citius.servando.calendula.drugdb.DBRegistry;import es.usc.citius.servando.calendula.drugdb.PrescriptionDBMgr;import es.usc.citius.servando.calendula.drugdb.model.persistence.Prescription;import es.usc.citius.servando.calendula.modules.ModuleManager;import es.usc.citius.servando.calendula.modules.modules.StockModule;import es.usc.citius.servando.calendula.persistence.Medicine;import es.usc.citius.servando.calendula.persistence.Presentation;import es.usc.citius.servando.calendula.util.IconUtils;import es.usc.citius.servando.calendula.util.LogUtil;import es.usc.citius.servando.calendula.util.PreferenceKeys;import es.usc.citius.servando.calendula.util.PreferenceUtils;import es.usc.citius.servando.calendula.util.Snack;import es.usc.citius.servando.calendula.util.Strings;import es.usc.citius.servando.calendula.util.stock.MedicineScheduleStockProvider;import es.usc.citius.servando.calendula.util.stock.StockCalculator;import es.usc.citius.servando.calendula.util.stock.StockDisplayUtils;public class MedicineCreateOrEditFragment extends Fragment implements SharedPreferences.OnSharedPreferenceChangeListener,NumberPickerDialogFragment.NumberPickerDialogHandlerV2 {private static final int DIALOG_STOCK_ADD = 1;private static final int DIALOG_STOCK_REMOVE = 2;private static final String TAG = ""MedicineCreateOrEditFr"";OnMedicineEditListener mMedicineEditCallback;Medicine mMedicine;Prescription mPrescription;Boolean showConfirmButton = true;@BindView(R.id.medicine_edit_name)TextView mNameTextView;@BindView(R.id.textView3)TextView mPresentationTv;Presentation selectedPresentation;@BindView(R.id.med_presentation_scroll)HorizontalScrollView presentationScroll;@BindView(R.id.scrollView)ScrollView verticalScrollView;@BindView(R.id.stock_layout)RelativeLayout stockLayout;@BindView(R.id.stock_units)TextView mStockUnits;@BindView(R.id.stock_estimated_duration)TextView mStockEstimation;@BindView(R.id.stock_switch)Switch stockSwitch;@BindView(R.id.btn_stock_add)IconicsImageView addBtn;@BindView(R.id.btn_stock_remove)IconicsImageView rmBtn;@BindView(R.id.btn_stock_reset)IconicsImageView resetBtn;boolean enableSearch = false;long mMedicineId;int pColor;PrescriptionDBMgr dbMgr;float stock = -1;String estimatedStockText = """";private String mIntentAction;private Unbinder unbinder;private static ArrayList<View> getViewsByTag(ViewGroup root, String tag) {ArrayList<View> views = new ArrayList<>();final int childCount = root.getChildCount();for (int i = 0; i < childCount; i++) {final View child = root.getChildAt(i);if (child instanceof ViewGroup) {views.addAll(getViewsByTag((ViewGroup) child, tag));}final Object tagObj = child.getTag();if (tagObj != null && tagObj.equals(tag)) {views.add(child);}}return views;}@Overridepublic void onCreate(Bundle savedInstanceState) {super.onCreate(savedInstanceState);dbMgr = DBRegistry.instance().current();}@Overridepublic View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {View rootView = inflater.inflate(R.layout.fragment_create_or_edit_medicine, container, false);unbinder = ButterKnife.bind(this, rootView);if (ModuleManager.isEnabled(StockModule.ID)) {stockLayout.setVisibility(View.VISIBLE);}pColor = DB.patients().getActive(getActivity()).getColor();setupIcons(rootView);mNameTextView.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View view) {final MedicinesActivity medicinesActivity = (MedicinesActivity) getActivity();CharSequence text = mNameTextView.getText();medicinesActivity.showSearchView(text != null ? text.toString() : null);}});mNameTextView.setCompoundDrawables(null, null, new IconicsDrawable(getActivity()).icon(CommunityMaterial.Icon.cmd_arrow_top_right).color(pColor).sizeDp(30).paddingDp(5), null);String none = getString(R.string.database_none_id);String settingUp = getString(R.string.database_setting_up);String value = PreferenceUtils.getString(PreferenceKeys.DRUGDB_CURRENT_DB, none);enableSearch = !value.equals(none) && !value.equals(settingUp);LogUtil.d(TAG, ""Arguments:  "" + (getArguments() != null) + "", savedState: "" + (savedInstanceState != null));if (getArguments() != null) {mIntentAction = getArguments().getString(CalendulaApp.INTENT_EXTRA_ACTION);mMedicineId = getArguments().getLong(CalendulaApp.INTENT_EXTRA_MEDICINE_ID, -1);}if (mMedicineId == -1 && savedInstanceState != null) {mMedicineId = savedInstanceState.getLong(CalendulaApp.INTENT_EXTRA_MEDICINE_ID, -1);}if (mMedicineId != -1) {mMedicine = Medicine.findById(mMedicineId);}addPresentations(rootView);//setupMedPresentationChooser(rootView);mNameTextView.addTextChangedListener(new TextWatcher() {@Overridepublic void beforeTextChanged(CharSequence s, int start, int count, int after) {}@Overridepublic void onTextChanged(CharSequence s, int start, int before, int count) {}@Overridepublic void afterTextChanged(Editable s) {String name = mNameTextView.getText().toString();if (mPrescription != null && !dbMgr.shortName(mPrescription).toLowerCase().equals(name.toLowerCase())) {mPrescription = null;}}});setupStockViews();if (mIntentAction == null) {mNameTextView.requestFocus();} else if (""add_stock"".equals(mIntentAction)) {showStockDialog(DIALOG_STOCK_ADD);}return rootView;}@Overridepublic void onDestroyView() {super.onDestroyView();if (unbinder != null)unbinder.unbind();}@Overridepublic void onViewCreated(View view, Bundle savedInstanceState) {super.onViewCreated(view, savedInstanceState);if (mMedicine != null) {setMedicne(mMedicine);}}@Overridepublic void onResume() {super.onResume();PreferenceUtils.instance().preferences().registerOnSharedPreferenceChangeListener(this);}@Overridepublic void onPause() {super.onPause();PreferenceUtils.instance().preferences().unregisterOnSharedPreferenceChangeListener(this);}public boolean validate() {if (mNameTextView.getText() != null && mNameTextView.getText().length() > 0) {if (selectedPresentation == null) {hideKeyboard();Snack.show(R.string.medicine_no_presentation_error_message, getActivity());return false;}return true;} else {mNameTextView.setError(getString(R.string.medicine_no_name_error_message));mNameTextView.addTextChangedListener(new TextWatcher() {@Overridepublic void onTextChanged(CharSequence charSequence, int i, int i2, int i3) {mNameTextView.setError(null);mNameTextView.removeTextChangedListener(this);}@Overridepublic void beforeTextChanged(CharSequence charSequence, int i, int i2, int i3) {}@Overridepublic void afterTextChanged(Editable editable) {}});return false;}}public void scrollToMedPresentation(View view) {LogUtil.d(TAG, ""Scroll to: "" + view.getLeft());int amount = view.getLeft();if (amount < (0.8 * presentationScroll.getWidth())) {amount -= 30;}presentationScroll.smoothScrollTo(amount, 0);}@Overridepublic void onSaveInstanceState(Bundle outState) {super.onSaveInstanceState(outState);if (mMedicine != null && mMedicine.getId() != null)outState.putLong(CalendulaApp.INTENT_EXTRA_MEDICINE_ID, mMedicine.getId());}public void setMedicne(Medicine r) {LogUtil.d(TAG, ""Medicine set: "" + r.getName());mMedicine = r;mNameTextView.setText(mMedicine.getName());mPresentationTv.setText("": "" + mMedicine.getPresentation().getName(getResources()));selectedPresentation = mMedicine.getPresentation();selectPresentation(mMedicine.getPresentation());if (r.getCn() != null) {Prescription p = DB.drugDB().prescriptions().findByCn(r.getCn());if (p != null) {mPrescription = p;//                mDescriptionTv.setText(p.getName());new ComputeEstimatedStockEndTask().execute();}}}public void setPrescription(Prescription p) {mNameTextView.setText(Strings.toProperCase(dbMgr.shortName(p)));mPrescription = p;Presentation pr = DBRegistry.instance().current().expectedPresentation(p);if (pr != null) {mPresentationTv.setText("": "" + pr.getName(getResources()));selectedPresentation = pr;selectPresentation(pr);}}public void setMedicineName(String medName) {mNameTextView.setText(medName);mPrescription = null;}public void clear() {mMedicine = null;mNameTextView.setText("""");}public void onEdit() {String name = mNameTextView.getText().toString();if (name != null && name.length() > 0) {// if editingif (mMedicine != null) {mMedicine.setName(name);mMedicine.setStock(stockSwitch.isChecked() ? stock : -1);if (selectedPresentation != null) {mMedicine.setPresentation(selectedPresentation);}if (mPrescription != null) {mMedicine.setCn(String.valueOf(mPrescription.getCode()));mMedicine.setDatabase(DBRegistry.instance().current().id());} else if (mPrescription == null) {mMedicine.setCn(null);}if (mMedicineEditCallback != null && !checkIfDuplicate(mMedicine)) {mMedicineEditCallback.onMedicineEdited(mMedicine);}}// if creatingelse {if (!validate()) {return;}Medicine m = new Medicine(name);if (mPrescription != null) {m.setCn(String.valueOf(mPrescription.getCode()));m.setDatabase(DBRegistry.instance().current().id());}m.setStock(stockSwitch.isChecked() ? stock : -1);m.setPresentation(selectedPresentation != null ? selectedPresentation : Presentation.UNKNOWN);m.setPatient(DB.patients().getActive(getContext()));if (mMedicineEditCallback != null && !checkIfDuplicate(m)) {mMedicineEditCallback.onMedicineCreated(m);}}} else {Snack.show(R.string.medicine_no_name_error_message, getActivity());}}@Overridepublic void onAttach(Activity activity) {super.onAttach(activity);LogUtil.d(TAG, ""Activity "" + activity.getClass().getName() + "", "" + (activity instanceof OnMedicineEditListener));// If the container activity has implemented// the callback interface, set it as listenerif (activity instanceof OnMedicineEditListener) {mMedicineEditCallback = (OnMedicineEditListener) activity;}if (activity instanceof ScheduleCreationActivity) {this.showConfirmButton = false;}}@Overridepublic void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String key) {if (PreferenceKeys.DRUGDB_CURRENT_DB.key().equals(key)) {String none = getString(R.string.database_none_id);String settingUp = getString(R.string.database_setting_up);String value = sharedPreferences.getString(PreferenceKeys.DRUGDB_CURRENT_DB.key(), none);enableSearch = !value.equals(none) && !value.equals(settingUp);if (enableSearch) {//                enableSearchButton();} else {//                searchButton.setVisibility(View.GONE);}}}public void setupIcons(View root) {Context c = getActivity();int color = R.color.dark_grey_home;int size = 24;Drawable ic1 = IconUtils.icon(c, CommunityMaterial.Icon.cmd_pencil, color, size, 4);Drawable ic2 = IconUtils.icon(c, CommunityMaterial.Icon.cmd_eye, color, size, 4);Drawable ic3 = IconUtils.icon(c, CommunityMaterial.Icon.cmd_basket, color, size, 4);((ImageView) root.findViewById(R.id.ic_med_name)).setImageDrawable(ic1);((ImageView) root.findViewById(R.id.ic_med_presentation)).setImageDrawable(ic2);((ImageView) root.findViewById(R.id.ic_med_stock)).setImageDrawable(ic3);}@Overridepublic void onDialogNumberSet(int reference, BigInteger number, double decimal, boolean isNegative, BigDecimal fullNumber) {float amount = fullNumber.floatValue();if (reference == DIALOG_STOCK_ADD) {stock = (stock == -1) ? amount : (stock + amount);} else if (reference == DIALOG_STOCK_REMOVE) {if (amount >= stock)stock = 0;elsestock -= amount;}new ComputeEstimatedStockEndTask().execute();}void updateStockText() {String units = selectedPresentation != null ? selectedPresentation.units(getResources(), stock) : Presentation.UNKNOWN.units(getResources(), stock);String text = stock == -1 ? getString(R.string.no_stock_info_msg) : (stock + "" "" + units);mStockEstimation.setVisibility(estimatedStockText != null ? View.VISIBLE : View.INVISIBLE);mStockEstimation.setText(estimatedStockText != null ? estimatedStockText : """");mStockUnits.setText(text);}void showStockDialog(int ref) {NumberPickerBuilder npb =new NumberPickerBuilder().setMinNumber(BigDecimal.ONE)//.setLabelText(ref == DIALOG_STOCK_ADD ? ""Increase stock by"" : ""Decrease stock by"").setDecimalVisibility(NumberPicker.VISIBLE).setPlusMinusVisibility(NumberPicker.INVISIBLE).setFragmentManager(getActivity().getSupportFragmentManager()).setTargetFragment(this).setReference(ref).setStyleResId(R.style.BetterPickersDialogFragment_Calendula);npb.show();}void addPresentations(View rootView) {LinearLayout parent = (LinearLayout) rootView.findViewById(R.id.presentation_scroll_content);for (final Presentation p : Presentation.available()) {View item = getLayoutInflater().inflate(R.layout.presentation_chooser_item, null);ImageView imageView = (ImageView) item.findViewById(R.id.presentation_chooser_item_drawable);imageView.setImageDrawable(iconFor(p.icon()));item.setTag(p);parent.addView(item);item.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {selectPresentation(p);updateStockText();}});}}IconicsDrawable iconFor(IIcon ic) {return new IconicsDrawable(getContext()).alpha(50).icon(ic).colorRes(R.color.agenda_item_title).paddingDp(5).sizeDp(80);}void hideKeyboard() {InputMethodManager imm = (InputMethodManager) getActivity().getSystemService(Context.INPUT_METHOD_SERVICE);imm.hideSoftInputFromWindow(mNameTextView.getWindowToken(), 0);}@OnClick(R.id.btn_stock_add)protected void addStock() {final MedicinesActivity medicinesActivity = (MedicinesActivity) getActivity();showStockDialog(DIALOG_STOCK_ADD);}@OnClick(R.id.btn_stock_remove)protected void removeStock() {final MedicinesActivity medicinesActivity = (MedicinesActivity) getActivity();showStockDialog(DIALOG_STOCK_REMOVE);}@OnClick(R.id.btn_stock_reset)protected void resetStock() {final MedicinesActivity medicinesActivity = (MedicinesActivity) getActivity();new MaterialStyledDialog.Builder(getContext()).setStyle(Style.HEADER_WITH_ICON).setIcon(IconUtils.icon(getContext(), mMedicine.getPresentation().icon(), R.color.white, 100)).setHeaderColor(R.color.android_orange_dark).withDialogAnimation(true).setTitle(R.string.title_reset_stock).setDescription(getString(R.string.message_reset_stock, mMedicine.getName())).setCancelable(true).setNegativeText(R.string.cancel).setPositiveText(R.string.reset).onPositive(new MaterialDialog.SingleButtonCallback() {@Overridepublic void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction which) {LogUtil.d(TAG, ""onClick: resetting stock..."");setDefaultStock();updateStockText();}}).show();}private void setupStockViews() {IconicsDrawable resetDrawable = new IconicsDrawable(getContext(), CommunityMaterial.Icon.cmd_reload).iconOffsetXDp(2).backgroundColorRes(R.color.agenda_item_title).sizeDp(40).paddingDp(10).color(Color.WHITE).roundedCornersDp(23);resetBtn.setImageDrawable(resetDrawable);stockSwitch.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {updateStockControlsVisibility();if (isChecked) {// user is enabling stock first timeif (stock == -1)setDefaultStock();verticalScrollView.post(new Runnable() {@Overridepublic void run() {verticalScrollView.fullScroll(View.FOCUS_DOWN);}});}}});stock = mMedicine != null && mMedicine.getStock() != null ? mMedicine.getStock() : -1;if (stock > -1) {stockSwitch.setChecked(true);}updateStockControlsVisibility();updateStockText();}private void setDefaultStock() {if (mPrescription != null && mPrescription.getPackagingUnits() > 0) {stock = mPrescription.getPackagingUnits();new ComputeEstimatedStockEndTask().execute();}}private void updateStockControlsVisibility() {int visibility = stockSwitch.isChecked() ? View.VISIBLE : View.INVISIBLE;mStockUnits.setVisibility(visibility);mStockEstimation.setVisibility((stockSwitch.isChecked() && (estimatedStockText != null)) ? View.VISIBLE : View.INVISIBLE);addBtn.setVisibility(visibility);rmBtn.setVisibility(visibility);int resetVisibility = stockSwitch.isChecked() && mMedicine != null && mMedicine.isBoundToPrescription() ? View.VISIBLE : View.GONE;resetBtn.setVisibility(resetVisibility);}private void selectPresentation(Presentation p) {selectedPresentation = p;for (View v : getViewsByTag((ViewGroup) getView(), getString(R.string.presentation_item_tag))) {v.setBackgroundColor(getResources().getColor(R.color.transparent));}if (p != null) {View view = getView().findViewWithTag(p);if(view != null) {ImageView image = (ImageView) view.findViewById(R.id.presentation_chooser_item_drawable);image.setBackgroundResource(R.drawable.presentation_circle_background);mPresentationTv.setText("": "" + p.getName(getResources()));scrollToMedPresentation(view);}}}private boolean checkIfDuplicate(final Medicine m) {try {List<Medicine> others;if (m.isBoundToPrescription()) {final String cn = m.getCn();final PreparedQuery<Medicine> query = DB.medicines().queryBuilder().where().eq(Medicine.COLUMN_PATIENT, m.getPatient()).and().eq(Medicine.COLUMN_CN, cn).prepare();others = DB.medicines().query(query);} else {final String name = m.getName();final Presentation presentation = m.getPresentation();final PreparedQuery<Medicine> query = DB.medicines().queryBuilder().where().eq(Medicine.COLUMN_PATIENT, m.getPatient()).and().eq(Medicine.COLUMN_NAME, name).and().eq(Medicine.COLUMN_PRESENTATION, presentation).prepare();others = DB.medicines().query(query);}boolean ret = false;if (others != null && others.size() > 0) {if (others.size() > 1) //should not happenLogUtil.e(TAG, ""checkIfDuplicate: multiple duplicates detected for medicine: "" + m);final Medicine other = others.get(0);ret = !other.getId().equals(m.getId());}if (ret) {Snack.show(R.string.error_duplicate_medicine, this.getActivity());}return ret;} catch (SQLException e) {LogUtil.e(TAG, ""checkIfDuplicate: "", e);return false;}}private void showSoftInput() {mNameTextView.postDelayed(new Runnable() {@Overridepublic void run() {InputMethodManager keyboard = (InputMethodManager) getActivity().getSystemService(Context.INPUT_METHOD_SERVICE);keyboard.showSoftInput(mNameTextView, 0);}}, 10);}// Container Activity must implement this interfacepublic interface OnMedicineEditListener {void onMedicineEdited(Medicine r);void onMedicineCreated(Medicine r);void onMedicineDeleted(Medicine r);}public class ComputeEstimatedStockEndTask extends AsyncTask<Void, Void, Boolean> {String text;@Overrideprotected Boolean doInBackground(Void... params) {if (stock >= 0 && mMedicine != null) {LogUtil.d(TAG, ""updateStockText: medicina ok"");final StockCalculator.StockEnd stockEnd = StockCalculator.calculateStockEnd(LocalDate.now(), new MedicineScheduleStockProvider(mMedicine), stock);text = StockDisplayUtils.getReadableStockDuration(stockEnd, getContext());return true;}return false;}@Overrideprotected void onPreExecute() {super.onPreExecute();estimatedStockText = null;updateStockText();}@Overrideprotected void onPostExecute(Boolean res) {super.onPostExecute(res);if (res) {estimatedStockText = text;updateStockText();}}}}",Calendula/src/main/java/es/usc/citius/servando/calendula/fragments/MedicineCreateOrEditFragment.java
18,"/**    Calendula - An assistant for personal medication management.*    Copyright (C) 2014-2018 CiTIUS - University of Santiago de Compostela**    Calendula is free software; you can redistribute it and/or modify*    it under the terms of the GNU General Public License as published by*    the Free Software Foundation; either version 3 of the License, or*    (at your option) any later version.**    This program is distributed in the hope that it will be useful,*    but WITHOUT ANY WARRANTY; without even the implied warranty of*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the*    GNU General Public License for more details.**    You should have received a copy of the GNU General Public License*    along with this software.  If not, see <http://www.gnu.org/licenses/>.*/package es.usc.citius.servando.calendula.fragments;import android.app.Activity;import android.app.AlertDialog;import android.content.DialogInterface;import android.os.Build;import android.os.Bundle;import android.support.v4.app.DialogFragment;import android.util.DisplayMetrics;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.Button;import android.widget.TextView;import com.codetroopers.betterpickers.radialtimepicker.RadialTimePickerDialogFragment;import com.codetroopers.betterpickers.timepicker.TimePickerBuilder;import com.codetroopers.betterpickers.timepicker.TimePickerDialogFragment;import org.joda.time.DateTime;import org.joda.time.LocalTime;import butterknife.BindView;import butterknife.ButterKnife;import butterknife.Unbinder;import es.usc.citius.servando.calendula.CalendulaApp;import es.usc.citius.servando.calendula.R;import es.usc.citius.servando.calendula.database.DB;import es.usc.citius.servando.calendula.persistence.Routine;import es.usc.citius.servando.calendula.util.LogUtil;import es.usc.citius.servando.calendula.util.Snack;public class RoutineCreateOrEditFragment extends DialogFragment implements RadialTimePickerDialogFragment.OnTimeSetListener, TimePickerDialogFragment.TimePickerDialogHandler {private static final String TAG = ""RoutineCoEFragment"";OnRoutineEditListener mRoutineEditCallback;Routine mRoutine;@BindView(R.id.button2)Button timeButton;@BindView(R.id.routine_edit_name)TextView mNameTextView;Button mConfirmButton;Unbinder unbinder = null;int hour;int minute;int pColor;@Overridepublic View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {View rootView = inflater.inflate(R.layout.fragment_create_or_edit_routine, container, false);ButterKnife.bind(this, rootView);pColor = DB.patients().getActive(getActivity()).getColor();timeButton.setTextColor(pColor);long routineId = -1;if (getArguments() != null) {routineId = getArguments().getLong(CalendulaApp.INTENT_EXTRA_ROUTINE_ID, -1);}if (routineId == -1 && savedInstanceState != null) {routineId = savedInstanceState.getLong(CalendulaApp.INTENT_EXTRA_ROUTINE_ID, -1);}setRoutine(routineId);if (getDialog() != null) {getDialog().setTitle(R.string.title_create_routine_activity);mConfirmButton = (Button) rootView.findViewById(R.id.done_button);mConfirmButton.setVisibility(View.VISIBLE);mConfirmButton.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View view) {onEdit();}});}timeButton.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {float density = getResources().getDisplayMetrics().densityDpi;LogUtil.d(TAG, ""Density: "" + density);if (density >= DisplayMetrics.DENSITY_XHIGH || Build.VERSION.SDK_INT <= Build.VERSION_CODES.KITKAT) {RadialTimePickerDialogFragment timePickerFragment = new RadialTimePickerDialogFragment().setOnTimeSetListener(RoutineCreateOrEditFragment.this).setStartTime(hour, minute);timePickerFragment.show(getActivity().getSupportFragmentManager(), ""TIME_PICKER_FRAGMENT"");} else {TimePickerBuilder tpb = new TimePickerBuilder().setFragmentManager(getActivity().getSupportFragmentManager()).setStyleResId(R.style.BetterPickersDialogFragment_Light);tpb.addTimePickerDialogHandler(RoutineCreateOrEditFragment.this);tpb.show();}}});updateTime();return rootView;}public void setRoutine(long routineId) {if (routineId != -1) {mRoutine = Routine.findById(routineId);hour = mRoutine.getTime().getHourOfDay();minute = mRoutine.getTime().getMinuteOfHour();setRoutine(mRoutine);} else {DateTime now = DateTime.now();hour = now.getHourOfDay();minute = now.getMinuteOfHour();}}@Overridepublic void onSaveInstanceState(Bundle outState) {super.onSaveInstanceState(outState);if (mRoutine != null)outState.putLong(CalendulaApp.INTENT_EXTRA_ROUTINE_ID, mRoutine.getId());}@Overridepublic void onDestroyView() {super.onDestroyView();if (unbinder != null) {unbinder.unbind();unbinder = null;}}public void onEdit() {String name = mNameTextView.getText().toString();if (name != null && name.length() > 0) {// if editingif (mRoutine != null) {mRoutine.setName(name);mRoutine.setTime(new LocalTime(hour, minute));DB.routines().saveAndFireEvent(mRoutine);//mRoutine.save();if (mRoutineEditCallback != null) {mRoutineEditCallback.onRoutineEdited(mRoutine);}}// if creatingelse {mRoutine = new Routine(new LocalTime(hour, minute), name);mRoutine.setPatient(DB.patients().getActive(getContext()));LogUtil.d(TAG, ""Routine created"");DB.routines().saveAndFireEvent(mRoutine);if (mRoutineEditCallback != null) {mRoutineEditCallback.onRoutineCreated(mRoutine);}}} else {Snack.show(R.string.medicine_no_name_error_message, getActivity());}}public void showDeleteConfirmationDialog(final Routine r) {AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());String message;if (r.getScheduleItems().size() > 0) {message = String.format(getString(R.string.remove_routine_message_long), r.getName());} else {message = String.format(getString(R.string.remove_routine_message_short), r.getName());}builder.setMessage(message).setCancelable(true).setTitle(getString(R.string.remove_routine_dialog_title)).setPositiveButton(getString(R.string.dialog_yes_option), new DialogInterface.OnClickListener() {public void onClick(DialogInterface dialog, int id) {if (mRoutineEditCallback != null) {mRoutineEditCallback.onRoutineDeleted(mRoutine);}}}).setNegativeButton(getString(R.string.dialog_no_option), new DialogInterface.OnClickListener() {public void onClick(DialogInterface dialog, int id) {dialog.cancel();}});AlertDialog alert = builder.create();alert.show();}@Overridepublic void onAttach(Activity activity) {super.onAttach(activity);LogUtil.d(TAG, ""Activity "" + activity.getClass().getName() + "", "" + (activity instanceof OnRoutineEditListener));// If the container activity has implemented// the callback interface, set it as listenerif (activity instanceof OnRoutineEditListener) {LogUtil.d(TAG, ""Set onRoutineEditListener onAttach"");mRoutineEditCallback = (OnRoutineEditListener) activity;}}// optionally set the listener manuallypublic void setOnRoutineEditListener(OnRoutineEditListener l) {mRoutineEditCallback = l;}@Overridepublic void onDialogTimeSet(int ref, int hour, int minute) {onTimeSet(null, hour, minute);}@Overridepublic void onTimeSet(RadialTimePickerDialogFragment dialog, int hourOfDay, int minute) {this.hour = hourOfDay;this.minute = minute;updateTime();}void updateTime() {timeButton.setText(new LocalTime(hour, minute).toString(""HH:mm""));}private void setRoutine(Routine r) {LogUtil.d(TAG, ""Routine set: "" + r.getName());mRoutine = r;mNameTextView.setText(mRoutine.getName());updateTime();}// Container Activity must implement this interfacepublic interface OnRoutineEditListener {void onRoutineEdited(Routine r);void onRoutineCreated(Routine r);void onRoutineDeleted(Routine r);}}",Calendula/src/main/java/es/usc/citius/servando/calendula/fragments/RoutineCreateOrEditFragment.java
18,"/**    Calendula - An assistant for personal medication management.*    Copyright (C) 2014-2018 CiTIUS - University of Santiago de Compostela**    Calendula is free software; you can redistribute it and/or modify*    it under the terms of the GNU General Public License as published by*    the Free Software Foundation; either version 3 of the License, or*    (at your option) any later version.**    This program is distributed in the hope that it will be useful,*    but WITHOUT ANY WARRANTY; without even the implied warranty of*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the*    GNU General Public License for more details.**    You should have received a copy of the GNU General Public License*    along with this software.  If not, see <http://www.gnu.org/licenses/>.*/package es.usc.citius.servando.calendula.fragments;import android.app.AlertDialog;import android.app.DatePickerDialog;import android.content.ContextWrapper;import android.content.DialogInterface;import android.content.res.Resources;import android.graphics.Color;import android.graphics.Typeface;import android.graphics.drawable.GradientDrawable;import android.graphics.drawable.StateListDrawable;import android.os.Bundle;import android.support.annotation.NonNull;import android.support.v4.app.Fragment;import android.support.v4.app.FragmentManager;import android.text.Html;import android.text.Spanned;import android.text.format.Time;import android.util.Log;import android.view.LayoutInflater;import android.view.MotionEvent;import android.view.View;import android.view.ViewGroup;import android.view.animation.Animation;import android.view.animation.AnimationUtils;import android.widget.AdapterView;import android.widget.ArrayAdapter;import android.widget.Button;import android.widget.DatePicker;import android.widget.ImageButton;import android.widget.LinearLayout;import android.widget.NumberPicker;import android.widget.ScrollView;import android.widget.Spinner;import android.widget.TextView;import com.codetroopers.betterpickers.numberpicker.NumberPickerBuilder;import com.codetroopers.betterpickers.numberpicker.NumberPickerDialogFragment;import com.codetroopers.betterpickers.radialtimepicker.RadialTimePickerDialogFragment;import com.codetroopers.betterpickers.recurrencepicker.EventRecurrence;import com.codetroopers.betterpickers.recurrencepicker.RecurrencePickerDialogFragment;import com.google.ical.values.DateTimeValueImpl;import com.google.ical.values.DateValue;import com.google.ical.values.Frequency;import org.joda.time.DateTime;import org.joda.time.LocalDate;import org.joda.time.LocalTime;import java.math.BigDecimal;import java.math.BigInteger;import java.util.ArrayList;import java.util.Arrays;import java.util.Collections;import java.util.IllegalFormatConversionException;import java.util.List;import es.usc.citius.servando.calendula.R;import es.usc.citius.servando.calendula.activities.ScheduleCreationActivity;import es.usc.citius.servando.calendula.database.DB;import es.usc.citius.servando.calendula.fragments.dosePickers.DefaultDosePickerFragment;import es.usc.citius.servando.calendula.fragments.dosePickers.DosePickerFragment;import es.usc.citius.servando.calendula.fragments.dosePickers.LiquidDosePickerFragment;import es.usc.citius.servando.calendula.fragments.dosePickers.PillDosePickerFragment;import es.usc.citius.servando.calendula.persistence.Medicine;import es.usc.citius.servando.calendula.persistence.Patient;import es.usc.citius.servando.calendula.persistence.Presentation;import es.usc.citius.servando.calendula.persistence.RepetitionRule;import es.usc.citius.servando.calendula.persistence.Routine;import es.usc.citius.servando.calendula.persistence.Schedule;import es.usc.citius.servando.calendula.persistence.ScheduleItem;import es.usc.citius.servando.calendula.persistence.ScheduleItemComparator;import es.usc.citius.servando.calendula.util.LogUtil;import es.usc.citius.servando.calendula.util.ScheduleHelper;import es.usc.citius.servando.calendula.util.Snack;public class ScheduleTimetableFragment extends Fragmentimplements NumberPickerDialogFragment.NumberPickerDialogHandlerV2,RecurrencePickerDialogFragment.OnRecurrenceSetListener, RadialTimePickerDialogFragment.OnTimeSetListener {public static final int REF_DIALOG_HOURLY_INTERVAL = 1;public static final int REF_DIALOG_ROUTINE_INTERVAL = 2;public static final int REF_DIALOG_CYCLE_DAYS = 3;public static final int REF_DIALOG_CYCLE_REST = 4;private static final String TAG = ""ScheduleTimetableFragm"";final Frequency[] FREQ =new Frequency[]{Frequency.DAILY, Frequency.WEEKLY, Frequency.MONTHLY};LinearLayout timetableContainer;int timesPerDay = 1;int cycleDays = -1;int cycleRest = -1;Spinner scheduleSpinner;Spinner repeatTypeSpinner;Spinner freqSpinner;ScheduleItemComparator scheduleItemComparator = new ScheduleItemComparator();Button buttonScheduleStart;Button buttonScheduleEnd;Button intervalEditText;Button hourlyIntervalEditText;Button hourlyIntervalFrom;Button hourlyIntervalRepeatDose;Button periodValue;Button periodRest;ImageButton cycleSpinnerTrigger;//RadioGroup scheduleTypeRadioGroup;ImageButton clearStartButton;ImageButton clearEndButton;View daySelectionBox;View customRepeatBox;TextView ruleText;Schedule schedule;boolean ignoreNextEvent = true;//View boxType;View boxHourlyInterval;View boxTimesByDay;View boxTimetable;View boxRepeat;View boxPeriod;View boxDuration;View boxHelp;TextView helpView;ImageButton nextButton;ScrollView scrollView;int color;private boolean isFirstScheduleSelection = true;private int lastScheduleType = -1;private Patient patient;@Overridepublic void onCreate(Bundle savedInstanceState) {super.onCreate(savedInstanceState);// get schedule from state helper if anyschedule = ScheduleHelper.instance().getSchedule();if (schedule == null) {schedule = new Schedule();ScheduleHelper.instance().setSchedule(schedule);}}@Overridepublic View onCreateView(LayoutInflater inflater, ViewGroup container,Bundle savedInstanceState) {View rootView = inflater.inflate(R.layout.fragment_schedule_timetable, container, false);patient = DB.patients().getActive(getActivity());color = patient.getColor();scrollView = (ScrollView) rootView.findViewById(R.id.schedule_scroll);timetableContainer =(LinearLayout) rootView.findViewById(R.id.schedule_timetable_container);boxHourlyInterval = rootView.findViewById(R.id.box_hourinterval);boxTimesByDay = rootView.findViewById(R.id.box_schedule_times_by_day);boxTimetable = rootView.findViewById(R.id.box_schedule_timetable);boxRepeat = rootView.findViewById(R.id.box_schedule_repeat);boxPeriod = rootView.findViewById(R.id.box_schedule_period);boxDuration = rootView.findViewById(R.id.box_schedule_duration);boxHelp = rootView.findViewById(R.id.box_schedule_help);helpView = (TextView) rootView.findViewById(R.id.schedule_help_text);nextButton = (ImageButton) rootView.findViewById(R.id.schedule_help_button);hourlyIntervalEditText = (Button) rootView.findViewById(R.id.hourinterval_edit_text);hourlyIntervalFrom = (Button) rootView.findViewById(R.id.hourinterval_from_text);hourlyIntervalRepeatDose = (Button) rootView.findViewById(R.id.repeat_dose);scheduleSpinner = (Spinner) rootView.findViewById(R.id.schedules_spinner);buttonScheduleStart = (Button) rootView.findViewById(R.id.button_set_start);buttonScheduleEnd = (Button) rootView.findViewById(R.id.button_set_end);clearStartButton = (ImageButton) rootView.findViewById(R.id.button_clear_start);clearEndButton = (ImageButton) rootView.findViewById(R.id.button_clear_end);repeatTypeSpinner = (Spinner) rootView.findViewById(R.id.repeat_type_spinner);periodValue = (Button) rootView.findViewById(R.id.period_value);periodRest = (Button) rootView.findViewById(R.id.period_rest);freqSpinner = (Spinner) rootView.findViewById(R.id.freq_spinner);daySelectionBox = rootView.findViewById(R.id.day_selector_box);customRepeatBox = rootView.findViewById(R.id.custom_repeat_box);intervalEditText = (Button) rootView.findViewById(R.id.interval_edit_text);ruleText = (TextView) rootView.findViewById(R.id.rule_text);cycleSpinnerTrigger = (ImageButton) rootView.findViewById(R.id.cycles_spinner_trigger);setupScheduleSpinner();setupDaySelectionListeners(rootView);setupHourlyRepetitionListeners();setupStartEndDatePickers(rootView);setupForCurrentSchedule(rootView);setupCycleSpinner();setupForCurrentSchedule(rootView);updateColors(rootView);return rootView;}public void onTypeSelected() {LogUtil.d(TAG, ""onTypeSelected"");if (getView() != null) {LogUtil.d(TAG, ""getView() is not null"");setupForCurrentSchedule(getView());}}public void onViewCreated(View view, Bundle savedInstanceState) {super.onViewCreated(view, savedInstanceState);}@Overridepublic void onResume() {super.onResume();}@Overridepublic void onRecurrenceSet(String s) {EventRecurrence event = new EventRecurrence();LocalDate now = LocalDate.now();Time startDate = new Time(Time.getCurrentTimezone());startDate.set(now.getDayOfMonth(), now.getMonthOfYear(), now.getYear());startDate.normalize(true);event.parse(s);event.setStartDate(startDate);LogUtil.d(TAG, ""OnRecurrenceSet: "" + event.startDate);schedule.setRepetition(new RepetitionRule(""RRULE:"" + s));setScheduleStart(schedule.start());LocalDate end = schedule.end();LogUtil.d(TAG, ""ICAL: "" + schedule.rule().toIcal());setScheduleEnd(end);LogUtil.d(TAG, ""ICAL: "" + schedule.rule().toIcal());ruleText.setText(getCurrentSchedule());}@Overridepublic void onDialogNumberSet(int reference, BigInteger number, double decimal, boolean isNegative, BigDecimal fullNumber) {final int numberValue = number.intValue();if (reference == REF_DIALOG_ROUTINE_INTERVAL) {intervalEditText.setText(Integer.toString(numberValue));schedule.rule().setInterval(numberValue);} else if (reference == REF_DIALOG_HOURLY_INTERVAL) {hourlyIntervalEditText.setText(Integer.toString(numberValue));schedule.rule().setFrequency(Frequency.HOURLY);schedule.rule().setInterval(numberValue);} else if (reference == REF_DIALOG_CYCLE_DAYS) {periodValue.setText(String.valueOf(number));cycleDays = numberValue;if (cycleRest > 0) {schedule.setCycle(cycleDays, cycleRest);}} else if (reference == REF_DIALOG_CYCLE_REST) {periodRest.setText(String.valueOf(number));cycleRest = numberValue;if (cycleDays > 0) {schedule.setCycle(cycleDays, cycleRest);}}}@Overridepublic void onTimeSet(RadialTimePickerDialogFragment dialog, int hour, int minute) {String time = new LocalTime(hour, minute).toString(""HH:mm"");hourlyIntervalFrom.setText(getString(R.string.first_intake) + "": "" + time);schedule.setStartTime(new LocalTime(hour, minute));}void setupHourlyRepetitionListeners() {hourlyIntervalEditText.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {showHourlyPickerDIalog();}});hourlyIntervalFrom.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {DateTime time = schedule.startTime().toDateTimeToday();RadialTimePickerDialogFragment timePickerDialog =new RadialTimePickerDialogFragment().setOnTimeSetListener(ScheduleTimetableFragment.this).setStartTime(time.getHourOfDay(), time.getMinuteOfHour());timePickerDialog.show(getActivity().getSupportFragmentManager(), ""111"");}});hourlyIntervalRepeatDose.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {showHourlyDosePickerDialog();}});}void setupStartEndDatePickers(View rootView) {/** Needed to fix crashes on samsung 5.0 devices.** See: https://stackoverflow.com/q/28618405/4243049*/final ContextWrapper datePickerContext = new ContextWrapper(getActivity()) {private Resources wrappedResources;@Overridepublic Resources getResources() {Resources r = super.getResources();if(wrappedResources == null) {wrappedResources = new Resources(r.getAssets(), r.getDisplayMetrics(), r.getConfiguration()) {@NonNull@Overridepublic String getString(int id, Object... formatArgs) throws NotFoundException {try {return super.getString(id, formatArgs);} catch (IllegalFormatConversionException e) {Log.w(TAG, ""Trying to fix resource exception"", e);String template = super.getString(id);template = template.replaceAll(""%"" + e.getConversion(), ""%s"");return String.format(getConfiguration().locale, template, formatArgs);}}};}return wrappedResources;}};if (schedule.start() == null) {schedule.setStart(LocalDate.now());}final LocalDate scheduleStart = schedule.start();buttonScheduleStart.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {DatePickerDialog dpd =new DatePickerDialog(datePickerContext, new DatePickerDialog.OnDateSetListener() {@Overridepublic void onDateSet(DatePicker view, int year, int monthOfYear,int dayOfMonth) {LogUtil.d(TAG, year + "" "" + monthOfYear);LocalDate d = new LocalDate(year, monthOfYear + 1, dayOfMonth);setScheduleStart(d);}}, scheduleStart.getYear(), scheduleStart.getMonthOfYear() - 1,scheduleStart.getDayOfMonth());dpd.show();}});buttonScheduleEnd.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {LocalDate scheduleEnd =schedule.end() != null ? schedule.end() : scheduleStart.plusMonths(3);DatePickerDialog dpd =new DatePickerDialog(datePickerContext, new DatePickerDialog.OnDateSetListener() {@Overridepublic void onDateSet(DatePicker view, int year, int monthOfYear,int dayOfMonth) {LocalDate d = new LocalDate(year, monthOfYear + 1, dayOfMonth);setScheduleEnd(d);}}, scheduleEnd.getYear(), scheduleEnd.getMonthOfYear() - 1,scheduleEnd.getDayOfMonth());dpd.show();}});buttonScheduleEnd.setOnLongClickListener(new View.OnLongClickListener() {@Overridepublic boolean onLongClick(View v) {AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());builder.setMessage(R.string.schedule_continue_indefinitely).setCancelable(true).setPositiveButton(getString(R.string.dialog_yes_option),new DialogInterface.OnClickListener() {public void onClick(DialogInterface dialog, int id) {setScheduleEnd(null);}}).setNegativeButton(getString(R.string.dialog_no_option),new DialogInterface.OnClickListener() {public void onClick(DialogInterface dialog, int id) {dialog.cancel();}});AlertDialog alert = builder.create();alert.show();return true;}});clearStartButton.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {setScheduleStart(null);}});clearEndButton.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {setScheduleEnd(null);}});setScheduleStart(schedule.start());setScheduleEnd(schedule.end());}void onScheduleSelected(String selection, int index) {ScheduleHelper.instance().setSelectedScheduleIdx(index);String schedules[] = getResources().getStringArray(R.array.schedules_array);// obtain times per day from selected schedulefor (int i = 0; i < schedules.length; i++) {if (schedules[i].equalsIgnoreCase(selection)) {timesPerDay = i + 1;ScheduleHelper.instance().setTimesPerDay(timesPerDay);break;}}addTimetableEntries(timesPerDay, DB.routines().findAllForActivePatient(getContext()));}void setupDaySelectionListeners(final View rootView) {View.OnClickListener listener = new View.OnClickListener() {@Overridepublic void onClick(View view) {TextView text = ((TextView) view);int index;switch (text.getId()) {case R.id.day_mo:schedule.toggleSelectedDay(0);index = 0;break;case R.id.day_tu:schedule.toggleSelectedDay(1);index = 1;break;case R.id.day_we:schedule.toggleSelectedDay(2);index = 2;break;case R.id.day_th:index = 3;schedule.toggleSelectedDay(3);break;case R.id.day_fr:schedule.toggleSelectedDay(4);index = 4;break;case R.id.day_sa:schedule.toggleSelectedDay(5);index = 5;break;case R.id.day_su:schedule.toggleSelectedDay(6);index = 6;break;default:return;}boolean daySelected = schedule.days()[index];StateListDrawable sld = (StateListDrawable) text.getBackground();GradientDrawable shape = (GradientDrawable) sld.getCurrent();shape.setColor(daySelected ? color : Color.WHITE);text.setTypeface(null, daySelected ? Typeface.BOLD : Typeface.NORMAL);text.setTextColor(daySelected ? Color.WHITE : Color.BLACK);boolean allDaysSelected = schedule.allDaysSelected();if (schedule.type() == Schedule.SCHEDULE_TYPE_EVERYDAY && !allDaysSelected) {setRepeatType(Schedule.SCHEDULE_TYPE_SOMEDAYS, rootView, false);ignoreNextEvent = true;repeatTypeSpinner.setSelection(1);} else if (schedule.type() == Schedule.SCHEDULE_TYPE_SOMEDAYS && allDaysSelected) {repeatTypeSpinner.setSelection(0);schedule.setType(Schedule.SCHEDULE_TYPE_EVERYDAY);}LogUtil.d(TAG, ""All days selected: "" + allDaysSelected + "", repeatType: "" + schedule.type());}};rootView.findViewById(R.id.day_mo).setOnClickListener(listener);rootView.findViewById(R.id.day_tu).setOnClickListener(listener);rootView.findViewById(R.id.day_we).setOnClickListener(listener);rootView.findViewById(R.id.day_th).setOnClickListener(listener);rootView.findViewById(R.id.day_fr).setOnClickListener(listener);rootView.findViewById(R.id.day_sa).setOnClickListener(listener);rootView.findViewById(R.id.day_su).setOnClickListener(listener);}void showIntervalPickerDIalog() {NumberPickerBuilder npb =new NumberPickerBuilder().setDecimalVisibility(NumberPicker.INVISIBLE).setMinNumber(BigDecimal.ONE).setMaxNumber(BigDecimal.valueOf(31)).setPlusMinusVisibility(NumberPicker.INVISIBLE).setFragmentManager(getActivity().getSupportFragmentManager()).setTargetFragment(this).setReference(REF_DIALOG_ROUTINE_INTERVAL).setStyleResId(R.style.BetterPickersDialogFragment_Calendula);npb.show();}void showHourlyPickerDIalog() {/*NumberPickerBuilder npb =new NumberPickerBuilder().setDecimalVisibility(NumberPicker.INVISIBLE).setMinNumber(1).setMaxNumber(24).setPlusMinusVisibility(NumberPicker.INVISIBLE).setFragmentManager(getActivity().getSupportFragmentManager()).setTargetFragment(this).setReference(REF_DIALOG_HOURLY_INTERVAL).setStyleResId(R.style.BetterPickersDialogFragment_Calendula);npb.show();*/AlertDialog.Builder b = new AlertDialog.Builder(getActivity());b.setTitle(getString(R.string.dialog_interval_title));final String[] types = {""2"", ""3"", ""4"", ""6"", ""8"", ""12""};b.setItems(types, new DialogInterface.OnClickListener() {@Overridepublic void onClick(DialogInterface dialog, int which) {dialog.dismiss();int result = Integer.valueOf(types[which]);hourlyIntervalEditText.setText("""" + result);schedule.rule().setFrequency(Frequency.HOURLY);schedule.rule().setInterval(result);}});b.show();}void showRecurrencePickerDialog() {RecurrencePickerDialogFragment dialog = new RecurrencePickerDialogFragment();DateTime start = schedule.start() != null ? schedule.start().toDateTimeAtStartOfDay(): DateTime.now().withTimeAtStartOfDay();Bundle b = new Bundle();b.putString(RecurrencePickerDialogFragment.BUNDLE_RRULE,schedule.rule().toIcal().replace(""RRULE:"", """"));b.putLong(RecurrencePickerDialogFragment.BUNDLE_START_TIME_MILLIS, DateTime.now().getMillis());//b.putString(RecurrencePickerDialog.BUNDLE_TIME_ZONE, t.timezone);dialog.setArguments(b);dialog.setOnRecurrenceSetListener(this);dialog.show(getActivity().getSupportFragmentManager(), ""REC"");}void addTimetableEntries(int timesPerDay, List<Routine> routines) {Collections.sort(ScheduleHelper.instance().getScheduleItems(), scheduleItemComparator);LinearLayout.LayoutParams params =new LinearLayout.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT,LinearLayout.LayoutParams.WRAP_CONTENT);String[] routineNames = getUpdatedRoutineNames();timetableContainer.removeAllViews();List<ScheduleItem> scheduleItems = new ArrayList<>();boolean enableDelete = timesPerDay > 1;for (int i = 0; i < timesPerDay; i++) {// try to get previous routine from state holderScheduleItem s;if (i < ScheduleHelper.instance().getScheduleItems().size()) {ScheduleItem toCopy = ScheduleHelper.instance().getScheduleItems().get(i);s = new ScheduleItem(null, toCopy.getRoutine(), toCopy.getDose());} else {s = new ScheduleItem(null, (i < routines.size()) ? routines.get(i) : null, 1);}if (s != null) {scheduleItems.add(s);}View view = buildTimetableEntry(s, routineNames, enableDelete);timetableContainer.addView(view, params);}ScheduleHelper.instance().setScheduleItems(scheduleItems);//        for (ScheduleItem i : ScheduleCreationHelper.instance().getScheduleItems())//            LogUtil.d(TAG, ""addTimetableEntries (end): "" + i.getId() + "", "" + i.routine().name() + "", "" + i.dose());}String[] getUpdatedRoutineNames() {List<Routine> routines = DB.routines().findAllForActivePatient(getContext());int j = 0;String[] routineNames = new String[routines.size() + 1];for (Routine r : routines) {routineNames[j++] = r.getName();}routineNames[routineNames.length - 1] = getString(R.string.create_new_routine);return routineNames;}View buildTimetableEntry(ScheduleItem r, String[] routineNames, boolean enableDelete) {LayoutInflater inflater = getActivity().getLayoutInflater();final View entry = inflater.inflate(R.layout.schedule_timetable_entry, null);updateEntryTime(r.getRoutine(), entry);setupScheduleEntrySpinners(entry, r, routineNames);if (enableDelete) {entry.findViewById(R.id.entry_remove).setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View view) {ScheduleHelper.instance().getScheduleItems().remove(timetableContainer.indexOfChild(entry));scheduleSpinner.setSelection(timesPerDay - 2);}});} else {entry.findViewById(R.id.entry_remove).setVisibility(View.INVISIBLE);}return entry;}void updateRoutineSelectionAdapter(final View entryView, Spinner routineSpinner,String[] routineNames) {ArrayAdapter<String> routineAdapter =new ArrayAdapter<>(getActivity(), android.R.layout.simple_spinner_item,routineNames);routineAdapter.setDropDownViewResource(R.layout.spinner_dropdown_item);routineSpinner.setAdapter(routineAdapter);}void updateEntryTime(Routine r, View entry) {String hourText;String minuteText;if (r != null) {hourText = (r.getTime().getHourOfDay() < 10 ? ""0"" + r.getTime().getHourOfDay(): r.getTime().getHourOfDay()) + "":"";minuteText = (r.getTime().getMinuteOfHour() < 10 ? ""0"" + r.getTime().getMinuteOfHour(): r.getTime().getMinuteOfHour()) + """";} else {hourText = ""--:"";minuteText = ""--"";}TextView h = ((TextView) entry.findViewById(R.id.hour_text));TextView m = ((TextView) entry.findViewById(R.id.minute_text));h.setText(hourText);m.setText(minuteText);h.setTextColor(color);m.setTextColor(color);}void showAddNewRoutineDialog(final View entryView) {FragmentManager fm = getActivity().getSupportFragmentManager();final RoutineCreateOrEditFragment addRoutineFragment = new RoutineCreateOrEditFragment();addRoutineFragment.setOnRoutineEditListener(new RoutineCreateOrEditFragment.OnRoutineEditListener() {@Overridepublic void onRoutineEdited(Routine r) {// do nothing}@Overridepublic void onRoutineDeleted(Routine r) {// do nothing}@Overridepublic void onRoutineCreated(final Routine r) {Spinner rSpinner = (Spinner) entryView.findViewById(R.id.entry_routine_spinner);String names[] = getUpdatedRoutineNames();updateRoutineSelectionAdapter(entryView, rSpinner, names);LogUtil.d(TAG, ""Routine name: "" + r.getName());LogUtil.d(TAG, ""Routine time: "" + r.getTime().toString(""hh:mm""));LogUtil.d(TAG, ""Names: "" + Arrays.toString(names));int selection = Arrays.asList(names).indexOf(r.getName());rSpinner.setSelection(selection);updateEntryTime(r, entryView);addRoutineFragment.dismiss();}});addRoutineFragment.show(fm, ""fragment_edit_name"");}void showDosePickerDialog(final ScheduleItem item, final TextView tv) {Medicine med = ScheduleHelper.instance().getSelectedMed();if (med == null) {((ScheduleCreationActivity) getActivity()).onDoseSelectedWithNoMed();return;}final DosePickerFragment dpf = getDosePickerFragment(med, item, null);if (dpf != null) {FragmentManager fm = getActivity().getSupportFragmentManager();dpf.setOnDoseSelectedListener(new LiquidDosePickerFragment.OnDoseSelectedListener() {@Overridepublic void onDoseSelected(double dose) {LogUtil.d(TAG, ""Set dose ""+ dose+ "" to item ""+ item.getRoutine().getName()+ "", ""+ item.getId());item.setDose((float) dose);tv.setText(item.displayDose());logScheduleItems();}});dpf.show(fm, ""fragment_select_dose"");}}void showHourlyDosePickerDialog() {Medicine med = ScheduleHelper.instance().getSelectedMed();if (med == null) {Snack.showIfUnobstructed(R.string.create_schedule_select_med_before_dose, getActivity());return;}final DosePickerFragment dpf = getDosePickerFragment(med, null, schedule);if (dpf != null) {FragmentManager fm = getActivity().getSupportFragmentManager();dpf.setOnDoseSelectedListener(new LiquidDosePickerFragment.OnDoseSelectedListener() {@Overridepublic void onDoseSelected(double dose) {schedule.setDose((float) dose);hourlyIntervalRepeatDose.setText(schedule.displayDose());}});dpf.show(fm, ""fragment_select_dose"");} else {}}void checkSelectedDays(View rootView, boolean[] days) {LogUtil.d(TAG, ""Checking selected days: "" + Arrays.toString(days));schedule.setDays(days);TextView mo = ((TextView) rootView.findViewById(R.id.day_mo));TextView tu = ((TextView) rootView.findViewById(R.id.day_tu));TextView we = ((TextView) rootView.findViewById(R.id.day_we));TextView th = ((TextView) rootView.findViewById(R.id.day_th));TextView fr = ((TextView) rootView.findViewById(R.id.day_fr));TextView sa = ((TextView) rootView.findViewById(R.id.day_sa));TextView su = ((TextView) rootView.findViewById(R.id.day_su));TextView[] daysTvs = new TextView[]{mo, tu, we, th, fr, sa, su};for (int i = 0; i < daysTvs.length; i++) {boolean isSelected = days[i];StateListDrawable sld = (StateListDrawable) daysTvs[i].getBackground();GradientDrawable shape = (GradientDrawable) sld.getCurrent();shape.setColor(isSelected ? color : Color.WHITE);daysTvs[i].setTypeface(null, isSelected ? Typeface.BOLD : Typeface.NORMAL);daysTvs[i].setTextColor(isSelected ? Color.WHITE : Color.BLACK);}}void setScheduleStart(LocalDate start) {schedule.setStart(start);if (start == null) {buttonScheduleStart.setText(getString(R.string.button_schedule_repeat_today));clearStartButton.setVisibility(View.INVISIBLE);} else {buttonScheduleStart.setText(start.toString(getString(R.string.schedule_limits_date_format)));clearStartButton.setVisibility(View.VISIBLE);}}void setScheduleEnd(LocalDate end) {if (end == null) {buttonScheduleEnd.setText(getString(R.string.never));schedule.rule().getRRule().setUntil(null);clearEndButton.setVisibility(View.INVISIBLE);} else {DateValue v =new DateTimeValueImpl(end.getYear(), end.getMonthOfYear(), end.getDayOfMonth(), 0,0, 0);schedule.rule().getRRule().setUntil(v);buttonScheduleEnd.setText(end.toString(getString(R.string.schedule_limits_date_format)));clearEndButton.setVisibility(View.VISIBLE);}}private void updateColors(View rootView) {int color = DB.patients().getActive(getActivity()).getColor();((TextView) rootView.findViewById(R.id.textView3)).setTextColor(color);((TextView) rootView.findViewById(R.id.textView2)).setTextColor(color);(rootView.findViewById(R.id.imageView)).setBackgroundColor(color);(rootView.findViewById(R.id.imageView1)).setBackgroundColor(color);StateListDrawable sld = (StateListDrawable) rootView.findViewById(R.id.text_container).getBackground();GradientDrawable shape = (GradientDrawable) sld.getCurrent();shape.setColor(Color.parseColor(""#ececec""));hourlyIntervalEditText.setTextColor(color);hourlyIntervalFrom.setTextColor(color);hourlyIntervalRepeatDose.setTextColor(color);buttonScheduleStart.setTextColor(color);buttonScheduleEnd.setTextColor(color);periodValue.setTextColor(color);periodRest.setTextColor(color);}private void setupCycleSpinner() {final String[] cycles = getResources().getStringArray(R.array.schedule_cycles);cycleSpinnerTrigger.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {AlertDialog.Builder b = new AlertDialog.Builder(getActivity());b.setTitle(R.string.schedule_type_common_periods);b.setItems(cycles, new DialogInterface.OnClickListener() {@Overridepublic void onClick(DialogInterface dialog, int which) {dialog.dismiss();String c = cycles[which];String[] parts = c.replaceAll("" "", """").split(""\\+"");periodValue.setText(parts[0]);periodRest.setText(parts[1]);schedule.setCycle(Integer.valueOf(parts[0]), Integer.valueOf(parts[1]));}});b.show();}});}private void setupForCurrentSchedule(View rootView) {if (schedule.getId() != null) {setupForKnownSchedule(rootView);} else {setupForNewSchedule(rootView);}}private void updateHourlyIntervalBox() {LocalTime t = schedule.startTime();if (t == null) {t = LocalTime.now().withMinuteOfHour(0);schedule.setStartTime(t);}String time = new LocalTime(t.getHourOfDay(), t.getMinuteOfHour()).toString(""HH:mm"");hourlyIntervalFrom.setText(getString(R.string.first_intake) + "": "" + time);if (schedule.rule().getInterval() < 1) {schedule.rule().setInterval(8);}schedule.rule().setFrequency(Frequency.HOURLY);hourlyIntervalEditText.setText(String.valueOf(schedule.rule().getInterval()));hourlyIntervalRepeatDose.setText(schedule.displayDose());}private void setupForKnownSchedule(View rootView) {int type = ScheduleHelper.instance().getScheduleType();LogUtil.d(TAG, ""Setup for known schedule:  "" + type);boxTimesByDay.setVisibility(View.GONE);boxTimetable.setVisibility(View.GONE);boxRepeat.setVisibility(View.GONE);boxHourlyInterval.setVisibility(View.GONE);boxHelp.setVisibility(View.GONE);boxPeriod.setVisibility(View.GONE);boxDuration.setVisibility(View.VISIBLE);if (type == ScheduleTypeFragment.TYPE_ROUTINES) {boxTimesByDay.setVisibility(View.VISIBLE);boxTimetable.setVisibility(View.VISIBLE);boxRepeat.setVisibility(View.VISIBLE);timesPerDay = ScheduleHelper.instance().getTimesPerDay();scheduleSpinner.setSelection(ScheduleHelper.instance().getSelectedScheduleIdx());checkSelectedDays(rootView, schedule.days());setupRepetitions(rootView);updateRepeatTypeAndInterval(rootView);} else if (type == ScheduleTypeFragment.TYPE_HOURLY) {schedule.rule().setDays(Schedule.noWeekDays());boxHourlyInterval.setVisibility(View.VISIBLE);updateHourlyIntervalBox();} else {boxTimesByDay.setVisibility(View.VISIBLE);boxTimetable.setVisibility(View.VISIBLE);boxPeriod.setVisibility(View.VISIBLE);updatePeriodSelector();}boxHelp.setVisibility(View.GONE);}private void setupForNewSchedule(View rootView) {int type = ScheduleHelper.instance().getScheduleType();LogUtil.d(TAG, ""Setup for new schedule:  "" + type);boxTimesByDay.setVisibility(View.GONE);boxTimetable.setVisibility(View.GONE);boxRepeat.setVisibility(View.GONE);boxDuration.setVisibility(View.GONE);boxPeriod.setVisibility(View.GONE);boxHourlyInterval.setVisibility(View.GONE);boxHelp.setVisibility(View.VISIBLE);if (type == ScheduleTypeFragment.TYPE_ROUTINES) {boxTimesByDay.setVisibility(View.VISIBLE);timesPerDay = ScheduleHelper.instance().getTimesPerDay();scheduleSpinner.setSelection(ScheduleHelper.instance().getSelectedScheduleIdx());checkSelectedDays(rootView, schedule.days());setupRepetitions(rootView);updateRepeatTypeAndInterval(rootView);helpView.setText(getString(R.string.schedule_help_timesbyday));} else if (type == ScheduleTypeFragment.TYPE_HOURLY) {schedule.setType(Schedule.SCHEDULE_TYPE_HOURLY);boxHourlyInterval.setVisibility(View.VISIBLE);schedule.setDays(Schedule.noWeekDays());updateHourlyIntervalBox();helpView.setText(getString(R.string.schedule_help_hourly));} else {schedule.setType(Schedule.SCHEDULE_TYPE_CYCLE);boxTimesByDay.setVisibility(View.VISIBLE);timesPerDay = ScheduleHelper.instance().getTimesPerDay();scheduleSpinner.setSelection(ScheduleHelper.instance().getSelectedScheduleIdx());helpView.setText(getString(R.string.schedule_help_timesbyday));updatePeriodSelector();}nextButton.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {showNext();}});}private void updatePeriodSelector() {periodValue.setText(String.valueOf(schedule.getCycleDays()));periodRest.setText(String.valueOf(schedule.getCycleRest()));periodValue.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {NumberPickerBuilder npb =new NumberPickerBuilder().setDecimalVisibility(NumberPicker.INVISIBLE).setMinNumber(BigDecimal.ONE).setMaxNumber(BigDecimal.valueOf(100D)).setPlusMinusVisibility(NumberPicker.INVISIBLE).setFragmentManager(getActivity().getSupportFragmentManager()).setTargetFragment(ScheduleTimetableFragment.this).setReference(REF_DIALOG_CYCLE_DAYS).setStyleResId(R.style.BetterPickersDialogFragment_Calendula);npb.show();}});periodRest.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {NumberPickerBuilder npb =new NumberPickerBuilder().setDecimalVisibility(NumberPicker.INVISIBLE).setMinNumber(BigDecimal.ONE).setMaxNumber(BigDecimal.valueOf(100D)).setPlusMinusVisibility(NumberPicker.INVISIBLE).setFragmentManager(getActivity().getSupportFragmentManager()).setTargetFragment(ScheduleTimetableFragment.this).setReference(REF_DIALOG_CYCLE_REST).setStyleResId(R.style.BetterPickersDialogFragment_Calendula);npb.show();}});}private void updateRepeatTypeAndInterval(View rootView) {int repeatType = schedule.type();setRepeatType(repeatType, rootView, true);repeatTypeSpinner.setSelection(repeatType);intervalEditText.setText(String.valueOf(schedule.rule().getInterval()));}private void showNext() {int type = ScheduleHelper.instance().getScheduleType();if (type == ScheduleTypeFragment.TYPE_ROUTINES) {if (boxTimesByDay.getVisibility() != View.VISIBLE) {helpView.setText(getString(R.string.schedule_help_timesbyday));boxTimesByDay.setVisibility(View.VISIBLE);boxHourlyInterval.setVisibility(View.INVISIBLE);} else if (boxTimetable.getVisibility() != View.VISIBLE) {helpView.setText(getString(R.string.schedule_help_timetable));showBox(boxTimetable);} else if (boxRepeat.getVisibility() != View.VISIBLE) {helpView.setText(getString(R.string.schedule_help_repeat));showBox(boxRepeat);} else if (boxDuration.getVisibility() != View.VISIBLE) {helpView.setText(getString(R.string.schedule_help_duration));showBox(boxDuration);nextButton.setVisibility(View.GONE);}} else if (type == ScheduleTypeFragment.TYPE_HOURLY) {if (boxHourlyInterval.getVisibility() != View.VISIBLE) {boxHourlyInterval.setVisibility(View.VISIBLE);boxTimesByDay.setVisibility(View.INVISIBLE);helpView.setText(getString(R.string.schedule_help_hourly));} else if (boxDuration.getVisibility() != View.VISIBLE) {helpView.setText(getString(R.string.schedule_help_duration));showBox(boxDuration);nextButton.setVisibility(View.GONE);}} else if (type == ScheduleTypeFragment.TYPE_PERIOD) {if (boxTimesByDay.getVisibility() != View.VISIBLE) {helpView.setText(getString(R.string.schedule_help_timesbyday));boxTimesByDay.setVisibility(View.VISIBLE);boxHourlyInterval.setVisibility(View.INVISIBLE);} else if (boxTimetable.getVisibility() != View.VISIBLE) {helpView.setText(getString(R.string.schedule_help_timetable));showBox(boxTimetable);} else if (boxPeriod.getVisibility() != View.VISIBLE) {helpView.setText(getString(R.string.schedule_help_cycle));showBox(boxPeriod);} else if (boxDuration.getVisibility() != View.VISIBLE) {helpView.setText(getString(R.string.schedule_help_duration));showBox(boxDuration);nextButton.setVisibility(View.GONE);}}}private void showBox(final View v) {v.setVisibility(View.VISIBLE);Animation a = AnimationUtils.loadAnimation(getActivity(), R.anim.anim_scheule_box_slide_up);scrollView.postDelayed(new Runnable() {@Overridepublic void run() {scrollView.smoothScrollBy(0, 1000); // ensure scroll bottom}}, 200);a.setAnimationListener(new Animation.AnimationListener() {@Overridepublic void onAnimationStart(Animation animation) {}@Overridepublic void onAnimationEnd(Animation animation) {}@Overridepublic void onAnimationRepeat(Animation animation) {}});v.startAnimation(a);}private void setupRepetitions(final View rooView) {ruleText.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {showRecurrencePickerDialog();}});repeatTypeSpinner.setAdapter(new ArrayAdapter<>(getActivity(), R.layout.support_simple_spinner_dropdown_item,getResources().getStringArray(R.array.schedule_repeat_types)));repeatTypeSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {@Overridepublic void onItemSelected(AdapterView<?> parent, View view, int position, long id) {setRepeatType(position, rooView, !ignoreNextEvent);ignoreNextEvent = false;}@Overridepublic void onNothingSelected(AdapterView<?> parent) {}});freqSpinner.setAdapter(new ArrayAdapter<>(getActivity(), R.layout.support_simple_spinner_dropdown_item,getResources().getStringArray(R.array.schedule_repeat_frequency_units)));freqSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {@Overridepublic void onItemSelected(AdapterView<?> parent, View view, int position, long id) {setFrequency(position, rooView);}@Overridepublic void onNothingSelected(AdapterView<?> parent) {}});intervalEditText.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {showIntervalPickerDIalog();}});}private void setFrequency(int freq, View rootView) {if (ScheduleHelper.instance().getScheduleType() == ScheduleTypeFragment.TYPE_ROUTINES) {Frequency frequency = FREQ[freq];schedule.rule().setFrequency(frequency);if (frequency == Frequency.WEEKLY) {int dayCount = schedule.dayCount();if (dayCount == 0 || dayCount == 7) {checkToday(rootView);}daySelectionBox.setVisibility(View.VISIBLE);} else {schedule.rule().setDays(null);daySelectionBox.setVisibility(View.GONE);}}}private void setRepeatType(int type, View v, boolean updateUi) {if (ScheduleHelper.instance().getScheduleType() == ScheduleTypeFragment.TYPE_ROUTINES) {schedule.setType(type);if (updateUi) {//resetRule();if (type == Schedule.SCHEDULE_TYPE_EVERYDAY) {daySelectionBox.setVisibility(View.VISIBLE);customRepeatBox.setVisibility(View.GONE);ruleText.setVisibility(View.GONE);schedule.rule().setInterval(0);schedule.rule().setFrequency(Frequency.DAILY);checkAllDays(v);} else if (type == Schedule.SCHEDULE_TYPE_SOMEDAYS) {daySelectionBox.setVisibility(View.VISIBLE);customRepeatBox.setVisibility(View.GONE);ruleText.setVisibility(View.GONE);// Intervalschedule.rule().setInterval(0);// frequencyschedule.rule().setFrequency(Frequency.DAILY);// bydayif (schedule.dayCount() == 7 || schedule.dayCount() == 0) {checkToday(v);} else {checkSelectedDays(v, schedule.days());}} else if (type == Schedule.SCHEDULE_TYPE_INTERVAL) {ruleText.setVisibility(View.GONE);customRepeatBox.setVisibility(View.VISIBLE);int interval = schedule.rule().getInterval();if (interval < 2) {interval = 2;}schedule.rule().setInterval(interval);intervalEditText.setText(String.valueOf(schedule.rule().getInterval()));Frequency f = schedule.rule().getFrequency();if (f.equals(Frequency.WEEKLY)) {freqSpinner.setSelection(1);setFrequency(1, v);} else if (f.equals(Frequency.MONTHLY)) {freqSpinner.setSelection(2);setFrequency(2, v);} else {freqSpinner.setSelection(0);setFrequency(0, v);}}}}}private Spanned getCurrentSchedule() {String text =getString(R.string.schedule_custom_rule_text, schedule.toReadableString(getActivity()));int count = schedule.rule().getRRule().getCount();if (count > 0) {text += ""<br><u>"" + getString(R.string.schedules_stop_after, count) + ""</u>"";}return Html.fromHtml(text);}private void checkAllDays(View v) {checkSelectedDays(v, Schedule.allWeekDays());}private void checkToday(View v) {boolean[] days = Schedule.noWeekDays();days[LocalDate.now().getDayOfWeek() - 1] = true;checkSelectedDays(v, days);}private void setupScheduleSpinner() {// Create an ArrayAdapter using the string array and a default spinner layoutArrayAdapter<CharSequence> adapter =ArrayAdapter.createFromResource(getActivity(), R.array.schedules_array,R.layout.spinner_text_item);// Specify the layout to use when the list of choices appearsadapter.setDropDownViewResource(R.layout.spinner_dropdown_item);// Apply the adapter to the spinnerscheduleSpinner.setAdapter(adapter);scheduleSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {@Overridepublic void onItemSelected(AdapterView<?> adapterView, View view, int i, long l) {String selected = (String) adapterView.getItemAtPosition(i);onScheduleSelected(selected, i);}@Overridepublic void onNothingSelected(AdapterView<?> adapterView) {}});}private void setupScheduleEntrySpinners(final View entryView, ScheduleItem scheduleItem,String[] routineNames) {final Spinner routineSpinner = (Spinner) entryView.findViewById(R.id.entry_routine_spinner);final TextView doseTv = (TextView) entryView.findViewById(R.id.entry_dose_textview);//        final Spinner doseSpinner = (Spinner) entryView.findViewById(R.id.entry_dose_spinner);doseTv.setTag(scheduleItem);routineSpinner.setTag(scheduleItem);// set up the routine selection adapterupdateRoutineSelectionAdapter(entryView, routineSpinner, routineNames);if (scheduleItem != null && scheduleItem.getRoutine() != null) {String routineName = scheduleItem.getRoutine().getName();int index = Arrays.asList(routineNames).indexOf(routineName);routineSpinner.setSelection(index);} else {routineSpinner.setSelection(routineNames.length - 1);}doseTv.setOnClickListener(new View.OnClickListener() {@Overridepublic void onClick(View v) {showDosePickerDialog((ScheduleItem) v.getTag(), (TextView) v);}});// set up the dose selection adapter//        ArrayAdapter<String> doseAdapter = new ArrayAdapter<String>(getActivity(), android.R.layout.simple_spinner_item, doses);//        doseAdapter.setDropDownViewResource(R.layout.spinner_dropdown_item);//        doseSpinner.setAdapter(doseAdapter);// select 1 pill by default//        doseSpinner.setSelection((int) scheduleItem.dose() - 1); // dose ""1"" is located at the index ""0"", and so ondoseTv.setText(scheduleItem.displayDose());// setup listenersroutineSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {@Overridepublic void onItemSelected(AdapterView<?> adapterView, View view, int i, long l) {String selected = (String) adapterView.getItemAtPosition(i);Routine r = DB.routines().findByPatientAndName(selected, patient);ScheduleItem item = ((ScheduleItem) routineSpinner.getTag());if (r != null) {updateEntryTime(r, entryView);} else {updateEntryTime(null, entryView);showAddNewRoutineDialog(entryView);}LogUtil.d(TAG, ""Updated routine to ""+ (r != null ? r.getName() : ""NULL"")+ "" on item ""+ item.getId());item.setRoutine(r);logScheduleItems();}@Overridepublic void onNothingSelected(AdapterView<?> adapterView) {}});routineSpinner.setOnTouchListener(new View.OnTouchListener() {@Overridepublic boolean onTouch(View view, MotionEvent motionEvent) {if (motionEvent.getAction() == MotionEvent.ACTION_UP) {if (((String) routineSpinner.getSelectedItem()).equalsIgnoreCase(getString(R.string.create_new_routine))) {showAddNewRoutineDialog(entryView);return true;}}return false;}});}private void logScheduleItems() {for (ScheduleItem si : ScheduleHelper.instance().getScheduleItems()) {LogUtil.d(TAG, (si.getRoutine() != null ? si.getRoutine().getName() : ""NONE"")+ "", ""+ si.getDose()+ "" ****************************"");}}private DosePickerFragment getDosePickerFragment(Medicine med, ScheduleItem item, Schedule s) {DosePickerFragment dpf = null;Bundle arguments = new Bundle();//        if (med.presentation().equals(Presentation.SYRUP)) {//            dpf = new LiquidDosePickerFragment();//        }if (med.getPresentation().equals(Presentation.PILLS)) {dpf = new PillDosePickerFragment();} else {dpf = new DefaultDosePickerFragment();arguments.putSerializable(""presentation"", med.getPresentation());}if (item != null) {arguments.putDouble(""dose"", item.getDose());} else if (s != null) {arguments.putDouble(""dose"", s.dose());}dpf.setArguments(arguments);return dpf;}}",Calendula/src/main/java/es/usc/citius/servando/calendula/fragments/ScheduleTimetableFragment.java
209,"/** Copyright (c) 2015 Ngewi Fet <ngewif@gmail.com>** Licensed under the Apache License, Version 2.0 (the ""License"");* you may not use this file except in compliance with the License.* You may obtain a copy of the License at**     http://www.apache.org/licenses/LICENSE-2.0** Unless required by applicable law or agreed to in writing, software* distributed under the License is distributed on an ""AS IS"" BASIS,* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.* See the License for the specific language governing permissions and* limitations under the License.*/package org.gnucash.android.ui.util.widget;import android.content.Context;import android.content.res.TypedArray;import android.inputmethodservice.KeyboardView;import android.os.Build;import android.support.annotation.Nullable;import android.support.annotation.XmlRes;import android.support.v7.widget.AppCompatEditText;import android.text.Editable;import android.text.InputType;import android.text.TextWatcher;import android.util.AttributeSet;import android.util.Log;import android.view.MotionEvent;import android.view.View;import com.crashlytics.android.Crashlytics;import net.objecthunter.exp4j.Expression;import net.objecthunter.exp4j.ExpressionBuilder;import org.gnucash.android.R;import org.gnucash.android.model.Commodity;import org.gnucash.android.ui.common.FormActivity;import org.gnucash.android.util.AmountParser;import java.math.BigDecimal;import java.text.DecimalFormat;import java.text.NumberFormat;import java.text.ParseException;import java.util.Locale;/*** A custom EditText which supports computations and uses a custom calculator keyboard.* <p>After the view is inflated, make sure to call {@link #bindListeners(KeyboardView)}* with the view from your layout where the calculator keyboard should be displayed.</p>* @author Ngewi Fet <ngewif@gmail.com>*/public class CalculatorEditText extends AppCompatEditText {private CalculatorKeyboard mCalculatorKeyboard;private Commodity mCommodity = Commodity.DEFAULT_COMMODITY;private Context mContext;/*** Flag which is set if the contents of this view have been modified*/private boolean isContentModified = false;private int mCalculatorKeysLayout;private KeyboardView mCalculatorKeyboardView;public CalculatorEditText(Context context) {super(context);this.mContext = context;}public CalculatorEditText(Context context, AttributeSet attrs) {super(context, attrs);init(context, attrs);}public CalculatorEditText(Context context, AttributeSet attrs, int defStyleAttr) {super(context, attrs, defStyleAttr);init(context, attrs);}/*** Overloaded constructor* Reads any attributes which are specified in XML and applies them* @param context Activity context* @param attrs View attributes*/private void init(Context context, AttributeSet attrs){this.mContext = context;TypedArray a = context.getTheme().obtainStyledAttributes(attrs,R.styleable.CalculatorEditText,0, 0);try {mCalculatorKeysLayout = a.getResourceId(R.styleable.CalculatorEditText_keyboardKeysLayout, R.xml.calculator_keyboard);} finally {a.recycle();}addTextChangedListener(new TextWatcher() {@Overridepublic void beforeTextChanged(CharSequence s, int start, int count, int after) {}@Overridepublic void onTextChanged(CharSequence s, int start, int before, int count) {}@Overridepublic void afterTextChanged(Editable s) {isContentModified = true;}});}public void bindListeners(CalculatorKeyboard calculatorKeyboard){mCalculatorKeyboard = calculatorKeyboard;mContext = calculatorKeyboard.getContext();setOnFocusChangeListener(new OnFocusChangeListener() {@Overridepublic void onFocusChange(View v, boolean hasFocus) {if (hasFocus) {setSelection(getText().length());mCalculatorKeyboard.showCustomKeyboard(v);} else {mCalculatorKeyboard.hideCustomKeyboard();evaluate();}}});setOnClickListener(new OnClickListener() {// NOTE By setting the on click listener we can show the custom keyboard again,// by tapping on an edit box that already had focus (but that had the keyboard hidden).@Overridepublic void onClick(View v) {mCalculatorKeyboard.showCustomKeyboard(v);}});// Disable spell check (hex strings look like words to Android)setInputType(getInputType() | InputType.TYPE_TEXT_FLAG_NO_SUGGESTIONS);// Disable system keyboard appearing on long-press, but for some reason, this prevents the text selection from working.if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {setShowSoftInputOnFocus(false);} else {setRawInputType(InputType.TYPE_CLASS_NUMBER);}// Although this handler doesn't make sense, if removed, the standard keyboard// shows up in addition to the calculator one when the EditText gets a touch event.setOnTouchListener(new OnTouchListener() {@Overridepublic boolean onTouch(View v, MotionEvent event) {// XXX: Use dispatchTouchEvent()?onTouchEvent(event);return false;}});((FormActivity)mContext).setOnBackListener(mCalculatorKeyboard);}/*** Initializes listeners on the EditText*/public void bindListeners(KeyboardView keyboardView){bindListeners(new CalculatorKeyboard(mContext, keyboardView, mCalculatorKeysLayout));}/*** Returns the calculator keyboard instantiated by this EditText* @return CalculatorKeyboard*/public CalculatorKeyboard getCalculatorKeyboard(){return mCalculatorKeyboard;}/*** Returns the view Id of the keyboard view* @return Keyboard view*/public KeyboardView getCalculatorKeyboardView() {return mCalculatorKeyboardView;}/*** Set the keyboard view used for displaying the keyboard* @param calculatorKeyboardView Calculator keyboard view*/public void setCalculatorKeyboardView(KeyboardView calculatorKeyboardView) {this.mCalculatorKeyboardView = calculatorKeyboardView;bindListeners(calculatorKeyboardView);}/*** Returns the XML resource ID describing the calculator keys layout* @return XML resource ID*/public @XmlRes int getCalculatorKeysLayout() {return mCalculatorKeysLayout;}/*** Sets the XML resource describing the layout of the calculator keys* @param calculatorKeysLayout XML resource ID*/public void setCalculatorKeysLayout(@XmlRes int calculatorKeysLayout) {this.mCalculatorKeysLayout = calculatorKeysLayout;bindListeners(mCalculatorKeyboardView);}/*** Sets the calculator keyboard to use for this EditText* @param keyboard Properly intialized calculator keyobard*/public void setCalculatorKeyboard(CalculatorKeyboard keyboard){this.mCalculatorKeyboard = keyboard;}/*** Returns the currency used for computations* @return ISO 4217 currency*/public Commodity getCommodity() {return mCommodity;}/*** Sets the commodity to use for calculations* The commodity determines the number of decimal places used* @param commodity ISO 4217 currency*/public void setCommodity(Commodity commodity) {this.mCommodity = commodity;}/*** Evaluates the arithmetic expression in the EditText and sets the text property* @return Result of arithmetic evaluation which is same as text displayed in EditText*/public String evaluate(){String amountString = getCleanString();if (amountString.isEmpty())return amountString;ExpressionBuilder expressionBuilder = new ExpressionBuilder(amountString);Expression expression;try {expression = expressionBuilder.build();} catch (RuntimeException e) {setError(getContext().getString(R.string.label_error_invalid_expression));String msg = ""Invalid expression: "" + amountString;Log.e(this.getClass().getSimpleName(), msg);Crashlytics.log(msg);return """";}if (expression != null && expression.validate().isValid()) {BigDecimal result = new BigDecimal(expression.evaluate());setValue(result);} else {setError(getContext().getString(R.string.label_error_invalid_expression));Log.w(VIEW_LOG_TAG, ""Expression is null or invalid: "" + expression);}return getText().toString();}/*** Evaluates the expression in the text and returns true if the result is valid* @return @{code true} if the input is valid, {@code false} otherwise*/public boolean isInputValid(){String text = evaluate();return !text.isEmpty() && getError() == null;}/*** Returns the amount string formatted as a decimal in Locale.US and trimmed.* This also converts decimal operators from other locales into a period (.)* @return String with the amount in the EditText or empty string if there is no input*/public String getCleanString(){return getText().toString().replaceAll("","", ""."").trim();}/*** Returns true if the content of this view has been modified* @return {@code true} if content has changed, {@code false} otherwise*/public boolean isInputModified(){return this.isContentModified;}/*** Returns the value of the amount in the edit text or null if the field is empty.* Performs an evaluation of the expression first* @return BigDecimal value*/public @Nullable BigDecimal getValue(){evaluate();try { //catch any exceptions in the conversion e.g. if a string with only ""-"" is enteredreturn AmountParser.parse(getText().toString());} catch (ParseException e){String msg = ""Error parsing amount string "" + getText() + "" from CalculatorEditText"";Log.i(getClass().getSimpleName(), msg, e);return null;}}/*** Set the text to the value of {@code amount} formatted according to the locale.* <p>The number of decimal places are determined by the currency set to the view, and the* decimal separator is determined by the device locale. There are no thousandths separators.</p>* @param amount BigDecimal amount*/public void setValue(BigDecimal amount){BigDecimal newAmount = amount.setScale(mCommodity.getSmallestFractionDigits(), BigDecimal.ROUND_HALF_EVEN);DecimalFormat formatter = (DecimalFormat) NumberFormat.getInstance(Locale.getDefault());formatter.setMinimumFractionDigits(0);formatter.setMaximumFractionDigits(mCommodity.getSmallestFractionDigits());formatter.setGroupingUsed(false);String resultString = formatter.format(newAmount.doubleValue());super.setText(resultString);setSelection(resultString.length());}}",gnucash-android/app/src/main/java/org/gnucash/android/ui/util/widget/CalculatorEditText.java
209,"<?xml version=""1.0"" encoding=""utf-8""?><!--Copyright (c) 2012 - 2014 Ngewi Fet <ngewif@gmail.com>Licensed under the Apache License, Version 2.0 (the ""License"");you may not use this file except in compliance with the License.You may obtain a copy of the License athttp://www.apache.org/licenses/LICENSE-2.0Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an ""AS IS"" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.--><RelativeLayout xmlns:android=""http://schemas.android.com/apk/res/android""xmlns:gnucash=""http://schemas.android.com/apk/res-auto""android:animateLayoutChanges=""true""android:layout_width=""match_parent""android:layout_height=""match_parent""><ScrollViewandroid:layout_width=""match_parent""android:layout_height=""match_parent""><TableLayout android:id=""@+id/fragment_transaction_form""android:layout_width=""match_parent""android:layout_height=""wrap_content""android:padding=""@dimen/dialog_padding""android:stretchColumns=""1""android:orientation=""vertical"" ><TableRow style=""@style/FormRow""><AutoCompleteTextViewandroid:id=""@+id/input_transaction_name""android:layout_width=""match_parent""android:layout_height=""wrap_content""android:layout_span=""2""android:completionThreshold=""1""android:hint=""@string/label_transaction_name""android:inputType=""textCapSentences""android:imeOptions=""actionNext""android:singleLine=""true""android:nextFocusDown=""@+id/input_transaction_amount""android:background=""@android:color/transparent""android:textSize=""22sp""><requestFocus/></AutoCompleteTextView></TableRow><View style=""@style/Divider"" android:layout_marginLeft=""0dp"" /><TableRow style=""@style/FormRow""><TextViewandroid:id=""@+id/currency_symbol""style=""@style/FormIcon""android:gravity=""center""android:textColor=""@color/debit_red""android:textSize=""22sp""android:text=""$"" /><org.gnucash.android.ui.util.widget.CalculatorEditTextandroid:id=""@+id/input_transaction_amount""android:layout_width=""0dp""android:layout_weight=""3""android:layout_height=""wrap_content""android:hint=""@string/label_transaction_amount""android:inputType=""none""android:singleLine=""true""android:nextFocusDown=""@+id/input_description""android:background=""@android:color/transparent""android:textColor=""@color/debit_red""android:textSize=""20sp""android:textIsSelectable=""true""gnucash:keyboardKeysLayout=""@xml/calculator_keyboard""/><ImageView android:id=""@+id/btn_split_editor""android:layout_width=""wrap_content""android:layout_height=""wrap_content""android:contentDescription=""Open split editor""android:src=""@drawable/content_split_holo_light"" /><org.gnucash.android.ui.util.widget.TransactionTypeSwitchandroid:id=""@+id/input_transaction_type""android:layout_width=""0dp""android:layout_weight=""2.5""android:layout_height=""wrap_content""android:textOn=""@string/label_debit""android:textOff=""@string/label_credit""android:gravity=""end|center_vertical""android:textColor=""@color/debit_red""android:textSize=""14sp""android:checked=""true""/></TableRow><View style=""@style/Divider"" /><TableRow android:id=""@+id/layout_double_entry""style=""@style/FormRow"" ><ImageView style=""@style/FormIcon""android:src=""@drawable/ic_action_forward""/><Spinnerandroid:id=""@+id/input_transfer_account_spinner""android:layout_width=""0dp""android:layout_weight=""5""android:layout_height=""wrap_content""  /></TableRow><View style=""@style/Divider"" /><TableRow style=""@style/FormRow"" ><ImageView style=""@style/FormIcon""android:src=""@drawable/ic_action_time""/><TextView android:id=""@+id/input_date""android:layout_width=""0dp""android:layout_weight=""3""android:layout_height=""wrap_content""android:gravity=""center""      /><TextView android:id=""@+id/input_time""android:layout_width=""0dp""android:layout_weight=""2""android:layout_height=""wrap_content""android:gravity=""center""        /></TableRow><View style=""@style/Divider"" /><TableRow style=""@style/FormRow""><ImageView style=""@style/FormIcon""android:src=""@drawable/ic_action_sort_by_size""/><EditText android:id=""@+id/input_description""android:layout_width=""0dp""android:layout_weight=""5""android:layout_height=""wrap_content""android:singleLine=""false""android:background=""@android:color/transparent""android:hint=""@string/label_transaction_description""android:inputType=""textMultiLine|textCapSentences"" /></TableRow><View style=""@style/Divider"" /><TableRow style=""@style/FormRow""><ImageView style=""@style/FormIcon""android:src=""@drawable/ic_action_rotate_right""/><TextView android:id=""@+id/input_recurrence""android:layout_width=""0dp""android:layout_height=""wrap_content""android:layout_weight=""5""android:gravity=""center""android:text=""@string/label_tap_to_create_schedule""style=""@style/Dropdown.TextView"" /></TableRow><CheckBox android:id=""@+id/checkbox_save_template""android:layout_width=""match_parent""android:layout_height=""wrap_content""android:layout_marginBottom=""@dimen/form_row_bottom_margin""android:visibility=""gone""android:text=""@string/label_save_template"" /><!-- Not exposing the transaction template checkbox to the UI at this time --></TableLayout></ScrollView><android.inputmethodservice.KeyboardView android:id=""@+id/calculator_keyboard""android:layout_width=""match_parent""android:layout_height=""wrap_content""android:layout_alignParentBottom=""true""android:layout_alignParentLeft=""true""android:layout_alignParentRight=""true""android:focusable=""true""android:focusableInTouchMode=""true""android:visibility=""gone"" /></RelativeLayout>",gnucash-android/app/src/main/res/layout/fragment_transaction_form.xml